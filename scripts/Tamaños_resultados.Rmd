---
title: "Capítulo 4"
output: html_document
bibliography: referencias/size_spectra.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = NA)
loadNamespace('printr')
set.seed(167)
options("digits"=3)
```

```{r lib, include=FALSE}
{require(tidyverse); require(kableExtra); require(quantreg);require(lubridate);
  require(kSamples);require(ggridges);require(gridExtra);require(emmeans)}
```

```{r limp_dtb,include=FALSE}
body_unlu <- read.delim("database/community_bodymass.txt")
names(body_unlu)<-c("sitio","replica","microhabitat","taxa","length","width","body_mass")
#microhábitat diferencia entre hoja gruesa, hojafragmentada y humus
body_unlu[body_unlu$sitio == "L", "sitio"] <- "A"

#corrección peso de tardígrados
body_unlu[body_unlu$taxa == "tardigrado", "body_mass"]<-body_unlu[body_unlu$taxa == "tardigrado", "body_mass"]/100

body_unlu$estrato<-body_unlu$microhabitat
#estrato queda por los 3 estratos, esto hace a la replicabilidad
body_unlu$estrato[body_unlu$microhabitat=="Frag"|body_unlu$microhabitat=="Hoja"|
                    body_unlu$microhabitat=="hoja"|body_unlu$microhabitat=="humus"]<-"H"

body_unlu<-body_unlu[,c(c("sitio","replica","estrato","microhabitat","taxa","body_mass"))]

#corrección nombres duplicados o erróneos
{body_unlu$taxa[body_unlu$taxa=="Apodorrectodeacaliginosa"|
                 body_unlu$taxa=="Aporrectodeacaliginosa"]<-"Aporrectodea_caliginosa"
body_unlu$taxa[body_unlu$taxa=="Apodorrectodeatrapezoides"|
                 body_unlu$taxa=="Aporrectodeatrapezoides"]<-"Aporrectodea_trapezoides"
body_unlu$taxa[body_unlu$taxa=="Aporrectodearosea"]<-"Aporrectodea_rosea"
body_unlu$taxa[body_unlu$taxa=="Bimastosbeddardisophiae"]<-"Bimastos_beddardi_sophiae"
body_unlu$taxa[body_unlu$taxa=="Bimastosparvus"]<-"Bimastos_parvus"
body_unlu$taxa[body_unlu$taxa=="entomobridae"|
                 body_unlu$taxa=="entomobridae"|
                 body_unlu$taxa=="entomobriidae"]<-"entomobryoidea"
body_unlu$taxa[body_unlu$taxa=="Eukerriahalophila"]<-"Eukerria_halophila"
body_unlu$taxa[body_unlu$taxa=="insecto_polinizador"|
                 body_unlu$taxa=="insecto_suctor"]<-"hemiptera"
body_unlu$taxa[body_unlu$taxa=="larva_carabidae"|
                 body_unlu$taxa=="larva_carabido"]<-"larva_carabidae"
body_unlu$taxa[body_unlu$taxa=="larva_diptera"|
                 body_unlu$taxa=="larva_diptero"]<-"larva_diptera"
body_unlu$taxa[body_unlu$taxa=="larva_scarabidae"]<-"larva_scarabaeidae"
body_unlu$taxa[body_unlu$taxa=="larva_staphynilidae"]<-"larva_staphylinidae"
body_unlu$taxa[body_unlu$taxa=="Microscolexphosphoreus"]<-"Microscolex_phosphoreus"
body_unlu$taxa[body_unlu$taxa=="Microscolexphosphoreus"]<-"Microscolex_phosphoreus"
body_unlu$taxa[body_unlu$taxa=="Octalasioncyaneum"]<-"Octalasion_cyaneum"
body_unlu$taxa[body_unlu$taxa=="Octolasiontyrtaeum"]<-"Octolasion_tyrtaeum"
body_unlu$taxa[body_unlu$taxa=="paholaspidae"]<-"parholaspidae"
body_unlu$taxa[body_unlu$taxa=="pupa_diptero"|
                 body_unlu$taxa=="pupa_insecto"|
                 body_unlu$taxa=="pupadíptera"]<-"pupa_diptera"
body_unlu$taxa[body_unlu$taxa=="raghididae"|
                 body_unlu$taxa=="rhagididae"]<-"rhagidiidae"
body_unlu$taxa[body_unlu$taxa=="staphiliniidae"|
                 body_unlu$taxa=="staphylinidae"]<-"staphylinidae"
#correccion glososscolex
body_unlu$taxa[body_unlu$taxa=="Glossoscolexsp."]<-"Octolasion_tyrtaeum"
body_unlu$taxa[body_unlu$taxa=="hemiptera"|
                 body_unlu$taxa=="hemiptero"|
                 body_unlu$taxa=="heteroptera"]<-"hemiptera"
body_unlu$taxa[body_unlu$taxa=="gasteropoda"|
                 body_unlu$taxa=="gastropoda"]<-"gasteropoda"
body_unlu$taxa[body_unlu$taxa=="macropilina"]<-"lohmanidae"
body_unlu$taxa[body_unlu$taxa=="terebrantia"]<-"trip"

}

#asignamos gremios. Predadores, Omnivoros, Detritivoros, Microfitofagos, Herviboros
body_unlu$gremio<-NA
#predadores
body_unlu$gremio<-ifelse(
  body_unlu$taxa%in%c("amerosidae","arannae","arctacaridae","coccinelidae",
                      "bdelloidea","carabidae","cunaxide","dermanisoidea",
                      "eviphididae","formicidae","geophylomorpha","grillopalpidae",
                      "ichtyostomatogasteridae","japygiidae","laelapidae","larva_carabidae",
                      "larva_staphylinidae","linyphiidae","lycosidae","mesostigmata",
                      "nematomorpha",
                      "ologamasidae","parajapygidae","parasitidae","parholaspidae",
                      "predador","pseudoscorpionida","rhagidiidae",
                      "rhodacaroidea","staphylinidae","tenerifidae",
                      "trogossitidae","uropodidae"),"predador",
  ifelse(
    body_unlu$taxa%in%c("anthribidae","Aporrectodea_caliginosa","Aporrectodea_rosea",
                        "coleoptera",
                        "Aporrectodea_trapezoides","Bimastos_beddardi_sophiae",
                        "Bimastos_parvus",
                        "blattodea","ceratozetoidea","diptera",
                        "diplopoda","elateriforme","enquitreido","epilhomanioidea",
                        "Eukerria_halophila","eupthiracaroidea","Glossoscolex","isotomidae",
                        "juvenil","larva_coleoptero","larva_curculionidae","larva_diptera",
                        "larva_scarabaeidae","larva_tenebrionidae",
                        "Microscolex_phosphoreus","Octalasion_cyaneum","Octolasion_tyrtaeum",
                        "oniscoidea","oribatido","oripodidae","ptinidae","ptilidae",
                        "pupa_diptera",
                        "pythidae","scheloribates","symphypleona","tenebrionidae"
                        ),"detritivoro",
    ifelse(
    body_unlu$taxa%in%c("alycidae","bacterivoro","cryptophagidae","entomobryoidea",
                        "eremobelbidae","fungivoro","galumnidae","gasteropoda",
                        "larva_elateridae","larva_sciaridae","limnozetidae","lohmanidae",
                        "macropilina","onichiuridae","oppioidea","oribatulidae",
                        "protura","psocoptera","symphyla"
                        ),"microfitofago",
    ifelse(
      body_unlu$taxa%in%c("afido","cicadidae","fitofago",
                          "hemiptera","ortoptero","trip","terebrantia"),"herbívoro",
      ifelse(
        body_unlu$taxa%in%c("eupodoidea","astigmata","hipogastruridae",
                            "larva_elateridae","omnivoro","penthalidae","tardigrado"
                            ,"tarsonemidae","tydeoidea"),"omnivoro",body_unlu$gremio
      )))))

#datos$food <- ifelse(datos$taxa %in% especies_predadoras, "predadora",
#            ifelse(datos$taxa %in% especies_herbivoras, "herbívora",
#            ifelse(datos$taxa %in% especies_omnivoras, "omnívora", datos$food)))


#correción celda
#araña de 4 son 400 microgramos 
body_unlu[4163,"body_mass"]<-400

### clase de tamaño para calcular densidad

body_unlu$clase_tam<-NA
#predadores
body_unlu$clase_tam<-ifelse(
  body_unlu$taxa%in%c("bacterivoro","fitofago","fungivoro","omnivoro","predador"),"micro",
  ifelse(
    body_unlu$taxa%in%c("alycidae","amerosidae","arctacaridae",
                        "astigmata","bdelloidea","ceratozetoidea","cunaxide",
                        "dermanisoidea","enquitreido","entomobryoidea",
                        "epilhomanioidea","eremobelbidae","eupodoidea",
                        "eupthiracaroidea","eviphididae","galumnidae",
                        "hipogastruridae","ichtyostomatogasteridae",
                        "isotomidae","japygiidae","laelapidae","limnozetidae","lohmanidae","macropilina",
                        "mesostigmata","ologamasidae","onichiuridae","oppioidea",
                        "oribatido","oribatulidae","oripodidae","parajapygidae",
                        "parasitidae","parholaspidae","penthalidae","protura",
                        "rhagidiidae","rhodacaroidea","scheloribates",
                        "symphyla","symphypleona","tardigrado","tarsonemidae","tenerifidae",
                        "tydeoidea","uropodidae"),"meso",
    ifelse(
    body_unlu$taxa%in%c("anthribidae","Aporrectodea_caliginosa","Aporrectodea_rosea",
                        "Aporrectodea_trapezoides","arannae","Bimastos_beddardi_sophiae",
                        "Bimastos_parvus","blattodea","carabidae","cicadidae","coccinelidae",
                        "coleoptera","cryptophagidae","diplopoda","diptera","elateriforme",
                        "Eukerria_halophila","formicidae","gasteropoda","geophylomorpha",
                        "Glossoscolex","grillopalpidae","hemiptera","juvenil","larva_carabidae",
                        "larva_coleoptero","larva_curculionidae","larva_elateridae",
                        "larva_scarabaeidae","larva_staphylinidae","larva_tenebrionidae",
                        "linyphiidae","lycosidae", "Microscolex_phosphoreus","nematomorpha",
                        "Octalasion_cyaneum","Octolasion_tyrtaeum","oniscoidea","ortoptero",
                        "pseudoscorpionida","psocoptera","ptilidae","ptinidae","pythidae",
                        "staphylinidae","tenebrionidae","terebrantia","trogossitidae",
                        "trip","larva_sciaridae","larva_diptera","afido","pupa_diptera"),"macro",
    body_unlu$clase_tam)))


forbody_unlu<-body_unlu

#taxones
bodyU_taxa<-levels(as.factor(body_unlu$taxa))

```

```{r dtbRO,include=FALSE}
completo <- read_csv2("database/body_fq_guil_22.csv" , locale = readr::locale(encoding = "ISO-8859-1"))

#Superficie en metros cuadrados a partir del sacabocados de 5 centímetros cuadrados
#factor de conversión
superficie <- pi*2.5^2/10000

#sin macrofauna
#Datos brutos, biomasa individual de microartropodos
meso <- filter(completo,class!="macrofauna"&specie!="oribátido"&specie!="mesostigmata")
meso[meso$specie%in%c("anystidae","eupodoidea",
                      "penthalidae","tarsonemidae","tydeoidea"),"guild"]<-"omnivore"


#Base con biomasas promedios por especie
#sample, son submuestras, por lo que no sirve para dividir sino para promediar la muestra
base <-meso %>% group_by(system,site,year,month,sample,season,class,order,specie,guild,habitat) %>%  summarise(abundance=(n()/superficie), bio.ind=mean(biomass),Tbiomass=(bio.ind*abundance))

```

```{r resumen_dtb, include=FALSE}

baseU <-body_unlu %>% group_by(sitio, replica,estrato, microhabitat,clase_tam,gremio,taxa) %>%  summarise(abundance=n(), bio.ind=mean(as.numeric(body_mass)))
#R1	452 R2	998 R3	1207
#L1	212 L2	473 L3	378
#P1	556 P2	518 P3	636
#1.05 es el factor de aumento del 5% por pérdida
names(baseU)<-c("sitio","replica","estrato","microhabitat",
                "clase","gremio","taxa","abundance","bio.ind")
#corrigiendo densidades de nemátodos
#además se asume un error de 20% por pérdida de animales no fotografiados pero si contabilizados

baseU<-baseU%>%
  mutate(ab=floor(case_when(
  sitio=="R"&replica==1&clase=="micro"~(abundance/100)*452*1.05,
  sitio=="R"&replica==2&clase=="micro"~(abundance/100)*998*1.05,
  sitio=="R"&replica==3&clase=="micro"~(abundance/100)*1207*1.05,
  sitio=="A"&replica==1&clase=="micro"~(abundance/100)*212*1.05,
  sitio=="A"&replica==2&clase=="micro"~(abundance/100)*473*1.05,
  sitio=="A"&replica==3&clase=="micro"~(abundance/100)*378*1.05,
  sitio=="P"&replica==1&clase=="micro"~(abundance/100)*556*1.05,
  sitio=="P"&replica==2&clase=="micro"~(abundance/100)*518*1.05,
  sitio=="P"&replica==3&clase=="micro"~(abundance/100)*636*1.05,
  TRUE~abundance*1.20
  )))
  
#microfauna (se contaron los nemátodos de 4 sacabocados)
sup.bocado.micro <- (1/(pi*2.5^2/10000))*4

#mesofauna (se contaron y extrajeron de 3 frasquitos homojeneizados del monolito)
#se utiliza 1.8 ya que el volumen fue de 100 cm para una profundidad de 10 cm.
# la superficie de todo estrato diferente a 10 fue 25*25, corregir datos de densidad. 
sup.bocado.meso <- (1/(pi*1.8^2/10000))*3
#macrofauna (superficie estandar 25 x 25)
sup.monolito <- 1/(0.25*0.25)

baseU<-baseU%>%mutate(
             D=floor(case_when(
  clase=="macro"~sup.monolito*ab,
  clase=="meso"~sup.bocado.meso*ab,
  clase=="micro"~sup.bocado.micro*ab)
  )
  )


```

```{r densidad_peso_unlu, include=FALSE, warning=FALSE, message=FALSE}

baseU$Sistema<-factor(baseU$sitio,labels = c("Agrícola","Pastizal","Reserva"))
baseU$Taxón<-factor(baseU$taxa,labels=c("Aphidoidea","Alycidae","Amerosidae",
"Anthribidae","Aporrectodea caliginosa","Aporrectodea rosea", "Aporrectodea trapezoides","Arannae",
"Arctacaridae","Astigmata","Bacterivoro","Bdelloidea","Bimastos beddardi sophiae","Bimastos parvus",
"Blattodea","Carabidae","Ceratozetoidea","Cicadidae","Coccinelidae","Coleoptera","Cryptophagidae",
"Cunaxide","Dermanisoidea","Diplopoda","Diptera","Elateriformia","Enchytraeida","Entomobryoidea",
"Epilohmannioidea","Eremobelbidae","Eukerria halophila",
"Eupodoidea","Euphthiracaroidea","Eviphididae","Fitofago","Formicidae","Fungivoro","Galumnidae",
"Gasteropoda","Geophilomorpha","Grillopalpidae","Hemiptera","Hipogastruridae",
"Ichtyostomatogasteridae","Isotomidae","Japygiidae","Juvenil, lombriz","Laelapidae",
"Carabidae, larva","Coleoptera larva","Curculionidae larva","Diptera larva","Elateridae larva",
"Scarabaeidae larva","Sciaridae larva","Staphylinidae larva","Tenebrionidae larva","Limnozetidae",
"Linyphiidae","Lohmanidae","Lycosidae","Mesostigmata","Microscolex phosphoreus","Nematomorpha",
"Octolasion cyaneum","Octolasion tyrtaeum","Ologamasidae","Omnivoro","Onychiuridae","Oniscoidea",
"Oppioidea","Oribatida","Oribatulidae","Oripodidae","Ortoptera","Parajapygidae","Parasitidae",
"Parholaspidae","Penthaleidae","Predador","Protura","Pseudoscorpionida","Psocoptera","Ptilidae",
"Ptinidae","Diptera pupa","Pythidae","Rhagidiidae","Rhodacaroidea","Scheloribates","Staphylinidae",
"Symphyla","Symphypleona","Tardigrada","Tarsonemidae","Tenebrionidae","Tenerifidae",
"Thysanoptera","Trogossitidae","Tydeoidea","Uropodidae"))

#microfauna
Dp_U_m<-baseU%>%filter(clase=="micro")%>%group_by(Taxón,Sistema)%>%summarise('Peso corporal'=round(mean(bio.ind),1), Densidad=round(sum(D)),'Biomasa'=round(mean(D*bio.ind)/1000,1)) #%>% distinct(taxa,.keep_all=TRUE)
#mesofauna
Dp_U_me_D<-baseU%>%filter(clase=="meso"&Taxón%in%c("Alycidae","Astigmata","Ceratozetoidea","Enchytraeida","Entomobryoidea",
"Epilohmannioidea","Eremobelbidae","Euphthiracaroidea","Galumnidae","Hipogastruridae","Isotomidae","Limnozetidae","Lohmanidae",
"Onychiuridae",
"Oppioidea","Oribatida","Oribatulidae","Oripodidae","Protura","Scheloribates",
"Symphyla","Symphypleona"))%>%group_by(Taxón,Sistema)%>%summarise('Peso corporal'=round(mean(bio.ind),1), Densidad=round(sum(D)),'Biomasa'=round(mean(D*bio.ind)/1000,1)) #%>% distinct(taxa,.keep_all=TRUE)

Dp_U_me_P<-baseU%>%filter(clase=="meso"&Taxón%in%c("Amerosidae",
"Dermanisoidea","Eviphididae","Ichtyostomatogasteridae","Laelapidae",
"Mesostigmata","Ologamasidae","Parasitidae",
"Parholaspidae","Rhodacaroidea","Uropodidae","Bdelloidea","Cunaxide","Eupodoidea","Penthaleidae","Rhagidiidae","Tarsonemidae","Tenerifidae","Tydeoidea","Japygiidae","Parajapygidae","Tardigrada"))%>%group_by(Taxón,Sistema)%>%summarise('Peso corporal'=round(mean(bio.ind),1), Densidad=round(sum(D)),'Biomasa'=round(mean(D*bio.ind)/1000,1)) #%>% distinct(taxa,.keep_all=TRUE)


#macrofauna
Dp_U_Ma<-baseU%>%filter(clase=="macro")%>%group_by(Taxón,Sistema)%>%summarise('Peso corporal'=round(mean(bio.ind),1), Densidad=round(sum(D)),'Biomasa'=round(mean(D*bio.ind)/1000,1)) #%>% distinct(taxa,.keep_all=TRUE)


B1<-meso%>%mutate(Manejo=factor(system,labels= c("Agrícola intensivo","Agrícola-ganadero","Pastizal naturalizado")),Taxon=factor(specie,labels=c("Acaroidea","Bdelloidea","Brachychthonioidea","Ceratozetoidea","Crotonioidea","Dermanyssoidea","Entomobroidea","Epilohmannioidea","Euphthiracaroidea", "Eupodoidea","Galumnioidea","Hypogastruridae","Isotomidae","Onychiuridae","Oppioidea","Oripodoidea","Parasitoidea","Rhodacaroidea","Symphypleona","Trombidioidea","Tydeoidea","Uropodoidea","Veigaioidea")))%>%group_by(Manejo,site,year,month,sample,Taxon)%>%summarise(peso=biomass,bio=sum(biomass), abT= n(), bioT=bio/superficie, D=abT/superficie)


B2<-B1%>%group_by(Taxon,Manejo)%>%summarise('Peso corporal'=round(mean(peso),2), Densidad=round(mean(D)),'Biomasa'=round((mean(bioT)/1000),2)) #%>% distinct(Taxon,.keep_all=TRUE)

#'Peso corporal mínimo'=min(peso),'Peso corporal máximo'=max(peso),

```

```{r rid,include=FALSE,warning=FALSE,message=FALSE}
body_unlu$Sistema<-factor(body_unlu$sitio,labels = c("Agrícola","Pastizal","Reserva"))
body_unlu$Taxón<-factor(body_unlu$taxa,labels=c("Aphidoidea","Alycidae","Amerosidae",
"Anthribidae","Aporrectodea caliginosa","Aporrectodea rosea", "Aporrectodea trapezoides","Arannae",
"Arctacaridae","Astigmata","Bacterivoro","Bdelloidea","Bimastos beddardi sophiae","Bimastos parvus",
"Blattodea","Carabidae","Ceratozetoidea","Cicadidae","Coccinelidae","Coleoptera","Cryptophagidae",
"Cunaxide","Dermanisoidea","Diplopoda","Diptera","Elateriformia","Enchytraeida","Entomobryoidea",
"Epilohmannioidea","Eremobelbidae","Eukerria halophila",
"Eupodoidea","Euphthiracaroidea","Eviphididae","Fitófago","Formicidae","Fungívoro","Galumnidae",
"Gasteropoda","Geophilomorpha","Grillopalpidae","Hemiptera","Hipogastruridae",
"Ichtyostomatogasteridae","Isotomidae","Japygiidae","Juvenil, lombriz","Laelapidae",
"Carabidae, larva","Coleoptera larva","Curculionidae larva","Diptera larva","Elateridae larva",
"Scarabaeidae larva","Sciaridae larva","Staphylinidae larva","Tenebrionidae larva","Limnozetidae",
"Linyphiidae","Lohmanidae","Lycosidae","Mesostigmata","Microscolex phosphoreus","Nematomorpha",
"Octolasion cyaneum","Octolasion tyrtaeum","Ologamasidae","Omnívoro","Onychiuridae","Oniscoidea",
"Oppioidea","Oribatida","Oribatulidae","Oripodidae","Ortoptera","Parajapygidae","Parasitidae",
"Parholaspidae","Penthaleidae","Depredador","Protura","Pseudoscorpionida","Psocoptera","Ptilidae",
"Ptinidae","Diptera pupa","Pythidae","Rhagidiidae","Rhodacaroidea","Scheloribates","Staphylinidae",
"Symphyla","Symphypleona","Tardigrada","Tarsonemidae","Tenebrionidae","Tenerifidae",
"Thysanoptera","Trogossitidae","Tydeoidea","Uropodidae"))

body_unlu$Gremio<-factor(body_unlu$gremio,labels=c("Detritivoro","Herbívoro","Microfitófago",
                                                   "Omnivoro","Depredador"))

```

```{r plot_nem_ridg,echo=FALSE,warning=FALSE,message=FALSE,fig.align = "center"}
body_unlu%>%filter(clase_tam=="micro")%>%
  ggplot(aes(x=log(body_mass), y=Taxón, fill=Gremio)) + 
  geom_density_ridges(rel_min_height = 0.001,scale=1.5,show.legend=FALSE)+ 
  scale_fill_viridis_d(alpha = 0.8)+  
  facet_grid(.~Sistema)+
  labs(x= 'Peso corporal en ln ug',y=NULL)



```


```{r tab_nem_ridg,echo=FALSE,warning=FALSE,message=FALSE}
Dp_U_m%>% kbl() %>%kable_classic(full_width = F, html_font = "Cambria")


```

```{r plot_mesodet_ridg,echo=FALSE,warning=FALSE,message=FALSE,fig.align = "center"}

body_unlu%>%filter(clase_tam=="meso"&body_unlu$taxa%in%c("alycidae",
                        "astigmata","ceratozetoidea",
                        "enquitreido","entomobryoidea",
                        "epilhomanioidea","eremobelbidae",
                        "eupthiracaroidea","galumnidae",
                        "hipogastruridae",
                      "isotomidae",
                      "limnozetidae","lohmanidae","macropilina",
                        "onichiuridae","oppioidea",
                    "oribatido","oribatulidae","oripodidae",
                    "scheloribates",
                    "symphyla","symphypleona"))%>%
  ggplot(aes(x=log(body_mass), y=Taxón, fill=Gremio)) + 
  geom_density_ridges(rel_min_height = 0.001,scale = 2.5)+ 
  scale_fill_viridis_d(alpha = 0.8)+
  facet_grid(.~Sistema)+
  labs(x= 'Peso corporal en ln ug/m^2',y=NULL)


```

**Figura 4.2.** Distribución de los pesos corporales de la mesofauna edáfica excluyendo a predadores ocurridos en suelos Argiudoles de Luján. Se muestra sobre el eje horizontal la escala en logaritmo natural del peso corporal en microgramos de peso seco. Sobre el eje vertical se indica el taxón. Los colores de las distribuciones indican el gremio al que pertenecen.

Los enquitreidos, animales con función ecológica similar a la de las lombrices de tierra pero debido a su tamaño corporal con su efecto operando a menor escala, muestra (Tabla 4.2) el mayor peso corporal medio, la mayor densidad y la mayor biomasa media en el suelo agrícola.

**Tabla 4.2.** Valores de peso corporal promedio ($ug_{p.s.}$), densidad ($no. ind/m^2$) y biomasa total media ($mg_{p.s.}/m^2$) para la mesofauna no depredadora de suelos Argiudoles de Luján

```{r tab_mesodet_ridg,echo=FALSE,warning=FALSE,message=FALSE}
Dp_U_me_D%>% kbl() %>%kable_classic(full_width = F, html_font = "Cambria")

```

```{r plot_mesopred_ridg,echo=FALSE,warning=FALSE,message=FALSE}
body_unlu%>%filter(clase_tam=="meso"
                   &body_unlu$taxa%in%c("amerosidae","arctacaridae",
                        "bdelloidea","cunaxide",
                        "dermanisoidea","eupodoidea",
                        "eviphididae","ichtyostomatogasteridae",
                        "laelapidae",
                        "mesostigmata","ologamasidae",
                        "parasitidae","parholaspidae","penthalidae",
                    "rhagidiidae","rhodacaroidea","tardigrado","parajapygidae","japygiidae","tarsonemidae","tenerifidae", 
                        "tydeoidea","uropodidae"))%>%
  ggplot(aes(x=log(body_mass), y=Taxón, fill="yellow")) + 
  geom_density_ridges(rel_min_height = 0.001,scale = 1.5,show.legend=FALSE)+ 
  scale_fill_viridis_d(alpha = 0.8)+
  facet_grid(.~Sistema)+
  labs(x= 'Peso corporal en ln ug',y=NULL)

```


```{r tab_msopred_ridg,echo=FALSE,warning=FALSE,message=FALSE}
Dp_U_me_P%>% kbl() %>%kable_classic(full_width = F, html_font = "Cambria")


```


```{r plot_mesoRO_ridg,echo=FALSE,warning=FALSE,message=FALSE}
meso1<-meso
meso1$Sistema<-factor(meso1$system,labels= c("Agrícola intensivo","Agrícola-ganadero","Pastizal naturalizado"))
meso1$Taxón<-factor(meso1$specie,labels=c("Acaroidea","Bdelloidea","Brachychthonioidea","Ceratozetoidea","Crotonioidea","Dermanyssoidea","Entomobroidea","Epilohmannioidea","Euphthiracaroidea", "Eupodoidea","Galumnioidea","Hypogastruridae","Isotomidae","Onychiuridae","Oppioidea","Oripodoidea","Parasitoidea","Rhodacaroidea","Symphypleona","Trombidioidea","Tydeoidea","Uropodoidea","Veigaioidea"))

meso1$Gremio<-factor(meso1$guild,labels=c("Detritivoro","Microfitofago","Omnivoro","Deredador"))

meso1%>%ggplot(aes(x=log(biomass), y=Taxón, fill=Gremio)) + geom_density_ridges(rel_min_height = 0.0000005) +scale_x_continuous(breaks = seq(from=-4, to=5, by=2))+  scale_fill_viridis_d(alpha = 0.8)+facet_grid(.~Sistema)+labs(x= 'Peso corporal en ln ug/m^2',y=NULL)


```

```{r tab_mesoRO_ridg,echo=FALSE,warning=FALSE,message=FALSE}
B2%>% kbl() %>%kable_classic(full_width = F, html_font = "Cambria")


```

```{r plot_macro_ridg,echo=FALSE,warning=FALSE,message=FALSE}
body_unlu%>%filter(clase_tam=="macro"&body_unlu$taxa
  %in%c("anthribidae","Aporrectodea_caliginosa","blattodea","carabidae","cicadidae","diplopoda",
        "formicidae","gasteropoda","geophylomorpha",
                        "Glossoscolex","juvenil","larva_carabidae",
                        "larva_coleoptero","larva_elateridae",
                        "larva_scarabaeidae","larva_tenebrionidae",
                        "linyphiidae","lycosidae", "Microscolex_phosphoreus",
                        "oniscoidea",
                        "ptilidae",
                        "staphylinidae","tenebrionidae","terebrantia",
                        "trip","larva_sciaridae","larva_diptera","afido","pupa_diptera"))%>%
  ggplot(aes(x=log(body_mass), y=Taxón, fill=Gremio)) + 
  geom_density_ridges(rel_min_height = 0.001,scale = 2.5)+ 
  scale_fill_viridis_d(alpha = 0.8)+
  facet_grid(.~sitio)+
  labs(x= 'Peso corporal en ln ug/m^2',y=NULL)

```


```{r tab_macro_ridg,echo=FALSE,warning=FALSE,message=FALSE}
Dp_U_Ma%>% kbl() %>%kable_classic(full_width = F, html_font = "Cambria")


```

<!--q es el estadístico de Studentized range statistic -->

```{r B_unlu, include=FALSE}

#B.UNLU######
baseU<-baseU%>%mutate(Tbiomass=D*bio.ind)
#modelo completo
mU<-lm(log(Tbiomass) ~ sitio * gremio ,data = baseU)
step(mU)
#modelo parsimonioso
mU_p<-lm(formula = log(Tbiomass) ~ gremio, data = baseU)

#B.Rosana######
#modelo completo
mR<-lm(log(Tbiomass) ~ system * guild, data = base)
step(mR)
mR_p<-lm(log(Tbiomass) ~ system * guild, data = base)

```

```{r B_plot_U,echo=FALSE,warning=FALSE,message=FALSE,fig.align = "center"}

baseU$Gremio <- factor(baseU$gremio,labels=c("Detritívoros","Herbivoros","Microfitófagos","Omnívoros","Depredadores"))
baseU$Sitio <- factor(baseU$sitio,labels=c("A","P","R"))

#guild
baseU %>%  ggplot( aes(y=log(Tbiomass),x=Gremio, col=Gremio, fill=NA)) + geom_violin(alpha=0.75,trim = FALSE,draw_quantiles = 0.5) +  geom_jitter(alpha=0.4, col=as.numeric(baseU$Sitio))  +stat_summary(fun = "mean",geom = "point",color = "yellow", size=3)+scale_color_manual(values = scales::hue_pal()(length(unique(baseU$Gremio))), guide = "none")+
  labs(subtitle="A)",y=expression(paste("Biomasa","  ",paste("ln"," ",mu,"g"," ")[ps]/m^2), x=NULL))+ scale_fill_viridis_d(guide="none")+theme_classic()


```

```{r B_plot_Ro,echo=FALSE,warning=FALSE,message=FALSE,fig.align = "center"}

# System : guild

meso %>% mutate(guild=factor(guild,labels=c("Detritívoros","Microfitófagos","Omnívoros","Depredadores"))) %>% group_by(system,site,year,month,sample,season,class,order,specie,guild,habitat) %>%  summarise(abundance=(n()/superficie), bio.ind=mean(biomass),Tbiomass=(bio.ind*abundance)) %>% ggplot( aes(y=log(Tbiomass),x= system,fill=NA,color=system)) + geom_violin(alpha=0.75,trim = FALSE,draw_quantiles = 0.5)+geom_jitter(alpha=0.3,col="grey",fill=NA)  +stat_summary(fun = "mean",geom = "point",color = "yellow", size=3)+ scale_color_manual(values = scales::hue_pal()(length(unique(meso$system))), guide = "none")+
  scale_y_continuous(breaks = seq(from=3, to=15, by=1))+scale_fill_viridis_d(guide="none") + facet_grid(.~guild) +labs(subtitle="B)",x='Sistemas de manejo', y=expression(paste("Biomasa","  ",paste("ln"," ",mu,"g"," ")[ps]/m^2)))+theme_classic()


```

```{r qq_unlu, include=FALSE, warning=FALSE, message=FALSE}
#modelo full UNLu
rq0<-rq(log(D) ~ (sitio+gremio+log(bio.ind))^3, tau = .75, data = baseU)
#summary(rq0,se="boot")
step(rq0)
#modelo full Ro
rq1<-rq(log(abundance) ~ (system+guild+log(bio.ind))^2, tau = .75, data = base)
step(rq1)


rqU<-rq(log(D) ~ (sitio + gremio + log(bio.ind)+ sitio:gremio + gremio:log(bio.ind)) ,tau = .75, data = baseU)
#modelo Ro
rqRO<-rq(log(abundance) ~ (system+guild+log(bio.ind))^2, tau = .75, data = base)


```

```{r qqplotU+h, fig.align = "center", echo=FALSE,warning=FALSE,message=FALSE}

baseU[baseU$taxa=="tarsonemidae"&baseU$sitio=="P"&baseU$replica==1,"bio.ind"]<-80
baseU%>%mutate( gremio = factor(gremio, levels = c("detritivoro","microfitofago",
                                                      "predador","omnivoro","herbívoro")
                                   ,labels=c("Detritívoros","Microfitófagos","Depredadores","Omnívoros","Herbívoros")))%>%ggplot(aes(x=log(bio.ind),y=log(D),color=sitio))+
   
  geom_point(size=1.5,shape=as.factor(baseU$clase),color=as.numeric(as.factor(baseU$taxa)))+
  geom_quantile(quantiles = 0.75, size=1.5) +
  scale_color_viridis_d()+ scale_x_continuous(breaks = seq(from=-2, to=14,by=2))+
  scale_y_continuous(breaks = seq(from=0, to=15,by=3))+
  facet_grid(gremio~.)+ 
  labs( x=expression(paste("Peso corporal","  ",paste(ln," ",mu,"g")[ps])),
        y=expression(paste("Densidad","  ",ln," ","n°"[ind]/m^{2})))

```

```{r qrplot_RO, fig.align = "center", echo=FALSE,warning=FALSE,message=FALSE}


base%>%mutate( gremio = factor(guild, levels = c("detritivore","microphytophages",
                                                      "omnivore","predator")
                                   ,labels=c("Detritívoros","Microfitófagos","Depredadores","Omnívoros")))%>%
  ggplot(aes(x=log(bio.ind),y=log(abundance),color=system))+
  geom_point(size=1.1,shape=8,color=as.numeric(as.factor(base$specie)))+
  geom_quantile(quantiles = 0.75, size=1.5) +
  scale_color_viridis_d()+facet_grid(gremio~.)+ 
  scale_x_continuous(breaks = seq(from=-3, to=6,by=1))+
  scale_y_continuous(breaks = seq(from=5, to=12,by=2))+
  labs(x=expression(paste("Peso corporal","  ",paste(ln," ",mu,"g")[ps])), y=expression(paste("Densidad","  ",ln," ","n°"[ind]/m^{2})))


```

<!-- turnbul014 en una de sus figuras muestra que la relacion ab-peso es pendiente casi nula para 
comunidades de nematodos de tipo "estructurado" pendiente bien negtivas para "basales" y "intermedio" para enriquesiddso
Dicha clasificacion esta basado en los generos de nematodos, con la escala colonizador persistente, habitos troficos -->

<!-- Esto es para cambiar tamaño de letra color, tipo etc -->

<!-- <font face = "Microsoft Yahei"> Ingrese el texto aquí </font> -->

<!--  <font size = 5> Ingrese el texto aquí </font> -->

# Referencias

\newpage

# Apéndice del capítulo 4

## Apéndice 4.1. Ecuaciones morfométricas para estimar el peso corporal de la fauna edáfica

Ecuaciones morfométricas que relacionan el largo y el ancho corporal para estimar el peso corporal de los taxones de la fauna edáfica según su forma característica. Se aclaran las unidades de medidas de peso, largo y ancho para cada caso en particular, se deja en claro el coeficiente de peso seco utilizado.

+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Autor                   | Taxón                                 | Ecuación                                           | Coeficiente de peso seco                | Observaciones                                                               |
+=========================+=======================================+====================================================+=========================================+=============================================================================+
| Tanaka (1970)           | Hipogastruridae                       | log P = 2,78 \* log L + 0,71                       | expresado en peso seco                  | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Tanaka (1970)           | Isotomidae                            | log P = 2,55 \* log L + 0,99                       | expresado en peso seco                  | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Tanaka (1970)           | Onychiuridae                          | log P = 2,75 \* log L + 0,63                       | expresado en peso seco                  | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Tanaka (1970)           | Entomobriidae                         | log P = 2,5 \* log L + 1,07                        | expressed as dry biomass                | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Petersen (1975)         | Symphypleona                          | log P = log 39,6278 + 0,83 \* log L                | expressed as dry biomass                | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Lebrum Philippe (1971)  | Achipteriforme                        | log P = 2,09 log L + 0,93 log l – 6,67             | 0,4                                     | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*coef según Persson and Lohm, (1977); Fórmulas Oribátidos según Morfología |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Lebrum Philippe (1971)  | Nothriforme                           | log P = 2,09 log L + 0,84 log l – 6,44             | 0,4                                     | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*coef según Persson and Lohm, (1977); Fórmulas Oribátidos según Morfología |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Lebrum Philippe (1971)  | Carabodiforme                         | log P = 1,62 log L + 1,40 log l – 6,56             | 0,4                                     | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*coef según Persson and Lohm, (1977); Fórmulas Oribátidos según Morfología |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Lebrum Philippe (1971)  | Forma general utilizada en la tabla 9 | Log P = 1,53 log L + 1,53 log l – 6,67             | 0,4                                     | P (peso en ug) = 10 ^log P^                                                 |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*coef según Persson and Lohm, (1977); Fórmulas Oribátidos según Morfología |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Persson and Lohm (1977) | Trombidiformes                        | W = (0,00387\* L)^3^                               | 0,4                                     | P (peso en ug)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*coef según Persson and Lohm, (1977)                                       |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Persson and Lohm (1977) | Mesostigmatas                         | P = 0,85 \* ( L ^2,09^ \* l ^0,84^ \* 10 ^-6,44^ ) | 0,4                                     | P (peso en ug)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (ancho en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \* coef según Persson and Lohm, (1977)                                      |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Aracnida                              | ln P = -3,2105 + 2,4681 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Coleoptera adulto                     | ln P = -3,2689 + 2,4625 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Coleoptera larva                      | ln P = -7,1392 + 0,8095 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Díptera                               | ln P = -3,4294 + 2,5943 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Formicidae                            | ln P = -3,1415 + 2,3441 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Hawkins et al. (1997)   | Gasterópoda                           | P = 0,172\* L^1,688^                               | expresado en peso seco                  | P (peso en mg)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Isopoda                               | ln P = -1,1167 + 0,4762\*L                         | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Coulis & Joly (2017)    | Diplopoda Miriapoda                   | ln P = 2,38\* ln(L)-2,77                           | 0,45                                    | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | \*Según Edwards 1967 en Lebrum Philippe. (1971)                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Pauropoda                             | ln P = -1,8749 + 2,3002 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Chilopoda                             | ln P = -6,7041 + 2,8420 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Persson and Lohm (1977) | Symphyla, Protura, Diplura            | P=(1,20+L)^3^                                      | 0,2                                     | P (peso en um)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en um)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Ganihar (1997)          | Ortóptera                             | ln P = -3,5338 + 2,4619 \* L                       | expresado en peso seco                  | P (peso en mg) = e ^ln P^                                                   |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Tita et al. (1999)      | Nematoda                              | P = ((530 \* L \* l^2^)\*1,084) \*0.25             | expresado en peso seco                  | P (peso en ug)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en um)                                                             |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | l (Ancho en um)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Hale et al. (1999)      | Crassiclitellata                      | ln (P~af~) = 2.6365\*ln(L)-12,6                    | expresado en peso seco libre de cenizas | P~af~ (Peso en miligramos)                                                  |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Greiner et al. (2010)   | Enquitreidos                          | ln (P~af~) = 1.10\*ln(L)-8,22                      | expresado en peso seco libre de cenizas | P~af~ (Peso en miligramos)                                                  |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en mm)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+
| Hallas y Yeates (1972)  | Tardigrado                            | P = L^3^\*9.076x10^-7^                             | expresado en peso seco                  | P (peso en ug)                                                              |
|                         |                                       |                                                    |                                         |                                                                             |
|                         |                                       |                                                    |                                         | L (Largo en um)                                                             |
+-------------------------+---------------------------------------+----------------------------------------------------+-----------------------------------------+-----------------------------------------------------------------------------+

## Apéndice 4.2. Distribución de los pesos corporales de la fauna edáfica

La **curva de acumulación empírica inversa** permite comparar la distribución de los datos observados con distribuciones teóricas.

Los datos observados, que se corresponden con cada uno de los pesos corporales, son los puntos que se acumulan desde  mayor a menor en función de la frecuencia acumulada, como puede verse en la figura 4.x.

La distribución acumulada inversa se contrastaron con las distribuciones teóricas exponencial, potencial exponencial, potencial exponencial truncada y logarítmica normal.

```{r pwrU, include=FALSE}

# Ajuste espectro con paquete Power Law
# Ajuste con paquete poweRlaw con Xmin ajustado

require(poweRlaw)
source("R/functions.r")

# Ajuste a partir del minimo de los datos, esto es, considerando que 
# el valor mínimo se encuentra dentro de los datos

dist_manejoU <- body_unlu %>% group_by(sitio) %>% summarise(evaluate_distr(body_mass,est_xmin=FALSE))

dist_manejoU %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo))

# Plots usando ggplot
#
dist_plotU <- body_unlu %>% group_by(sitio) %>% summarise(gplot=list(evaluate_distr(body_mass,est_xmin=FALSE,returnOBJ=TRUE)))

# Estimación para todos los datos

dist_totalU <- evaluate_distr(body_unlu$body_mass,est_xmin=FALSE)
dist_totalU %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo))

dist_plot_totU <- evaluate_distr(body_unlu$body_mass,est_xmin=FALSE,returnOBJ = TRUE) 

###########
#ROSANA
# Ajuste a partir del minimo de los datos, esto es, considerando que 
# el valor mínimo se encuentra dentro de los datos

dist_manejo <- meso %>% group_by(system) %>% summarise(evaluate_distr(biomass,est_xmin=FALSE))

dist_manejo %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo))

# Plots usando ggplot
#
dist_plot <- meso %>% group_by(system) %>% summarise(gplot=list(evaluate_distr(biomass,est_xmin=FALSE,returnOBJ=TRUE)))

# Estimación para todos los datos

dist_total <- evaluate_distr(meso$biomass,est_xmin=FALSE)
dist_total %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo))

dist_plot_tot <- evaluate_distr(meso$biomass,est_xmin=FALSE,returnOBJ = TRUE) 


require(cowplot)

prowU <- plot_grid(
  dist_plotU$gplot[1][[1]] + xlab("Peso corporal")  + theme(legend.position="none")+ theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL), 
  dist_plotU$gplot[2][[1]] + xlab("Peso corporal")  + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  dist_plotU$gplot[3][[1]]  + xlab("Peso corporal") + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  dist_plot_totU  + xlab("Peso corporal") + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  align = 'vh',
  nrow = 2,
  labels = c('A', 'P','R','T' )
  )
legend_b <- get_legend(
  dist_plotU$gplot[3][[1]] +
    guides(color = guide_legend(nrow = 2)) +
    theme(legend.position = "bottom")
)
pgU <- plot_grid(prowU, legend_b, nrow = 2, rel_heights = c(1, .1))

#save_plot("Figures/BodySizeSpectra_Landuses.png",pg,base_width=8,base_height=6,dpi=600)
#dist_plot$gplot[1][[1]] + xlab("Peso corporal")


prow <- plot_grid(
  dist_plot$gplot[1][[1]] + xlab("Peso corporal")  + theme(legend.position="none")+ theme(axis.text.x = element_text(angle = 50, hjust = 1))+ylab(NULL), 
  dist_plot$gplot[2][[1]] + xlab("Peso corporal")  + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  dist_plot$gplot[3][[1]]  + xlab("Peso corporal") + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  dist_plot_tot  + xlab("Peso corporal") + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 50, hjust = 1)) + ylab(NULL),
  align = 'vh',
  nrow = 2,
  labels = c('A', 'G','N','T' )
  )
legend_b <- get_legend(
  dist_plot$gplot[3][[1]] +
    guides(color = guide_legend(nrow = 2)) +
    theme(legend.position = "bottom")
)
pg <- plot_grid(prow, legend_b, nrow = 2, rel_heights = c(1, .1))




```

```{r aj, echo=FALSE, warning=FALSE, message=FALSE}
pgU

pg


```

En ambas localidades y entre los diferentes sistemas de uso los pesos corporales de todo el conjunto de datos ajustan a la distribución logarítmica normal conocida también como log-normal, esto tiene sentido si, se considera que cada especie tiene una distribución aproximadamente normal de sus pesos corporales pero cuyos valores no pueden ser menores o iguales que cero y también si, se considera la contribución multiplicativa de cada especie en el total de la comunidad. (.\@.log en biologia; .\@.potapov, sus bichos estaban distribuidos log normal.)

```{r tab_lg, echo=FALSE,warning=FALSE,message=FALSE}

dist_manejo1<-dist_manejo

names(dist_manejo1)<-c("sitio","type","expo","rate","xmin","AICc","range")
tbl_pln<-rbind(dist_manejoU %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo)),dist_manejo1 %>% filter(min(AICc)==AICc) %>% mutate(moda=exp(expo)))

t<-as.data.frame(tbl_pln[,c("sitio","type","AICc","moda","rate","expo","xmin")])

t


```

Esta distribución logarítmica normal ajusta a los datos de distribución empírica en todos los sistemas de uso del suelo.

## Apéndice 4.3. Reducción del modelo y verificación paramétrica de los modelos parsimoniosos de las relaciones entre biomasas medias de los taxones de los gremios en cada sistema de uso del suelo

**Algoritmo "step"**

El algoritmo "step" consiste en quitar secuencialmente el término más complejo del modelo completo,
aquél que contiene todas las interacciones, y comparar su valor de Akaike (AIC) con el del modelo original,
este procedimiento se realiza quitando los términos complejos uno a la vez y el procedimiento se detiene cuando el modelo ya no baja en su valor de AIC. 
De esta manera se tienen 3 situaciones, quedarse con el modelo completo (incluye todas las interacciones), llegar al modelo nulo (solo se queda con el intercepto y las pendientes) o quedarse con un modelo intermedio (con algunos términos ya sean interaciones, efectos o covarianzas).
Se considera que el modelo parsimonioso es aquel que tiene el menor valor de AIC, y este corresponde a un modelo con la mayor capacidad predictiva y a la vez con el menor número de parámetros.

**Modelo multifactorial, algoritmo "step": Biomasa media de la comunidad edáfica de suelos argiudoles de Luján**

```{r step_luján, echo=FALSE, warning=FALSE, message=FALSE}

#B.UNLU######
baseU<-baseU%>%mutate(Tbiomass=D*bio.ind)
#modelo completo
mU_p<-lm(log(Tbiomass) ~ sitio * gremio ,data = baseU)

step(lm(log(Tbiomass) ~ sitio * gremio ,data = baseU))



```

**Modelo multifactorial, gráficos de verificación paramétrica: Biomasa media de la comunidad edáfica de suelos argiudoles de Luján**

```{r plot_luján, echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
par(mfrow=c(2,2))
plot(lm(log(Tbiomass) ~ sitio * gremio ,data = baseU))
par(mfrow=c(1,1))
```


**Modelo multifactorial, algoritmo "step": Biomasa media de la comunidad de microartrópodos edáficos de suelos argiudoles de Chivilcoy y Navarro**

```{r step_chivilcoy, echo=FALSE, warning=FALSE, message=FALSE}
step(lm(log(Tbiomass) ~ system * guild, data = base))
mR_c<-lm(log(Tbiomass) ~ system * guild, data = base)
```

**Modelo multifactorial, gráficos de verificación paramétrica: Biomasa media de la comunidad de microartrópodos edáficos de suelos argiudoles de Chivilcoy y Navarro**


```{r plot_chivilcoy,echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
par(mfrow=c(2,2))
plot(lm(log(Tbiomass) ~ system * guild, data = base))
par(mfrow=c(1,1))

```

**Comparación entre pares**

Para las interacciones y los factores en los diferentes modelos se procedió a la comparacion 
entre pares, "diferencia de medias", se consideraron las medias marginales y 
los valores de probabilidad fueron corregidos
por Benjamini-Hochberg para evitar considerar comparaciones con error tipo I.

**Diferencias de medias, gremios tróficos de la comunidad edáfica en suelos de Luján**

```{r pair_gremio_L,echo=FALSE, warning=FALSE, message=FALSE}
emms_B_U1 <- emmeans::emmeans(mU_p, ~ gremio)
pairwise_comparisons_B_U1 <- contrast(emms_B_U1, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_B_U1)


```

Coefficients:
        (Intercept)      gremioherbivoro  gremiomicrofitofago       gremioomnivoro  
              13.03                -3.55                -1.16                -1.49  
     gremiopredador  
              -1.56  


**Diferencias de medias, sistemas de uso de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r pair_sistema_CN,echo=FALSE, warning=FALSE, message=FALSE}

emms_B_RO2 <- emmeans::emmeans(mR_c, ~ system)
pairwise_comparisons_B_RO2 <- contrast(emms_B_RO2, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_B_RO2)
```

**Diferencias de medias, gremios tróficos de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r pair_gremio_CN,echo=FALSE, warning=FALSE, message=FALSE}

emms_B_RO3 <- emmeans::emmeans(mR_c, ~ guild)
pairwise_comparisons_B_RO3 <- contrast(emms_B_RO3, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_B_RO3)

```


**Diferencias de medias, interacción sistemas de uso - gremios tróficos de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**


```{r pair_gremio:sistema_CN,echo=FALSE, warning=FALSE, message=FALSE}

emms_B_RO1 <- emmeans::emmeans(mR_c, ~ system:guild)
pairwise_comparisons_B_RO1 <- contrast(emms_B_RO1, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_B_RO1)
```


## Apéndice 4.4. Reducción del modelo de regresión de quartiles ($\tau=0.75$) que relaciona la densidad media y el peso corporal medio de los gremios tróficos de la comunidad edáfica en diferentes sistemas de uso en suelos argiudoles de la Pampa Ondulada.

**Reducción del modelo de regresión de cuartiles, algoritmo "step", de la comunidad edáfica del suelo de Luján**

```{r qq_red_luj, echo=FALSE, warning=FALSE, message=FALSE}
rq0<-rq(log(D) ~ (sitio+gremio+log(bio.ind))^3, tau = .75, data = baseU)
step(rq0)
#modelo full
rqU<-rq(log(D) ~ (sitio + gremio + log(bio.ind)+ sitio:gremio + gremio:log(bio.ind)) ,tau = .75, data = baseU)
#summary(rqU, se="boot")
```


**Reducción del modelo de regresión de cuartiles, algoritmo "step", de la comunidad de microartópodos edáficos de suelos de Chivilcoy y Navarro**

```{r qq_apendice, echo=FALSE, warning=FALSE, message=FALSE}
rq1<-rq(log(abundance) ~ (system+guild+log(bio.ind))^3, tau = .75, data = base)
step(rq1)
#modelo Ro
rqRO<-rq(log(abundance) ~ (system+guild+log(bio.ind))^3, tau = .75, data = base)
#summary(rqRO, se="boot")

#UNLu iteraciones####
# Definir los niveles deseados para sitio y gremio
niveles_sitio <- list(c("R", "P", "A"), c("P", "A", "R"), c("A", "P", "R"))
niveles_gremio <- list(c("herbivoro", "predador", "microfitofago", "detritivoro", "omnivoro"),
                       c("predador", "microfitofago", "detritivoro", "omnivoro", "herbivoro"),
                       c("microfitofago", "detritivoro", "omnivoro", "herbivoro", "predador"),
                       c("detritivoro", "omnivoro", "herbivoro", "predador", "microfitofago"),
                       c("omnivoro", "herbivoro", "predador", "microfitofago", "detritivoro"))

# Crear una lista para almacenar los resultados
resultados <- list()

# Iterar sobre los niveles de sitio y gremio
for (i in seq_along(niveles_sitio)) {
    for (j in seq_along(niveles_gremio)) {
        # Permutar los niveles de sitio y gremio
        nivel_sitio <- niveles_sitio[[i]]
        nivel_gremio <- niveles_gremio[[j]]
        
        # Aplicar la transformación y análisis de datos
        resultado <- baseU %>% 
            mutate(sitio = factor(sitio, levels = nivel_sitio),
                   gremio = factor(gremio, levels = nivel_gremio)) %>%
            rq(log(D) ~ sitio + gremio + log(bio.ind) + sitio:gremio + 
    gremio:log(bio.ind),
               tau = .75, data = .) %>%
            summary(., se = "boot")
        
        # Agregar el resultado a la lista
        resultados[[paste("sitio", i, "_gremio", j, sep = "")]] <- resultado
    }
}

# Acceder a los resultados
#resultados[["sitio1_gremio1"]]  # Por ejemplo, para el primer nivel de sitio y gremio

#Rosana iteraciones########

niveles_sitioR <- list(c("N", "G", "A"), c("G", "A", "N"), c("A", "N", "G"))
niveles_gremioR <- list(c("detritivore","microphytophages","omnivore","predator"),
                        c("microphytophages","omnivore","predator","detritivore"),
                        c("omnivore","predator","detritivore","microphytophages"),
                        c("predator","detritivore","microphytophages","omnivore"))

# Crear una lista para almacenar los resultados
resultadosR <- list()

# Iterar sobre los niveles de sitio y gremio
for (i in seq_along(niveles_sitioR)) {
    for (j in seq_along(niveles_gremioR)) {
        # Permutar los niveles de sitio y gremio
        nivel_sitio <- niveles_sitioR[[i]]
        nivel_gremio <- niveles_gremioR[[j]]
        
        # Aplicar la transformación y análisis de datos
        resultadoR <- base %>% 
            mutate(system = factor(system, levels = nivel_sitio),
                   guild = factor(guild, levels = nivel_gremio)) %>%
            rq(log(abundance) ~ (system + guild + log(bio.ind))^3,
               tau = .75, data = .) %>%
            summary(., se = "boot")
        
        # Agregar el resultado a la lista
        resultadosR[[paste("sitio", i, "_gremio", j, sep = "")]] <- resultadoR
    }
}

#resultadosR[["sitio1_gremio1"]] 

#readRDS("other_scripts/iteracion_QQregresion_rosana.rds")
```

## Apéndice 4.5. Prueba de a pares entre factores del modelo de regresión de quartiles ($\tau=0.75$) que relaciona la densidad media y el peso corporal medio de los gremios tróficos de la comunidad edáfica en diferentes sistemas de uso en suelos argiudoles de la Pampa Ondulada.

**Diferencias del 3er quantil, sobre el intercepto, entre sistemas de uso de la comunidad de fauna eáfica en suelos de Luján**

```{r L_qq1, echo=FALSE, warning=FALSE, message=FALSE}
emms_U1 <- emmeans::emmeans(rqU, ~ sitio)
pairwise_comparisons_U1 <- contrast(emms_U1, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_U1)

```

**Diferencias del 3er quantil, sobre el intercepto, entre gremios de la comunidad de fauna eáfica en suelos de Luján**

```{r L_qq2, echo=FALSE, warning=FALSE, message=FALSE}

emms_U2 <- emmeans::emmeans(rqU, ~ gremio)
pairwise_comparisons_U2 <- contrast(emms_U2, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_U2)


```

**Diferencias del 3er quantil, sobre el intercepto, entre sistemas de uso y gremios de la comunidad de fauna eáfica en suelos de Luján**

```{r L_qq3, echo=FALSE, warning=FALSE, message=FALSE}

emms_U3 <- emmeans::emmeans(rqU, ~ sitio:gremio)
pairwise_comparisons_U3 <- contrast(emms_U3, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_U3)

```


**Diferencias del 3er quantil, sobre la pendiente, entre gremios de la comunidad de fauna eáfica en suelos de Luján**

```{r L_qq4, echo=FALSE, warning=FALSE, message=FALSE}

emms_U4 <- emmeans::emmeans(rqU, ~ gremio:log(bio.ind))
pairwise_comparisons_U4 <- contrast(emms_U4, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_U4)

```


**Diferencias del 3er quantil, sobre la pendiente, entre gremios de la comunidad observados entre sistemas de uso de fauna edáfica en suelos de Luján**

```{r L_qq5, echo=FALSE, warning=FALSE, message=FALSE}


emms_U5 <- emmeans::emmeans(rqU, ~ sitio+gremio:log(bio.ind))
pairwise_comparisons_U5 <- contrast(emms_U5, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_U5)

```

**Diferencias del 3er quantil, sobre el intercepto, entre sistemas de uso de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**


```{r R_qq1, echo=FALSE, warning=FALSE, message=FALSE}

emms_RO5 <- emmeans::emmeans(rqRO, ~ system)
pairwise_comparisons_RO5 <- contrast(emms_RO5, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO5)

```

**Diferencias del 3er quantil, sobre el intercepto, entre gremios tróficos de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r R_qq2, echo=FALSE, warning=FALSE, message=FALSE}

emms_RO6 <- emmeans::emmeans(rqRO, ~ guild)
pairwise_comparisons_RO6 <- contrast(emms_RO6, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO6)

```

**Diferencias del 3er quantil, sobre el intercepto, entre sistemas de uso y gremios tróficos de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r R_qq3, echo=FALSE, warning=FALSE, message=FALSE}
emms_RO4 <- emmeans::emmeans(rqRO, ~ system:guild)
pairwise_comparisons_RO4 <- contrast(emms_RO4, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO4)
```

**Diferencias del 3er quantil, sobre la pendiente, entre gremios de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r R_qq4, echo=FALSE, warning=FALSE, message=FALSE}

emms_RO1 <- emmeans::emmeans(rqRO, ~ guild:log(bio.ind))
pairwise_comparisons_RO1 <- contrast(emms_RO1, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO1)

```

**Diferencias del 3er quantil, sobre la pendiente, entre sistemas de uso de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r R_qq5, echo=FALSE, warning=FALSE, message=FALSE}

emms_RO2 <- emmeans::emmeans(rqRO, ~ system:log(bio.ind))
pairwise_comparisons_RO2 <- contrast(emms_RO2, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO2)


```

**Diferencias del 3er quantil, sobre la pendiente, entre sistemas de uso y gremios de la comunidad de microartrópodos edáficos en suelos de Chivilcoy y Navarro**

```{r R_qq6, echo=FALSE, warning=FALSE, message=FALSE}
emms_RO7 <- emmeans::emmeans(rqRO, ~ system:guild:log(bio.ind))
pairwise_comparisons_RO7 <- contrast(emms_RO7, method = "pairwise", adjust = "BH")
summary(pairwise_comparisons_RO7)
```

