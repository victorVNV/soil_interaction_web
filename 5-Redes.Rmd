---
title: "5-Redes"
author: "Velazco"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE, message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
loadNamespace('printr')

```

```{r lib, include=FALSE,message=FALSE, warning=FALSE}

{library(tidyverse);library(statnet);library(network);
  library(igraph);library(intergraph);library(multiweb);library(fluxweb);
  library(kSamples);library(modeest)}
set.seed(167)
options("digits"=3)
```

# Introducción

En los ecosistemas las especies presentes se relacionan entre sí de
multiple maneras y estas relaciones configuran complejas redes de
interacciones (Montoya et al. 2001). Las redes de interacciones nos
muestran todas las posibles tramas en las que las especies pueden
interactuar (Delmas et al. 2019; Kéfi et al. 2012) esta pueden
caracterizarse en función del tipo de interacción que representan
describiendo así redes tróficas, redes de competidores, redes
mutualistas, entre otras (Labrador 2008; Montoya et al. 2001).

El enfoque que permite integrar la diversidad de especies, las
interacciones interespecíficas, las interacciones con el ambiente, la
redundancia funcional, el papel de las especies claves y la
multiplicidad de canales de materia y energia que ocurren en los
ecosistemas es estudio de la red de interacciones (.\@.barrios2007,
.\@.briones2014, .\@.potapov2023) que permite simplificar la complejidad
de interacciones y conectar con diferentes parámetros que emergen el
estudio de los ecosistemas (.\@.Hooperetal2005;.\@.delmas_etal2019)

En los suelos las redes de interacciones están influenciadas por
**factores de largo plazo** tales como el clima, las características
edáficas regionales y locales, la disponibilidad de recursos para los
organismos que en el habitan, las influencias biogeográficas sobre las
comunidades y por **factores de corto plazo** como las perturbaciones
antrópicas (Kardol et al. 2016) que ocurren debidas al manejo del suelo con fines agropecuarios,
por lo que resulta de particular interés
la respuesta de la estructura de las redes ante los distintos tipos de
disturbios y su relación con el funcionamiento del ecosistema del suelo
(Sabatté, 2011; Kardol et al., 2016).

Las redes tróficas permiten el análisis de las interacciones de
alimentación y es el enfoque más utilizado en ecología para describir
los canales por los cuales se mueve la materia y la energía (\@.citar)
Mediante el estudio de las redes tróficas se pueden reconocen las
especies claves y los grupos funcionales claves, definidos como el grupo
de especies con un papel semejante en el funcionamiento de un ecosistema
(Gitay y Noble, 1997) que permiten el mantenimiento de las funciones
ecológicas del suelo (\@.citar).

Las redes tróficas se apoya en la teoría de grafos en la que los nodos
(especies tróficas) y sus bordes (interacciones) determinan métricas
asociados con las redes empíricas tales como la conectividad, el grado
de correlación, la longitud de un camino trófico, etc., hasta variables
ecológicas de una comunidad en el que se incluyen por ejemplo la
riqueza, la diversidad, el máximo nivel trófico, la fracción de
omnívoros, la fracción de predación entre gremios, etc. (Digel et. al.
2014; Delmas 2019 et al. 2019; Maggioto et al. 2019).

Por lo tanto mediante el análisis se obtienen patrones generales sobre
la topología de la red y las consecuencias de estos patrones sobre la
dinámica de la comunidad y las especies constituyentes (Kéfi et al.
2012; Pimm et. al. 1991; Scheu 2001) y su estructura condiciona las
funciones en los ecosistemas (Montoya et al. 2001; Labrador 2008)

Como la estructura de las redes ecológicas condiciona el funcionamiento
intrínseco de un ecosistema (Labrador, 2008; Martín López et al., 2007)
la complejidad del entramado de la red trófica edáfica es un factor
clave en la estabilidad de los procesos del suelo (Sabatté, 2011;
Wardle, 1995) y por lo tanto en el estado de conservación del mismo que
será mayor cuanto mayor sea la estabilidad de la red de interacciones.

En las redes ecológicas las conexiones características son aquellas en
las que unas pocas especies poseen un gran número de enlaces por lo
tanto la mayoría de las especies poseen pocas conexiones (Delmas et al.
2019; Montoya et al. 2001; Pimm et al. 1991) y este es el modo en que la
diversidad biológica y el funcionamiento de los ecosistemas están
ligados (Balvanera et al., 2006).

Los grupos funcionales con especies redundantes (Martín-López 2007)
permitirán una mayor capacidad de respuesta ante las perturbaciones ya
que asegura el mantenimiento de las funciones en el ecosistema (Delmas
et al. 2019; Montoya et al. 2001; Pimm et al. 1991) y de este modo que
se puede mantener la estructura, el funcionamiento y los mecanismos de
autorregulación del ecosistema (Martín-Lopez 2007) pero la desaparición
de especies muy conectadas puede producir extinciones secundarias y
fragmentaciones de la red (Montoya et al. 2001)

Los estudios de redes de interacciones proporcionan información acerca
de la estructura autoorganizada de los ecosistemas (Momo 2018); en las
redes tróficas del suelo se busca comprender los efectos sobre la
descomposición de la materia orgánica y el ciclo de nutrientes (Scheu
2002) y otras funciones del ecosistema edáfico (\@citar) que son tema
central de los investigadores al centrarse en los flujos de energía y en
las redes tróficas de las comunidades de diferentes sistemas de uso del
suelo (Scheu 2002; potapov2023(historicalperspe)).

La comprensión de la estructura y topología de la red se constituye en
una herramienta útil para describir y cuantificar la complejidad de los
ecosistemas y de cómo las comunidades de la mesofauna edáfica responden
a las perturbaciones asociadas al manejo del suelo (Delmas et al. 2019;
Maggioto et. al. 2019)

Digel et al. (2014) utilizó las redes tróficas de 48 comunidades del
suelo de bosques alemanes y comparó 22 parámetros de las métricas y
topología de las redes tróficas entre las comunidades del suelo y las
comunidades de ecosistemas acuáticos y terrestres. En la Argentina
Maggioto et al. (2019) utilizaron las herramientas del análisis de las
redes tróficas del suelo para estudiar los efectos de forestar
pastizales naturalizados de la Pampa Húmeda. En este estudio, compararon
11 parámetros entre 2 sitios forestados y un pastizal naturalizado.

En ambos casos el análisis de la estructura de las redes fue realizado
comparando diferentes comunidades ó diferentes manejos del suelo,
hallando características particulares para cada comunidad y coinciden en
que la estructura general de las redes no varía considerablemente según
el uso del suelo, aunque en los sitios bajo estudio no implicaron
manejos de suelos en el que hubiera prácticas agrícolas intensivas.

.\@.potapov2023 declara que el uso de las redes tróficas es una
herramienta esencial que debe ser utilizada en los ecosistemas
terrestres para comprender el funcionamiento del ecosistema del suelo,
ya que une los aspetos relacionados con la diversidad específica, la
diversidad de rasgos, la diversidad funcional y los aspectos que se
relacionan con la estabilidad y resiliencia de estos sistemas.

Por otra parte, en las redes de interacciones, pueden relacionarse rasgos
como el peso corporal y atributos poblacionales
como la abundancia de los taxones con los nodos de la red, lo que permite relacionar 
parámetros fisiológicos como el metabolismo y el uso de los recursos,
con parámetros ecológicos tales como las interacciones tróficas y las
adaptaciones de estos organismos ante cambios en el ambiente
[.\@.pey2014; .\@.white2007; .\@.turnbull2014].

Pretendemos comparar las métricas estruturales, los
flujos de energía vinculados a las redes tróficas y la estabilidad estructural 
de las redes tróficas de la
fauna del suelo entre ambientes con distintas intensidades en el tiempo
de uso del suelo.

En este contexto, el presente trabajo busca comparar la estabilidad
estructural de las redes de tróficas de la fauna del suelo de suelos
Argiudoles típicos de la Pampa Ondulada entre ambientes con distintas
estrategias en el uso del suelo, como aproximación a distintas
intensidades de perturbación: a) suelos sin uso agropecuario, tales como
un pastizal naturalizado sin uso por mas de 50 años o un lote clausurado
sin uso por más de 30 años, que servirán como sistema de referencia; b)
suelos con uso pastoril como forraje para el ganado considerados como
sistemas con intensidad de uso intermedio o leve; y c) suelos con
actividad agrícola contínua considerado como sistema con intensidad de
uso alta.

<!--, una sin uso de suelo correspondiente a un pastizal naturalizado que servirá como sistema de referencia y un sistema de alta perturbación que se corresponde con un sistema agrícola intensivo con más de 50 años de actividad ininterrumpida.-->

Para la construcción y el modelado de la red de interacciones tróficas
de la fauna del suelo es necesario conocer las comunidades que
habitan los diferentes ambientes, los recursos tróficos que estos animales utilizan 
para poder modelar la matriz de interacciones tróficas (.\@.delmas_etal_2019), 
el peso  corporal y la densidad de los taxas involucrados
(.\@.laigle_etal_2018) que permite conocer las fuerzas de
interacciones(.\@.deRuiter_etal_1995), los flujos de energía através de
la red (.\@.potapov2023, .\@.barnes_etal_2017) y calcular la resiliencia
y estabilidad de los sistemas bajo estudio (.\@.mooreandderutier_2018,
.\@.gauzen_etal_2018, .\@.allisina_etal_2008).

Entonces a partir de un suelo definido como referencia donde se
consideran que se encuentran características de un suelo no disturbado,
se podrían comparar parámetros estructurales y funcionales de la
comunidad de la fauna edáficas que permitan evaluar la estabilidad de la
red de interacciones como indicadora del estado de conservación del
suelo y determinar a través de su estudio la sustentabilidad de los
sistemas de manejo [@bedano2007; @socarras2013].

# Metodología

## Construccion de la red

Se construyo una matriz de interacciones tróficas cuyos nodos son todos
los taxones hallados en ambas comunidades de la fauna de suelo y sus interacciones
se establecen a partir de la evidencia empírica ($gamma\; [\gamma]$). 
A partir de la matriz de interacciones global se
seleccionan los actores que corresponden a cada comunidad en particular
definiendo de esta manera matrices de interacciones para cada sistema de
uso del suelo ($alpha \;[\alpha]$).

Se utilizaron como **atributos de nodos**, esto es, valores numéricos,
nominales o categóricos que describen una característica del nodo en
particular, atributos que se correspondan con los taxones hallados en los diferentes
sistemas de uso del suelo, los valores de pesos corporales, las biomasas
medias y las densidades medias. (Ver tablas 4.x al x).

Se asumieron algunos parámetros para nodos que se corresponden a
recursos tróficos base (.\@.velazco,.\@.potapov_multichanel) basados en
evidencia bibliográfica, estos nodos, o no han sido medidos como por
ejemplo en los datos de comunidades edáficas de los suelos argiudoles de
Chivilcoy y Navarro, o, debido a su complejidad son dificiles de
cuantificar.

Para el recurso trófico "humus" se considera que la materia orgánica
es el proxi de la cantidad del recurso que se corresponde
con el nodo "Hummus" y en general esta se corresponde con el 50% de la
materia orgánica del suelo para suelos de la pampa ondulada (Álvarez
2006 (cap3);Biological indicator of Soil Healt pp 70 - 71), para
calcular su biomasa esta se refiere a la superficie en metros cuadrados,
utilizando la densidad aparente de suelos y referidas hasta los 10
centímetros de profundidad, zona en la cuál se encuentra la mayor
proporción del contenido en materia orgánica; 
Para los organismos de la microflora y la microfauna Digel (.-\@.Digel.2014),
quien evaluó las características topológicas de decenas de redes de
diferentes ecosistemas y las comparó con redes tróficas de los suelos de
bosques de la región Paleártica en el material suplementario indica que
el peso promedio de las bacterias del suelo es $9,5\, x \,10^{-16} g$,
indica también el peso promedio de cada uno de los principales grupos de
protozoos del suelo,tardígrados, rotíferos y otra microfauna que en
conjunto que resultó en $1,1121 \,x\,10^{-10} g$ <!--3.3363e-1-->; el
peso promedio de los hongos son relevados por metro lineal de las hifas
como sugiere Pilar et al. (2016) y que resulta en un valor de
$2,3 \,x\,7\,^{-10} g\,m^{-2}$.

Las biomasas medias de bacterias, hongos y microfauna no nemátoda, son
aproximadas mediante la biomasa media calculada a partir de la
respiración de los heterótrofos (capítulo 3 comunidad, imagen o
tabla, ecuación), de esta biomasa media se considera que el 50% es el
recurso efectivamente disponible para los consumidores , entonces, para
ambos suelos argiudoles se consideró que el 2 % de la biomasa
corresponde a la microfauna no nemátoda
(.\@.cita_energetical.significance?), para suelos los suelos de Luján se
utilizó la relación de hongos y bacterias para calcular la biomasa de
estos actores sobre el 48% restantes de la biomasa media de los
heterótrofos, en los suelos de Chivilcoy y Navarro se consideró el 45%
de la respiración para calcular las biomasas de bacterias y hongos dado
que el 3% será utilizado para estimar la biomasa de nemátodos, en
sistemas agrícolas intensivos se asumió 35% de bacterias, en el sistema
mixto agrícola ganadero se asumió 30% de bacterias y para el pastizal
naturalizado se asumió una contribución de bacterias del 25% (.\@.buscar
cita sobre relación entre hongos y bacterias en sistemas del suelo)

Para el caso de los nemátodos de vida libre del suelo para el conjunto
de datos de los suelos argiudoles de Luján se utilizaron los valores de
abundancia y peso medio a partir de la evidencia empírica recabada. En
cambio, para los argiudoles de Chivilcoy y Navarro se utilizaron las
relaciones de proporción promedio de nemátodos observados en los
sistemas del suelo Argiudol de Luján, por lo tanto, nemátodos
fungívoros, bacteríofagos, fitófagos, omnívoros y predadores, fueron
referidos al 40,30,14,8 y 8 % respectivamente, a la vez se consideró que
los nemátodos en relación a la biomasa heterotrófica se corresponden con
el 3% (.\@.agregar cita).

Teniendo la relación entre las biomasas y los pesos corporales medios de
los actores se calculan las densidades de aquellos nodos que no tuvieron
una determinación directa.

De los recursos tróficos base, en algunos casos pudo estimarse su
biomasa, a saber, el recurso hojarasca fué calculado para suelos de
Luján pero no en Chivilcoy y Navarro, el humus como dicho más arriba fué
calculado para ambas localidades, la carroña fue estimada a partir del
peso de todos los invertebrados presente en los diferentes sistemas de
uso y que pueden dejar carroña, considerando un 5% de carroña sobre la
biomasa de invertebrados pausibles de dejar carroña una vez sucedida su
decesión, finalmente el tejido vegetal que incluye raices y exudados
(Cap 2.1. Recursos tróficos) no fué determinado.

Para los recursos bases se asume que su densidad y su peso son iguales a
1 a los fines de realizar cálculos de fuerzas de interacción
(.\@.pawar?; .\@.alesina; .\@.fluxweb)

## Métricas y estadísticas

A partir de la matriz de interacciones, para cada red trófica, se
calcularon los índices topológicos, es decir, aquellas medidas
calculadas a partir de la arquitectura de la red que la describen
matemáticamente y ecológicamente, estas medidas son calculadas como
caracterísiticas relativas a la red como un todo o como características
relativas a los nodos de la red. 

El **tamaño de la red** que indica el
número de, nodos y especies tróficas a la vez; el <u>número</u> y la
<u>densidad</u> de **enlaces** que implica a la vez, el número total en
la red de interacciones tróficas y la densidad de interacciones tróficas
que refleja la proporción de interacciones por nodo referidas al total;
el **largo de caminos** es el valor promedio de conexiones o "caminos"
que se recorre a lo largo de los nodos de un grafo (en este caso, red
trófica); la **conectancia** es la proporción de enlaces efectivamente
realizados en la red trófica en relación al total de conecciones
potenciales del grafo con el mismo tamaño; el **agrupamiento o clustering** 
mide un coeficiente que indica la magnitud en los cuales
existe pequeños agrupamientos, denominados también como "camarillas",
entre nodos en la red.

El **nivel trófico** es el número que define la posición en la cuál se
encuentra una especie trófica, aquí se indican el **nivel trófico medio** 
de la red y el **nivel trófico máximo** de la red; se
identifican por su posición en la red el número de especies **basales**
aquellas que no consumen a otras especies tróficas y el número de
especies **tope** quienes no tienen predadores que los consuman; el
número de especies **canibales** aquellas especies que consumen a
individuos de la misma especie trófica; la **omnivoría** que mide la
proporción de especies omnívoras, es decir, la proporción de especies
tróficas que se alimentan (o se enlazan) de más de un nivel trófico, y
el **nivel de omnivoría** que indica el valor promedio, en términos de
nivel trófico, sobre los cuales se alimentan los omnívoros; desde el
punto de vista de la especie trófica se miden la **vulnerabilidad** y la
**generalidad**, que implican el número promedio de predadores que tiene
un nodo trófico y el número medio de presas que consumen un nodo
trófico, respectivamente.

Se calcularon las fuerzas de interacciones entre los actores (e.i.
especies tróficas) utilizando la teoría metabólica y la dimensionalidad
de las interacciones, método descrito por Pawar (2012-\@pawar2012), que
precisa del peso corporal promedio y las densidades de los taxones que
conforman las especies tróficas, y de la dimensionalidad de las
interacciones, que en redes detritívoras del suelo corresponden a la
dimensionalidad del tipo "2D". El valor de la fuerza de interacción
cuantifica el efecto que tienen los depredadores/consumidores sobre la
biomasa de las presas/recursos y lo expresa como el efecto por unidad de
biomasa del predador/consumidor.

Como valor de estabilidad se utilizará el valor de estabilidad de
quasi-signo (\@alesina et al.201x). Para hallar este valor se toma la
estructura de signos de la matriz de adyacencia original que describe a
la red trófica en cuestión, y, realiza aleatorizaciones de las fuerzas
de interacción entre los nodos manteniendo la estructura de los signos,
luego calcula los autovalores de la matriz Jacobiana, matriz que
representa el efecto neto de la interacción entre pares de
nodos(\@Delmasetal2019), para cada una de las aleatorizaciones; una red
trófica localmente estable tendrá todos sus autovalores negativos y su
valor de estabilidad es aquel autovalor con el máximo valor (i.e. más
cercano a cero), por otra parte, el máximo autovalor en matrices con
autovalores mayores a cero es también una medida de estabilidad dando la
noción de distancia (*autoregulación*), a la cual se encuentra la red
evaluada para lograr la estabilidad local.

Se calculó también los flujos de energía entre los nodos de la red asumiendo un estado
estable, en el que las pérdidas energéticas son compensadas con las ganancias energéticas.
Para ello es necesario conocer los pesos corporales medios de los nodos tróficos,
la tasa metabólica estimada mediante $tasa metabólica = 17.17\; peso^{-0.29}$ y la biomasa media de 
los mismos nodos. Con los flujos de energía se pueden caracterizar procesos ecológicos relacionados
con la clasificación funcional de las especies tróficas, estos flujos de energía son expresados para cada
interacción en Joules/año.

Para realizar comparaciones entre redes tróficas se utilizó la
comparación de las distribuciones del máximo autovalor del algoritmo de quasisigno 
mediante la prueba de Anderson-Darling que permite identificar diferencias estadísticamente
significativas

Para realizar comparaciones entre redes tróficas se utilizó la comparación de distribuciones
del máximo autovalor de quasisigno para identificar diferencias 
estadísticamente significativas.
, mediante el algoritmo de Curveball se establecen redes
de interacciones que mantienen la conectividad, el numero de enlaces y
la cantidad de especies basales y tope, para evaluar las características
topológicas de las redes tróficas del sistema detritívoro edáfico.

Se utilizó el pequete ["multiweb"](https://github.com/lsaravia/multiweb)
para calcular las métricas de topología, las fuerzas de interacciones y
la estabilidad de las redes tróficas, además se utilizó el paquete
["fluxweb"](https://bit.ly/2OC0uKF) para calcular los flujos de energía
y también se utilizaron paquetes complementarios para manejo de datos y
la comparación estadística de los parámetros calculados, todos ellos
implementados en R.

```{r dtb,include=FALSE,message=FALSE, warning=FALSE}
#Carga datos, comunidad completa, abundancia, pesos corporales medios, de suelos UNLu
SFW_unlu <- read.delim("database/unlu_ab_mass_mean_web.txt")
#carga datos, suelos ROSANA, Chivilcoy y Navarro
completo <- readxl::read_excel("database/soil_networks.xlsx", sheet = "Ro_web")
```

```{r densidad_unlu,include=FALSE,message=FALSE, warning=FALSE}
#microfauna (se contaron los nemátodos de 4 sacabocados)
sup.bocado.micro <- (1/(pi*2.5^2/10000))*4
#mesofauna (se contaron y extrajeron de 3 frasquitos homojeneizados del monolito)
sup.bocado.meso <- (1/(pi*2.5^2/10000))*3
#macrofauna (superficie estandar 25 x 25)
sup.monolito <- 1/(0.25*0.25)
# calculo la densidad en n7m2 y la biomasa en ug/m2

unlu_D<-SFW_unlu%>%
  mutate(nombre=paste(sitio,replica))%>%
           mutate(
             D=floor(case_when(
  size_class=="macro"~ sup.monolito*abundance,
  size_class=="meso"~ sup.bocado.meso*abundance,
  size_class=="micro"~ sup.bocado.micro*abundance)
  ),
  biomass=body_mass*D
  )
#previo a la red, todas las modificaciones sobre este
web<-unlu_D%>%
  group_by(nombre,sitio,replica,taxa)%>%
  summarise(body=mean(body_mass,na.rm=TRUE),
            biomass=mean(biomass,na.rm=TRUE))%>%
  distinct(taxa,.keep_all=TRUE)

```

```{r recurso_base_unlu,include=FALSE,message=FALSE, warning=FALSE}
#agrega recursos####
#se utilizaron la biomasa estimada por m2 hasta los 5 cm
#esto se puede justificar con el gráfico de libros donde la biomasa disminuye con la profundidad
#sino se puede hacer de 5 en 5 con biomasas acumulativas cada vez menores

#recursos base, hongo, bacteria, protozoa
sitio<-c("L","L","L","P","P","P","R","R","R",
         "L","L","L","P","P","P","R","R","R",
         "L","L","L","P","P","P","R","R","R")
replica<-c(1,2,3,1,2,3,1,2,3,
           1,2,3,1,2,3,1,2,3,
           1,2,3,1,2,3,1,2,3)
taxa<-c("bac","bac","bac","bac","bac","bac","bac","bac","bac",
        "fungi","fungi","fungi","fungi","fungi","fungi","fungi","fungi","fungi",
        "proto","proto","proto","proto","proto","proto","proto","proto","proto")

#los recursos disponibles para consumo del total, serán el 50% de la biomasa microbiana
# de ello se proporciona para bacterias y hongos según la relación hongo bacterias

# acá utilio la relacion hongos bacterias
# 1-(relaciónHB/(1+relacionHB)) = bacterias
# (relaciónHB/(1+relacionHB)) = hongos
# de la "biomasa total" el 50% disponible, de los cuales 5% es protozoos y 45% seran hongos y bacterias.
# se multiplican el 45 que es disponible por la proporcion HB previamente calculada, o lo que es

#esto fué previamente mostrado en cap 3
#relacion H/B####
ratio.hb<-c( 3.25, 14/3, 5/6, #Agrícola #promedio H = 0.745
             11/8, 11/6, 7/6, #Pastizal H = 0.593
            2.429, 11/6, 3.5 #Reserva H=0.721
                       ) 

biomass<-c(31182224*0.45*(1-(3.25/(1+3.25))),10506443*0.45*(1-(14/3/(1+14/3))), #bacterias
           68378710*0.45*(1-(5/6/(1+5/6))),
           117115935*0.45*(1-(11/8/(1+11/8))),90987488*0.45*(1-(11/6/(1+11/6))),
           131508231*0.45*(1-(7/6/(1+7/6))),
           56295276*0.45*(1-(2.429/(1+2.429))),
           90096858*0.45*(1-(11/6/(1+11/6))),
           38740835*0.45*(1-(3.5/(1+3.5))),
           
          101342228*0.45*((3.25/(1+3.25))),147090202*0.45*((14/3/(1+14/3))), #hongos
          56982258*0.45*((5/6/(1+5/6))),
          161034411*0.45*((11/8/(1+11/8))),166810394*0.45*((11/6/(1+11/6))),
          153426270*0.45*((7/6/(1+7/6))),
          136717098*0.45*((2.429/(1+2.429))),
          165177572*0.45*((11/6/(1+11/6))),
          135592922*0.45*((3.5/(1+3.5))),
          
          132524452*0.05,157596645*0.05,125360968*0.05, #protozoos
          278150346*0.05,257797882*0.05,284934501*0.05,
          193012374*0.05,255274430*0.05,174333757*0.05)


rec_base<-data.frame(sitio,replica,taxa,biomass)
rec_base<-rec_base%>%
             mutate(
             body=case_when(
  taxa=="bac"~ 9.5e-4, #peso medio bacteria, segun digel, en ug
  taxa=="fungi"~ 2.3e-1, # Andres Pilar et al 2016. soilfoodweb prairie
  taxa=="proto"~ 1.1121e-3)#peso medio, segun digel y en microgramos
  )
  
rec_base<-rec_base%>%
  mutate(nombre=paste(sitio,replica))

rec_base<-rec_base[,c("nombre","sitio","replica","taxa","body","biomass")]

web<-rbind(rec_base, web)

#subred sin recursos############

web0<-web%>%
  group_by(sitio,taxa)%>%
  summarise(body=mean(body,na.rm=TRUE),
            biomass=mean(biomass,na.rm=TRUE))%>%
  distinct(taxa,.keep_all=TRUE)
#######

#eficiencias############

#Adaptado de COLEMAN y Energetic Fluxweb, como eficiencias de producción
# bacteria hongo 30%
#nemátodos 

mf<-c("bac","fungi")
micf<-c("alycidae", "diplura","brachychthonioidea","crotonioidea",
        "oribatido","limnozetidae",
  "Aporrectodea caliginosa","Aporrectodea rosea","Bimastos parvus",
  "Aporrectodea trapezoides","Bimastos beddardi sophiae",
   "ceratozetoidea","cryptophagidae","enchytraeida","entomobridae",
  "epilhomanioidea","eremobelbidae","Eukerria halophila","galumnidae",
   "Glossoscolex sp.","isotomidae","juvenil","macropilina","Microscolex phosphoreus","Octalasion lacteum","Microscolex dubius","Eukerria stagnalis",
  "nem_bacterivoro", "nem_fitofago","nem_fungivoro","Octalasion cyaneum",
  "Octolasion tyrtaeum","onichiuridae","oppioidea","oribatulidae",
  "oripodidae","protura","scheloribatidae","symphyla","symphypleona"
  )
pred<-c("ameroseidae","arctacaridae","bdelloidea","carabidae",
  "coccinelidae","cunaxide","dermanisoidea","eviphididae",
  "geophylomorpha","grillopalpidae","ichtyostomatogasteridae", "laelapidae", "larva_carabidae","linyphiidae","lycosidae","nem_predador","mesostigmata",
  "ologamasidae","parasitidae",  "pseudoscorpionida",
  "rhagidiidae","rhodacarioidea","staphiliniidae","teneriffidae",
  "trombidiidae", "uropodoidea","veigaioidea") 
det<-c("anthribidae","blattodea","gasteropoda","diplopoda","elateriforme",
  "embrioptera","eupthiracaroidea","larva_coleoptero","isoptera",
 "larva_diptera","larva_elateridae","larva_scarabidae","larva_sciaridae",
  "larva_tenebrionidae","limnozetidae","oniscidea","ptilidae","pupa_diptera",
 "tenebrionidae","terebrantia","trogossitidae")
herb<-c("aphidoidea","cicadidae","coleoptera_suctor","hemiptero","larva_curculionidae",
   "ortoptero","thysanoptera")
omn<-c("astigmata","formicidae","hipogastruridae","nem_omnivor","tardigrado",
       "anystidae","eupodoidea","penthalidae","tarsonemidae","tydeioidea","proto")

no_a<-c("nematomorpha") 


#A vector or an array of conversion efficiencies of species in the adjacency matrix. #These values describe the proportion of consumed energy that is converted to #biomass of the consumer.-->

web0$ef<-NA
web0$ef[web0$taxa%in%mf]<-0.3
web0$ef[web0$taxa%in%micf]<-0.35
web0$ef[web0$taxa%in%pred]<-0.4
web0$ef[web0$taxa%in%det]<-0.2
web0$ef[web0$taxa%in%herb]<-0.125
web0$ef[web0$taxa%in%omn]<-0.25
web0$ef[web0$taxa%in%no_a]<-0.2

#sistemas####### 
L<-web0%>%filter(sitio=="L")
P<-web0%>%filter(sitio=="P")
R<-web0%>%filter(sitio=="R")

#biomasas####
#en microgramos pasados a gramos
#tejido vegetal se asume 125% (1+125/100) mas que la materia orgánica aunque puede ser 225% más
#finalmente no se asume la biomasa del tejido vegetal, será 1.
#carroña será el 5% de la biomasa total de los invertebrados
#hojarasca llevada a peso seco, factor de 0.32 P ; 0.37 R ; 0.28 L
bm_L<-c(L$biomass,
        (77.0321/0.0625)*0.28*1e6, #Hojarasca
        mean(L[L$taxa!="fungi"&L$taxa!="bac"&L$taxa!="proto",]$biomass)*0.05, #Carroña
        1*1e6,#2.25*0.0273*1.2*50000*1e6,#Tej_veg
        0.4*0.0273*1.2*50000*1e6)/1e6#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_R<-c(R$biomass,
        55.753/0.065*0.37*1e6, #Hojarasca
        mean(R[R$taxa!="fungi"&R$taxa!="bac"&R$taxa!="proto",]$biomass)*0.05, #carroña
        1*1e6,#2.25*0.0352*1.2*50000*1e6, #tej_veg
        0.4*0.0352*1.2*50000*1e6)/1e6 #"humus" = POM = 0.4MO
bm_P<-c(P$biomass,
        (58.63/0.0625)*0.32*1e6, #Hojarasca
        mean(P[P$taxa!="fungi"&P$taxa!="bac"&P$taxa!="proto",]$biomass)*0.05, #carroña
        1*1e6,#2.25*0.0352*1.2*50000*1e6, #Tej_veg
        0.4*0.0309*1.2*50000*1e6)/1e6 #Humus

#Pesos corporales####
body_L<-c(L$body/1e6,1,1,1,1)
body_R<-c(R$body/1e6,1,1,1,1)
body_P<-c(P$body/1e6,1,1,1,1)


ef_L<-c(L$ef,1,1,1,1)
ef_P<-c(P$ef,1,1,1,1)
ef_R<-c(R$ef,1,1,1,1)


t_metR<- 17.17*body_R^(-0.29)
t_metR[is.na(t_metR)|t_metR==Inf]<-0
t_metP<- 17.17*body_P^(-0.29)
t_metP[is.na(t_metP)|t_metP==Inf]<-0
t_metL<- 17.17*body_L^(-0.29)
t_metL[is.na(t_metL)|t_metL==Inf]<-0

#reducido Lujan####

meso.reduc<-c("juvenil","Aporrectodea caliginosa",
     "Aporrectodea rosea","Aporrectodea trapezoides",
     "Bimastos beddardi sophiae","Bimastos parvus",
     "Eukerria halophila","Glossoscolex sp.","Octalasion lacteum", "Microscolex dubius",
     "Eukerria stagnalis","Microscolex phosphoreus","Octalasion cyaneum","Octolasion tyrtaeum","bac","fungi","alycidae", "brachychthonioidea","crotonioidea",
        "oribatido","limnozetidae",
   "ceratozetoidea","entomobridae",
  "epilhomanioidea","eremobelbidae","galumnidae",
   "isotomidae","macropilina",
  "nem_bacterivoro", "nem_fitofago","nem_fungivoro","onichiuridae","oppioidea",
  "oribatulidae",
  "oripodidae","scheloribatidae","symphypleona",
  "ameroseidae","arctacaridae","bdelloidea","cunaxide","dermanisoidea","eviphididae",
  "ichtyostomatogasteridae", "laelapidae", "nem_predador","mesostigmata",
  "ologamasidae","parasitidae","rhagidiidae","rhodacarioidea",
  "teneriffidae",
  "trombidiidae", "uropodoidea","veigaioidea","eupthiracaroidea","limnozetidae",
  "astigmata","hipogastruridae","nem_omnivor","anystidae","eupodoidea","penthalidae",
  "tarsonemidae","tydeioidea","proto")


Rf.r<-R[R$taxa%in%meso.reduc,]
Pf.r<-P[P$taxa%in%meso.reduc,]
Lf.r<-L[L$taxa%in%meso.reduc,]

#biomasas red####
#todos excepto carroña y humus igual a uno, para fines de comparacion entre sistemas y localidads
bm_Lf.r<-c(Lf.r$biomass,
        1*1e6, #Hojarasca
        mean(Lf.r[Lf.r$taxa!="fungi"&Lf.r$taxa!="bac"&Lf.r$taxa!="proto",]$biomass)*0.05, #Carroña
        1*1e6,#2.25*0.0273*1.2*50000*1e6,#Tej_ve
        0.4*0.0273*1.2*50000*1e6)/1e6#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_Rf.r<-c(Rf.r$biomass,
        1*1e6, #Hojarasca
        mean(Rf.r[Rf.r$taxa!="fungi"&Rf.r$taxa!="bac"&Rf.r$taxa!="proto",]$biomass)*0.05, #carroña
        1*1e6,#2.25*0.0352*1.2*50000*1e6, #tej_veg
        0.4*0.0352*1.2*50000*1e6)/1e6 #"humus" = POM = 0.4MO
bm_Pf.r<-c(Pf.r$biomass,
        1*1e6, #Hojarasca
        mean(Pf.r[Pf.r$taxa!="fungi"&Pf.r$taxa!="bac"&Pf.r$taxa!="proto",]$biomass)*0.05, #carroña
        1*1e6,#2.25*0.0352*1.2*50000*1e6, #Tej_veg
        0.4*0.0309*1.2*50000*1e6)/1e6 #Humus

#Pesos corporales####
body_Lf.r<-c(Lf.r$body/1e6,1,1,1,1)
body_Rf.r<-c(Rf.r$body/1e6,1,1,1,1)
body_Pf.r<-c(Pf.r$body/1e6,1,1,1,1)


ef_Lf.r<-c(Lf.r$ef,1,1,1,1)
ef_Pf.r<-c(Pf.r$ef,1,1,1,1)
ef_Rf.r<-c(Rf.r$ef,1,1,1,1)


t_metRf.r<- 17.17*body_Rf.r^(-0.29)
t_metRf.r[is.na(t_metRf.r)|t_metRf.r==Inf]<-0
t_metPf.r<- 17.17*body_Pf.r^(-0.29)
t_metPf.r[is.na(t_metPf.r)|t_metPf.r==Inf]<-0
t_metLf.r<- 17.17*body_Lf.r^(-0.29)
t_metLf.r[is.na(t_metLf.r)|t_metLf.r==Inf]<-0

```

```{r datosRO, include=FALSE,message=FALSE, warning=FALSE}

#representan 166 registros macrofauna / 8662 registros totales
#lombrices 1454 / 8662 totales, pero correctamente muestreados
#densidad suelo 1,2g/cm2, volumen 1e5 cm3, peso suelo, 120 000 g suelo
#(resp*100)/24; resp*4,167; 1200 suelo/100g suelo; 20600 ug/100g suelo;
#resp*4.167*1200*20600= resp*103008240

completo$biomasaheterotrofa<-completo$RESP*103008240
base<-completo%>%filter(class!="macrofauna")
#Es el factor de conversión para llevar las abundancias a densidad

#Densidad de los demás es 2.5²*3.14 = n()/0,00471 
sup.bocado <- 1/(pi*2.5^2/10000)
#Densidad de lombrice en 25*25 = a n()/0.0625
sup.monolito <- 1/(0.25*0.25)


#ro por sitio###### 

#A partir de aqui determina las abundancias
base.sitio<-base%>%group_by(system,site,class,order,specie) %>%
  summarise(abundance=n(), bio.ind=mean(biomass),
            bm=(max(biomasaheterotrofa)),POM=mean(POM))%>%distinct(specie,.keep_all=TRUE)
#bm=(mean(bm))
#densidad y biomasa
ab.sitio<-base.sitio%>%
  mutate(D=case_when(order=="crassiclitellata"~sup.monolito*abundance,
                     order!="crassiclitellata"~sup.bocado*abundance),
         BT=case_when(order=="crassiclitellata"~sup.monolito*abundance*bio.ind,
                      order!="crassiclitellata"~sup.bocado*abundance*bio.ind))

#acá agrego biomasa microbiana total, como bmt, pero la biomasa disponible la dejo en 50% como bm, 
#ya que es el criterio anteriormente dado. 
#entonces hongos y bacterias trabajan sobre el 45% y microfauna sobre el 5%
#buscar las citas con estas relaciones
base1 <-ab.sitio %>% group_by(system,site) %>%  
  summarise(humus=mean(POM),bmt=(mean(bm)))%>% 
  mutate(bacteria=case_when(system=="A"~bmt*0.45*0.35,
                            system=="G"~bmt*0.45*0.3,system=="N"~bmt*0.45*0.25),
         hongo=(bmt*0.45)-bacteria,
         microfauna=(0.03*bmt), #3% microfauna, 2% nemátodos
         nem_f=(0.02*bmt*0.4),nem_b=(0.02*bmt*0.3),nem_phy=(0.02*bmt*0.14),
         nem_pr=(0.02*bmt*0.08),nem_om=(0.02*bmt*0.08))%>%distinct(site,.keep_all=TRUE)

# matriz red
mRO<-ab.sitio[,c("system","site","specie","bio.ind","D","BT")]
mRO_rec<-base1%>% 
  pivot_longer(cols = c("humus","bacteria","hongo","microfauna","nem_f",
                        "nem_b","nem_phy","nem_pr","nem_om"),
              names_to = "specie",
              values_to = "BT"
              )
#en pivot longer no usar, distinct(site,.keep_all=TRUE), porque elimina las observaciones con las
#mismas filas y columnas

#en microgramos
{mRO_rec$bio.ind<-NA
mRO_rec[mRO_rec$specie=="humus","bio.ind"]<-1
mRO_rec[mRO_rec$specie=="bacteria","bio.ind"]<-9.5e-4
mRO_rec[mRO_rec$specie=="hongo","bio.ind"]<-2.3e-1
mRO_rec[mRO_rec$specie=="microfauna","bio.ind"]<-1.1121e-3 #3.3363e-1 # este sale de promediar, 
                                          #lo que los protozoos "pesan"

#para los nemátodos utilizo el promedio GLOBAL de peso de los encontrados en suelos de Luján

#fitófago, luján 1.02ug, 
#fungivoro, luján 5,184 ug, 
#bacterivoro, luján 1,854, 
#omnivoro, luján 16,89 ug, 
#predador, luján 4,58 ug, 
mRO_rec[mRO_rec$specie=="nem_b","bio.ind"]<-1.854
mRO_rec[mRO_rec$specie=="nem_f","bio.ind"]<-5.184
mRO_rec[mRO_rec$specie=="nem_phy","bio.ind"]<-1.02
mRO_rec[mRO_rec$specie=="nem_om","bio.ind"]<-16.89
mRO_rec[mRO_rec$specie=="nem_pr","bio.ind"]<-4.58
#elijo solo los recursos y le asigno nombre

mRO_rec$D<-mRO_rec$BT/mRO_rec$bio.ind}
mRO_rec<-mRO_rec[c("system","site","specie","bio.ind","D","BT")]

#matriz Rosana. Completo con recursos
mRO<-rbind(mRO,mRO_rec)
#corregir nombres de taxas para que sean simlares
{
mRO$specie[mRO$specie=="acaroidea"]<-"astigmata"
mRO$specie[mRO$specie=="Apo_cal"]<-"Aporrectodea caliginosa"
mRO$specie[mRO$specie=="Apo_ros"]<-"Aporrectodea rosea"
mRO$specie[mRO$specie=="Apo_tra"]<-"Aporrectodea trapezoides"
mRO$specie[mRO$specie=="hongo"]<-"fungi"
mRO$specie[mRO$specie=="bacteria"]<-"bac"
mRO$specie[mRO$specie=="dermanyssoidea"]<-"dermanisoidea"
mRO$specie[mRO$specie=="entomobroidea"]<-"entomobridae"
mRO$specie[mRO$specie=="epilohmannioidea"]<-"epilhomanioidea"
mRO$specie[mRO$specie=="euker"]<-"Eukerria stagnalis" #agregar
mRO$specie[mRO$specie=="euphthiracaroidea"]<-"eupthiracaroidea"
mRO$specie[mRO$specie=="galumnioidea"]<-"galumnidae"
mRO$specie[mRO$specie=="humus"]<-"hummus"
mRO$specie[mRO$specie=="hypogastruridae"]<-"hipogastruridae"
mRO$specie[mRO$specie=="lom_juv"]<-"juvenil"
mRO$specie[mRO$specie=="Mic_pho"]<-"Microscolex phosphoreus"
mRO$specie[mRO$specie=="Mic_dub"]<-"Microscolex dubius" #agregar
mRO$specie[mRO$specie=="microfauna"]<-"proto"
mRO$specie[mRO$specie=="nem_b"]<-"nem_bacterivoro"
mRO$specie[mRO$specie=="nem_f"]<-"nem_fungivoro"
mRO$specie[mRO$specie=="nem_phy"]<-"nem_fitofago"
mRO$specie[mRO$specie=="nem_om"]<-"nem_omnivor"
mRO$specie[mRO$specie=="nem_pr"]<-"nem_predador"
mRO$specie[mRO$specie=="octacy"]<-"Octalasion cyaneum"
mRO$specie[mRO$specie=="octala"]<-"Octalasion lacteum" #agregar
mRO$specie[mRO$specie=="onychiuridae"]<-"onichiuridae"
#oribatido agregar
mRO$specie[mRO$specie=="oripodoidea"]<-"oripodidae"
mRO$specie[mRO$specie=="parasitoidea"]<-"parasitidae"
mRO$specie[mRO$specie=="rhodacaroidea"]<-"rhodacarioidea"
mRO$specie[mRO$specie=="trombidioidea"]<-"trombidiidae"
mRO$specie[mRO$specie=="tydeoidea"]<-"tydeioidea"

}

webRO<-mRO%>%
  group_by(system,specie)%>%
  summarise(body=mean(bio.ind,na.rm=TRUE),
            d=mean(D,na.rm=TRUE),
            biomass=mean(BT,na.rm=TRUE))%>%
  distinct(specie,.keep_all=TRUE)

webRO$ef<-NA
webRO$ef[webRO$specie%in%mf]<-0.3
webRO$ef[webRO$specie%in%micf]<-0.35
webRO$ef[webRO$specie%in%pred]<-0.4
webRO$ef[webRO$specie%in%det]<-0.2
webRO$ef[webRO$specie%in%omn]<-0.25
webRO$ef[webRO$specie=="humus"]<-1


N<-webRO%>%filter(system=="N")
G<-webRO%>%filter(system=="G")
A<-webRO%>%filter(system=="A")

#Pesos corporales
body_N<-c(N$body/1e6,1,1,1)
body_G<-c(G$body/1e6,1,1,1)
body_A<-c(A$body/1e6,1,1,1)

#eficiencias

ef_N<-c(N$ef,1,1,1)
ef_N[is.na(ef_N)]<-1
ef_G<-c(G$ef,1,1,1)
ef_G[is.na(ef_G)]<-1
ef_A<-c(A$ef,1,1,1)
ef_A[is.na(ef_A)]<-1

t_metN<- 17.17*body_N^(-0.29)
t_metN[is.na(t_metN)|t_metN==Inf]<-0
t_metG<- 17.17*body_G^(-0.29)
t_metG[is.na(t_metG)|t_metG==Inf]<-0
t_metA<- 17.17*body_A^(-0.29)
t_metA[is.na(t_metA)|t_metA==Inf]<-0

#biomasas
#el hummus ya se calculó
#la carroña se calcula igual que en el anterior
#no informacion sobre los demás
bm_N<-c(N$biomass,
        1*1e6, #Hojarasca
        mean(N[N$specie!="fungi"&N$specie!="bac"&N$specie!="proto",]$biomass)*0.05, #Carroña
        1*1e6#Tej_veg
        )/1e6#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo

bm_G<-c(G$biomass,
        1*1e6, #Hojarasca
        mean(G[!G$specie%in%c("fungi","bac","proto"),]$biomass)*0.05, #Carroña
        1*1e6#Tej_veg
        #G$biomass[G$specie=="hummus"]
        )/1e6 #humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_A<-c(A$biomass,
        1*1e6, #Hojarasca
        mean(A[A$specie!="fungi"&A$specie!="bac"&A$specie!="proto",]$biomass)*0.05, #Carroña
        1*1e6#Tej_veg
)/1e6

```

```{r Gamma_matrix, include=FALSE,message=FALSE, warning=FALSE}
# agregados: crotonioidea; Octalasion lacteum; Microscolex dubius;
# Eukerria stagnalis; brachychthonioidea
# provenientes de la comunidad Rosana

webG<-web%>%
  group_by(taxa)%>%
  distinct(taxa,.keep_all=TRUE)

#vector de nodos
sp_G<-c("litter","carrion","tej_veg","hummus",
        "isoptera","crotonioidea","Octalasion lacteum",
        "Microscolex dubius","Eukerria stagnalis",
        "brachychthonioidea","oribatido",levels(as.factor(webG$taxa)))

mG<-matrix(nrow = length(sp_G),ncol = length(sp_G),
           dimnames = list(sp_G,sp_G))
#reemplazar NA por ceros

mG[is.na(mG)] <- 0

#matriz interacciones####

{
#Microflora#####
mG["bac",c("hummus","litter","carrion")]<-1
mG["fungi",c("hummus","tej_veg","carrion","litter")]<-1
#Microfauna
mG["proto",c("bac","hummus","proto","tej_veg")]<-1
mG[c("enchytraeida","tardigrado"),c("bac","hummus","proto","fungi")]<-1
mG[c("enchytraeida"),c("litter")]<-1
mG["nem_predador",c("nem_predador","nem_omnivor","nem_fitofago",
                    "nem_bacterivoro","nem_fungivoro","proto","tardigrado")]<-1
mG["nem_omnivor",c("nem_fitofago","nem_bacterivoro","nem_fungivoro","proto",
                   "tardigrado","bac","fungi","hummus")]<-1
mG["nem_fitofago","tej_veg"]<-1
mG["nem_fungivoro","fungi"]<-1
mG["nem_bacterivoro","bac"]<-1


#lombrices#####
mG[c("juvenil","Aporrectodea caliginosa",
     "Aporrectodea rosea","Aporrectodea trapezoides",
     "Bimastos beddardi sophiae","Bimastos parvus",
     "Eukerria halophila","Glossoscolex sp.","Octalasion lacteum", "Microscolex dubius",
     "Eukerria stagnalis","Microscolex phosphoreus","Octalasion cyaneum","Octolasion tyrtaeum"),
   c("litter","bac","fungi","proto","hummus")]<-1
#varios####
mG["astigmata",c("bac","fungi","nem_fitofago",
                    "nem_bacterivoro","nem_fungivoro","proto")]<-1

mG["coccinelidae",c("aphidoidea","thysanoptera","terebrantia","cicadidae")]<-1

mG[c("aphidoidea","coleoptera_suctor","thysanoptera","hemiptero",
     "cicadidae","ortoptero","terebrantia","embrioptera"),
   c("tej_veg")]<-1 #este aparece, pero tal vez no se alimente¿?

#grandes detritivoros#####
mG[c("oniscidea","blattodea","diplopoda","gasteropoda",
     "larva_coleoptero","larva_tenebrionidae","larva_curculionidae",
     "larva_diptera",
     "larva_elateridae","larva_scarabidae","larva_sciaridae",
     "pupa_diptera","trogossitidae","cryptophagidae",
     "ptilidae","elateriforme","tenebrionidae","anthribidae"),
   c("fungi","litter","carrion")]<-1

#Mesostigmatas predadores####

#arctacaridae in the review not information of this group
#Krantz say " it may represent the sister group of the gamasine subcohorrs 
# Parasitiae and Dermanyssiae, 
#eviphididae, laelapidae, ologamasidae, parasitidae, veigaioidea

mG[c("arctacaridae","dermanisoidea","eviphididae", 
     "ichtyostomatogasteridae","laelapidae","ologamasidae", 
     "parasitidae", "veigaioidea","rhagidiidae","bdelloidea",
     "cunaxide","teneriffidae","trombidiidae"),
   c("enchytraeida","nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","astigmata",
     "limnozetidae","ceratozetoidea","diplura","entomobridae",
     "epilhomanioidea","eremobelbidae","eupthiracaroidea",
     "galumnidae","hipogastruridae","isotomidae","larva_diptera",
     "larva_sciaridae","onichiuridae","oppioidea","oribatulidae",
     "oripodidae","protura", "scheloribatidae","symphyla",
     "symphypleona", "teneriffidae","tardigrado",
     "alycidae", "anystidae","macropilina","ameroseidae",
     "arctacaridae","dermanisoidea","eviphididae", 
     "ichtyostomatogasteridae","laelapidae","ologamasidae", 
     "parasitidae", "veigaioidea",
     "bdelloidea","penthalidae","cunaxide","trombidiidae",
     "eupodoidea","tydeioidea","alycidae","anystidae","tarsonemidae",
     "rhodacarioidea","teneriffidae","rhagidiidae",
     "uropodoidea")]<-1
#arctacaridae segun Krantz dieta similar a Parasitidae
#dermanisoidea una amplia superfamilia, en ella estan los Laelapidae, Ascoidea, etc,
#mesostigmtas nematófagos
mG[c("uropodoidea","mesostigmata"),c("nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto","tardigrado")]<-1

#mesostigmatas pequeños
mG[c("rhodacarioidea"),
   c("nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","tardigrado",
     "onichiuridae","hipogastruridae","isotomidae","symphypleona",
     "protura","diplura","symphyla",
     "entomobridae","enchytraeida")]<-1 #se alimentan solo de colembolos, 
                                        #evitando acaros
#####
#Prostigmatas omnivoro, excepto ameroseidae que es mesostigmata
mG[c("eupodoidea","ameroseidae","penthalidae","tydeioidea",
     "alycidae","anystidae","tarsonemidae"),
   c("bac","fungi","carrion",
     "nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","tardigrado",
     "onichiuridae","hipogastruridae","isotomidae","symphypleona",
     "entomobridae","symphyla","protura","diplura","astigmata")]<-1

mG[c("ameroseidae"),
   c("bac","carrion")]<-0

#Macro predadores#####
#
# acaros, colembolos, otros microartrópodos
mG[c("carabidae","staphiliniidae","pseudoscorpionida"),
   c("enchytraeida","astigmata","limnozetidae","ceratozetoidea","diplura",
     "entomobridae","epilhomanioidea","eremobelbidae","eupthiracaroidea","eupodoidea",
     "eviphididae","galumnidae","hipogastruridae","isotomidae",
     "mesostigmata","laelapidae","larva_diptera","larva_sciaridae",
     "ologamasidae","parasitidae","bdelloidea","onichiuridae","oppioidea",
     "oribatulidae","oripodidae","protura", "scheloribatidae","symphyla",
     "symphypleona", "teneriffidae","rhodacarioidea","tardigrado",
     "rhagidiidae","tydeioidea","uropodoidea","veigaioidea","arctacaridae",
     "bdelloidea","penthalidae","cunaxide","trombidiidae",
     "ameroseidae","arctacaridae","dermanisoidea", 
     "ichtyostomatogasteridae","macropilina","eupodoidea","tydeioidea","alycidae",
     "anystidae","tarsonemidae","teneriffidae")]<-1

#japyjapidae
mG[c("diplura"),c("protura","symphyla","onichiuridae","isotomidae","enchytraeida",
                  "entomobridae","hipogastruridae","carrion","proto")]<-1
#"bac","fungi", para los dipluras no carnívoros


mG["larva_carabidae",c("enchytraeida","nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto","diplura",
                   "astigmata","protura","symphyla","onichiuridae","isotomidae","carrion",
                  "entomobridae","hipogastruridae","tardigrado","larva_diptera","larva_sciaridae",
                  "oppioidea","oripodidae","scheloribatidae","rhodacarioidea","eupodoidea")]<-1
#come colembolos, larvas,pequeños acaros
#cienpies: todo tipo de artrópodo conforman su presa

mG["geophylomorpha",c("alycidae","anystidae","ameroseidae","bdelloidea","cunaxide",
                      "arctacaridae","enchytraeida","astigmata","limnozetidae",
                      "ceratozetoidea", "diplura","entomobridae",
                      "dermanisoidea","ichtyostomatogasteridae","macropilina",
                   "epilhomanioidea","eremobelbidae","eupthiracaroidea","eupodoidea",
                   "eviphididae","galumnidae","hipogastruridae","isotomidae",
                 "mesostigmata","laelapidae","larva_coleoptero","larva_curculionidae",
                 "larva_diptera","larva_elateridae","larva_sciaridae",
                 "ologamasidae","parasitidae","blattodea","carabidae",
                 "onichiuridae","oppioidea","oribatulidae","penthalidae",
                   "oripodidae","protura", "scheloribatidae","symphyla",
                   "symphypleona", "teneriffidae","rhodacarioidea","tardigrado",
                  "rhagidiidae","tydeioidea","uropodoidea","veigaioidea",
                 "aphidoidea","cicadidae","coleoptera_suctor","cryptophagidae",
                 "diplopoda","juvenil","elateriforme","hemiptero","larva_carabidae",
                 "ptilidae","staphiliniidae","thysanoptera","trogossitidae",
                   "tarsonemidae","tenebrionidae","terebrantia","trombidiidae"
                  )]<-1

#arácnidos 
mG[c("linyphiidae","lycosidae"),
   c("coccinelidae","aphidoidea","arctacaridae","astigmata",
     "limnozetidae","blattodea","carabidae","grillopalpidae",
     "ceratozetoidea","cicadidae","coleoptera_suctor","cryptophagidae",
     "cunaxide","diplura","elateriforme","entomobridae",
     "eremobelbidae","eupodoidea","eviphididae","macropilina","ortoptero",
     "formicidae","galumnidae","geophylomorpha","penthalidae","tenebrionidae",
     "hemiptero","hipogastruridae","isotomidae",
     "laelapidae","mesostigmata","ologamasidae",
     "oribatulidae","oripodidae","parasitidae",
     "ptilidae","staphiliniidae","symphyla","dermanisoidea",
     "symphypleona","thysanoptera","trogossitidae",
     "tydeioidea","uropodoidea","veigaioidea","anthribidae",
     "embrioptera","terebrantia","trombidiidae"
     )]<-1

#topogrillo
mG["grillopalpidae",c("carrion","bac","fungi","tej_veg","enchytraeida",
                      "nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto",
                   "diplura","entomobridae","hipogastruridae","isotomidae",
                  "onichiuridae","oppioidea","oripodidae","protura",
                  "symphyla","symphypleona","rhodacarioidea","tardigrado"
                  )]<-1
#hormigas, predadores generalistas.
#Atacan lombrices
#"carrion","fungi","tej_veg",
#se quitan los acaros y colembolos que escapan, por su capacidad de vivir en los poros y pequeño tamaño

mG["formicidae",c("Aporrectodea caliginosa","Aporrectodea rosea",
                  "Aporrectodea trapezoides","Bimastos beddardi sophiae",
                  "Eukerria halophila","Glossoscolex sp.",
                  "Bimastos parvus","arctacaridae","limnozetidae","embrioptera","grillopalpidae",
                  "macropilina","Microscolex phosphoreus",
                  "Octalasion cyaneum",
                  "Octolasion tyrtaeum","ortoptero","penthalidae",
                      "ceratozetoidea", "diplura","entomobridae",
                   "epilhomanioidea","eremobelbidae","eupthiracaroidea",
                   "eviphididae","galumnidae","hipogastruridae","isotomidae",
                 "mesostigmata","laelapidae","larva_coleoptero","larva_curculionidae",
                 "larva_diptera","larva_elateridae","larva_sciaridae",
                 "ologamasidae","parasitidae","bdelloidea","blattodea","carabidae",
                 "onichiuridae","oribatulidae","pupa_diptera",
                   "protura","symphyla",
                   "symphypleona", "teneriffidae",
                  "rhagidiidae","tydeioidea","uropodoidea","veigaioidea",
                 "aphidoidea","cicadidae","coleoptera_suctor","cryptophagidae",
                 "diplopoda","juvenil","elateriforme","hemiptero","larva_carabidae",
                 "ptilidae","staphiliniidae","thysanoptera","trogossitidae",
                 "alycidae","ameroseidae","anthribidae","anystidae","coccinelidae",
                 "tenebrionidae","terebrantia"
                  )]<-1

#parasito de grandes insectos
mG["nematomorpha",c("aphidoidea","blattodea","carabidae",
    "cicadidae","coleoptera_suctor","cryptophagidae",
    "elateriforme","hemiptero","ptilidae","staphiliniidae","thysanoptera","trogossitidae")]<-1


#microfitofagos
mG[c("macropilina","limnozetidae","oribatido",
     "scheloribatidae","oripodidae","oribatulidae",
     "protura","eremobelbidae","oppioidea","brachychthonioidea"),
   c("bac","fungi","hummus")]<-1
#macrofitofago
mG[c("symphypleona","crotonioidea"),c("bac","fungi","hummus","tej_veg","litter")]<-1
mG[c("epilhomanioidea","eupthiracaroidea","isoptera"),c("litter")]<-1
mG[c("isoptera"),c("hummus","fungi")]<-1
#macrofitofago omnivoro
mG[c("ceratozetoidea","onichiuridae","isotomidae",
     "scheloribatidae","symphyla"),
   c("bac","fungi","hummus","carrion","litter","tej_veg","nem_fungivoro",
     "nem_bacterivoro")]<-1
#omnivoro
mG[c("entomobridae"),c("bac","fungi","nem_bacterivoro","nem_fungivoro")]<-1


mG["galumnidae",c("carrion","nem_fitofago","tardigrado",
                   "nem_bacterivoro","nem_fungivoro","proto","bac","fungi")]<-1

mG["hipogastruridae",c("nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto",
                   "tardigrado","bac","fungi","carrion")]<-1
###

mG[c("protura","symphyla"),c("carrion","bac","fungi","proto")]<-1

mG["ptilidae",c("hummus","fungi","carrion","bac","proto","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro")]<-1


#diagonal de la matriz 0, y dejar solo las interacciones canibalistas "reales"

diag(mG)<-0

mG["proto","proto"]<-1
mG["geophylomorpha","geophylomorpha"]<-1
mG["nem_predador","nem_predador"]<-1

 }

#Vector para reducir la red a mesofauna, 
#se incluyen las bacterias, hongos, protozoos y nematodos, que son a la vez recursos
#vector con 67 taxas

```


```{r redes, include=FALSE, message=FALSE, warning=FALSE}


#Red Lote UNLu
L_net <-graph_from_adjacency_matrix(t(mG[c(L$taxa,"litter","carrion","tej_veg","hummus"),c(L$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Reserva UNLu
R_net <-graph_from_adjacency_matrix(t(mG[c(R$taxa,"litter","carrion","tej_veg","hummus"),c(R$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Pastizal UNLu
P_net <-graph_from_adjacency_matrix(t(mG[c(P$taxa,"litter","carrion","tej_veg","hummus"),c(P$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )

#Datos de ácaros - colémbolos -lombrices - y respiración heterotrófica
#Red Pastizal Naturalizado RO
N_net <-graph_from_adjacency_matrix(t(mG[c(N$specie,"litter","carrion","tej_veg"),c(N$specie,"litter","carrion","tej_veg")]),mode=c("directed") )
#Red mixto Agrícola Ganadero RO
G_net <-graph_from_adjacency_matrix(t(mG[c(G$specie,"litter","carrion","tej_veg"),c(G$specie,"litter","carrion","tej_veg")]),mode=c("directed") )
#Red agrícola intensivo RO
A_net <-graph_from_adjacency_matrix(t(mG[c(A$specie,"litter","carrion","tej_veg"),c(A$specie,"litter","carrion","tej_veg")]),mode=c("directed") )
#Reducción de redes####
#a acaros colembolos
L.r<-as_vector(L[L$taxa%in%meso.reduc,"taxa"][[1]])
L_reduc.net <-graph_from_adjacency_matrix(t(mG[c(L.r,"litter","carrion","tej_veg","hummus"),c(L.r,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Reserva UNLu
R.r<-as_vector(R[R$taxa%in%meso.reduc,"taxa"][[1]])
R_reduc.net <-graph_from_adjacency_matrix(t(mG[c(R.r,"litter","carrion","tej_veg","hummus"),c(R.r,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Pastizal UNLu
P.r<-as_vector(P[P$taxa%in%meso.reduc,"taxa"][[1]])
P_reduc.net <-graph_from_adjacency_matrix(t(mG[c(P.r,"litter","carrion","tej_veg","hummus"),c(P.r,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )

```

# Resultados
## Parámetros estructurales de las redes tróficas de suelos Argiudoles
Las redes de interacciones de los suelos Argiudoles tienen 4 recursos
tróficos denominados también como especies base, estos son, el tejido
vegetal que engloba a las raices y sus exudados, la hojarasca, el humus
y la carroña que en conjunto son denominados como detritos.

El tamaño de las red trófica en suelos de Luján fué mayor en el sistema
del pastizal con un mayor número y densidad de enlaces (Tabla 5.x),
seguidos por la Reserva. A pesar del mayor número de especies tróficas
en el pastizal, el número de especies tope fue el menor como así también
el porcentaje de omnivoría, para ambos parámetros el mayor valor se
observa en la Reserva.

```{r plot_redes, echo=FALSE, warning=FALSE,message=FALSE}
par(mfrow=c(1,3))
plot_troph_level(R_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Reserva")
plot_troph_level(P_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Pastizal")
plot_troph_level(L_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Agrícola")
par(mfrow=c(1,1))
```

El nivel trófico promedio de las redes en suelos argiudoles de Luján
ente los tres sistemas de uso fué de aproximadamente 2,95 y con respecto
al máximo nivel trófico este fué mayor en el pastizal seguido por el
sistema agrícola intensivo, el nivel de omnivoría sigue un patron
similar Pastizal\>Sistema agrícola\>Reserva.

```{r topolog, echo=FALSE, message=FALSE, warning=FALSE}

#topologico####
# índices topológicos
#calc_topological_indices(Gl_net)
topological<-rbind(
calc_topological_indices(R_net),
calc_topological_indices(P_net),
calc_topological_indices(L_net),colnames=NULL)

topological1<-rbind(
calc_topological_indices(N_net),
calc_topological_indices(G_net),
calc_topological_indices(A_net),

calc_topological_indices(R_reduc.net),
calc_topological_indices(P_reduc.net),
calc_topological_indices(L_reduc.net),colnames=NULL
)
topological$Sistema<-c("Reserva","Pastizal","Agrícola intensivo")
topolog<-topological[,c("Sistema","Size","Links","Top","Omnivory","LOmnivory",
                        "TLmax","TLmean","Connectance","LD",
                        "Clustering","Vulnerability","Generality"	)]
colnames(topolog)<-c("Sistema","Tamaño","nº enlaces","Tope","% Omnivoría","Nivel de Omnivoría",
                        "Nivel trófico","Nivel trófico promedio","Conectancia","Densidad de enlaces",
                        "Clustering","Vulnerabilidad","Generalidad"	)

topological1$Sistema<-c("Pastizal naturalizado", "Mixto agrícola ganadero", "Agrícola intensivo","Reserva","Pastizal","Agrícola intensivo")
topolog1<-topological1[,c("Sistema","Size","Links","Top","Omnivory","LOmnivory",
                        "TLmax","TLmean","Connectance","LD",
                        "Clustering","Vulnerability","Generality"	)]
colnames(topolog1)<-c("Sistema","Tamaño","nº enlaces","Tope","% Omnivoría","Nivel de Omnivoría",
                        "Nivel trófico","Nivel trófico promedio","Conectancia","Densidad de enlaces",
                        "Clustering","Vulnerabilidad","Generalidad"	)
kableExtra::kable(topolog)


```

La densidad de enlaces, la conectancia y el clusterin fueron mayores en
el pastizal naturalizado seguido por el sistema agrícola, mismo
comportamiento se observa con los valores de Generalidad y
Vulnerabilidad.

El tamaño de la red en suelos de Chivilcoy y Navarro fué similar en los
tres sistemas de uso, con una especie trófica menos en la pastizal
naturalizado, de manera similar el número de especies tope fué similar
entre los sistemas de uso con una especie menos en el sistema Agrícola
intensivo.

Tanto el máximo nivel trófico como el nivel trófico medio fué mayor en
el sistema agrícola intensivo y menor en el pastizal naturalizado.

```{r topolog_reduc,echo=FALSE,message=FALSE,warning=FALSE}
kableExtra::kable(topolog1)
```

Hubo un mayor número de interacciones en el sistema agrícola intensivo
al igual que en otros parámetros como la densidad de enlaces, la
conectancia, el clusterin, la vulnerabilidad y la generalidad. El
sistema mixto agrícola ganadero y el pastizal naturalizado tuvieron
valores similares en conectancia y clustering. En el sistema mixto en
comparación con el pastizal naturalizado se observaron un mayor número y
densidad de enlaces, mayores valores de vulnerabilidad y generalidad y
un mayor nivel trófico medio.

Comparando las redes de los suelos argiudoles de Luján con los suelos
argiudoles de Chivilcoy y Navarro, puede observarse que en general los
parámetros tienen mayores valores en los suelos de Luján y esto puede
relacionarse con tamaños de la red con más actores y una mayor cantidad
de interacciones entre estos, la excepción ocurre con las especies topes
cuyo número fue mayor en los suelos de Chivilcoy y Navarro.

```{r plot_redes2, echo=FALSE, warning=FALSE,message=FALSE}
par(mfrow=c(1,3))

plot_troph_level(N_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Pastizal")
plot_troph_level(G_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Mixto")
plot_troph_level(A_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE,main="Agrícola")

par(mfrow=c(1,1))
```

```{r interaction_strenght, include=FALSE}

#Los pesos ya se configuran con 1e-3 para convertir los gramos a kilogramos. Pawar así lo calcula
#RESERVA
{#genero el edge list
edge_R_net <- as.data.frame(as.matrix(R_net, "edgelist"))
names(edge_R_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(R$taxa,"litter","carrion","tej_veg","hummus"),peso=body_R*1e-3,
                 densidad=bm_R/body_R)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 
v_ig[v_ig$nombre=="hummus","peso"]<-1 
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 
v_ig[v_ig$nombre=="hummus","densidad"]<-1

# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_R_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_R_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_R_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_R_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_R_net$dimension<-"2D"
}
#edge_list_UNLu[edge_list_UNLu$peso_recurso==0|edge_list_UNLu$peso_recurso==-999,"peso_recurso"]<-1e-15
#edge_list_UNLu[edge_list_UNLu$peso_consumidor==0|edge_list_UNLu$peso_consumidor==-999,"peso_consumidor"]<-1e-15
#error



#PASTIZAL#####
{#genero el edge list
edge_P_net <- as.data.frame(as.matrix(P_net, "edgelist"))
names(edge_P_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(P$taxa,"litter","carrion","tej_veg","hummus"),peso=body_P*1e-3,densidad=bm_P/body_P)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_P_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_P_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_P_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_P_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_P_net$dimension<-"2D"
}


#LOTE AGRICOLA#####
{#genero el edge list
edge_L_net <- as.data.frame(as.matrix(L_net, "edgelist"))
names(edge_L_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(L$taxa,"litter","carrion","tej_veg","hummus"),peso=body_L*1e-3,densidad=bm_L/body_L)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_L_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_L_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_L_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_L_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_L_net$dimension<-"2D"
}


#N = PASTIZAL NATURALIZADO ####
{#genero el edge list
edge_N_net <- as.data.frame(as.matrix(N_net, "edgelist"))
names(edge_N_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(N$specie,"litter","carrion","tej_veg"),peso=body_N*1e-3,densidad=bm_N/body_N)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_N_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_N_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_N_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_N_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_N_net$dimension<-"2D"
}


#G: Ganadero mixto ####
{#genero el edge list
edge_G_net <- as.data.frame(as.matrix(G_net, "edgelist"))
names(edge_G_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(G$specie,"litter","carrion","tej_veg"),peso=body_G*1e-3,densidad=bm_G/body_G)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_G_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_G_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_G_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_G_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_G_net$dimension<-"2D"
}


#A: Agricola intensivo ####
{#genero el edge list
edge_A_net <- as.data.frame(as.matrix(A_net, "edgelist"))
names(edge_A_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(A$specie,"litter","carrion","tej_veg"),peso=body_A*1e-3,densidad=bm_A/body_A)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_A_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_A_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_A_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_A_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_A_net$dimension<-"2D"
}



```

```{r IS, echo=FALSE}
#Ya tengo todos los componentes solicitados

# Para detritos litter, carrion, etc. el tamaño del recurso res_mm y la densidad del recurso res_den están desacoplados del tamaño del consumidor, hay que asignar 1 a ambos

#el peso debe ser utilizado como en kilogramos,
#como esto está en microgramos será 1e-9
#fuerza interacción UNLu#####
IS_R1<-calc_interaction_intensity(da=edge_R_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_P1<-calc_interaction_intensity(da=edge_P_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_L1<-calc_interaction_intensity(da=edge_L_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )

#fuerza interaccion Chivilcoy####
IS_N1<-calc_interaction_intensity(da=edge_N_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_G1<-calc_interaction_intensity(da=edge_G_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_A1<-calc_interaction_intensity(da=edge_A_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
#fuerza interaccion unlu reducido####
red.edge_R_net<-edge_R_net[edge_R_net$consumidor%in%meso.reduc&
                             edge_R_net$recurso%in%meso.reduc,]
red.edge_P_net<-edge_P_net[edge_P_net$consumidor%in%meso.reduc&
                             edge_P_net$recurso%in%meso.reduc,]
red.edge_L_net<-edge_L_net[edge_L_net$consumidor%in%meso.reduc&
                             edge_L_net$recurso%in%meso.reduc,]
#calculo ISS
IS_R.r<-calc_interaction_intensity(da=red.edge_R_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_P.r<-calc_interaction_intensity(da=red.edge_P_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_L.r<-calc_interaction_intensity(da=red.edge_L_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )

```

```{r QSS_IS, echo=FALSE}
#multiplicar qRC por la densidad el consumidor para que de la fuerza de interaccion total, sino es por unidad de peso del consumidor

#Reserva
IS_R<-IS_R1[,c(1,2,11)]
names(IS_R)<-c("recurso","consumidor","weight")
IS_R_net<-graph_from_data_frame(IS_R,directed = TRUE, vertices =NULL)
#Pastizal
IS_P<-IS_P1[,c(1,2,11)]
names(IS_P)<-c("recurso","consumidor","weight")
IS_P_net<-graph_from_data_frame(IS_P,directed = TRUE, vertices =NULL)
#Lote unlu
IS_L<-IS_L1[,c(1,2,11)]
names(IS_L)<-c("recurso","consumidor","weight")
IS_L_net<-graph_from_data_frame(IS_L,directed = TRUE, vertices =NULL)

#Pastizal naturalizado
IS_N<-IS_N1[,c(1,2,11)]
names(IS_N)<-c("recurso","consumidor","weight")
IS_N_net<-graph_from_data_frame(IS_N,directed = TRUE, vertices =NULL)
#Mixto Agrícola Ganadero
IS_G<-IS_G1[,c(1,2,11)]
names(IS_G)<-c("recurso","consumidor","weight")
IS_G_net<-graph_from_data_frame(IS_G,directed = TRUE, vertices =NULL)
#Agrícola Intensivo
IS_A<-IS_A1[,c(1,2,11)]
names(IS_A)<-c("recurso","consumidor","weight")
IS_A_net<-graph_from_data_frame(IS_A,directed = TRUE, vertices =NULL)
#unlu reducido
#Reserva
IS_R.r1<-IS_R.r[,c(1,2,11)]
names(IS_R.r1)<-c("recurso","consumidor","weight")
IS_R_net.r<-graph_from_data_frame(IS_R.r1,directed = TRUE, vertices =NULL)
#Pastizal
IS_P.r1<-IS_P.r[,c(1,2,11)]
names(IS_P.r1)<-c("recurso","consumidor","weight")
IS_P_net.r<-graph_from_data_frame(IS_P.r1,directed = TRUE, vertices =NULL)
#Lote unlu
IS_L.r1<-IS_L.r[,c(1,2,11)]
names(IS_L.r1)<-c("recurso","consumidor","weight")
IS_L_net.r<-graph_from_data_frame(IS_L.r1,directed = TRUE, vertices =NULL)

####
QSS_IS_R<-calc_QSS(IS_R_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_P<-calc_QSS(IS_P_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_L<-calc_QSS(IS_L_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)


QSS_IS_N<-calc_QSS(IS_N_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_G<-calc_QSS(IS_G_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_A<-calc_QSS(IS_A_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)

QSS_IS_R.r<-calc_QSS(IS_R_net.r, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_P.r<-calc_QSS(IS_P_net.r, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_L.r<-calc_QSS(IS_L_net.r, istrength=TRUE, returnRaw = TRUE, nsim=1000)

#observacion con modificacion de los efectos negativos-positivos se hace pequeño el autovalor, pero no "estable localmente"

```

```{r AD-test-QSS, include=FALSE, warning=FALSE, message=FALSE}
#Luján
Q_T_unlu<-rbind(data_frame(sitio=rep("R",length(QSS_IS_R)),qss=QSS_IS_R$maxre),
                data_frame(sitio=rep("P",length(QSS_IS_P)),qss=QSS_IS_P$maxre),
                data_frame(sitio=rep("A",length(QSS_IS_L)),qss=QSS_IS_L$maxre))
names(Q_T_unlu)<-c("sitio","qss")


AD_qss_RP<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_unlu[Q_T_unlu$sitio %in% c("R", "P"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_RA<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_unlu[Q_T_unlu$sitio %in% c("R", "A"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_AP<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_unlu[Q_T_unlu$sitio %in% c("A", "P"), ], method = "simulated", dist = FALSE, Nsim = 1000)

# Recopilar los p-valores en un vector
p_values_luj <- c(AD_qss_RP$ad[2, 3], AD_qss_RA$ad[2, 3], AD_qss_AP$ad[2, 3])

# Ajustar los p-valores usando el método de Benjamini-Hochberg (FDR)
adjusted_p_val_luj <- p.adjust(p_values_luj, method = "BH")

#chivilcoy y navarro
Q_T_ro<-rbind(data_frame(sitio=rep("N",length(QSS_IS_N)),qss=QSS_IS_N$maxre),
                data_frame(sitio=rep("G",length(QSS_IS_G)),qss=QSS_IS_G$maxre),
                data_frame(sitio=rep("A",length(QSS_IS_A)),qss=QSS_IS_A$maxre))
names(Q_T_ro)<-c("sitio","qss")


AD_qss_NG<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_ro[Q_T_ro$sitio %in% c("N", "G"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_NA<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_ro[Q_T_ro$sitio %in% c("N", "A"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_AG<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_ro[Q_T_ro$sitio %in% c("A", "G"), ], method = "simulated", dist = FALSE, Nsim = 1000)

# Recopilar los p-valores en un vector
p_values_ro <- c(AD_qss_NG$ad[2, 3], AD_qss_NA$ad[2, 3], AD_qss_AG$ad[2, 3])

# Ajustar los p-valores usando el método de Benjamini-Hochberg (FDR)
adjusted_p_val_ro <- p.adjust(p_values_ro, method = "BH")

#Luján reducido
Q_T_lu.r<-rbind(data_frame(sitio=rep("R",length(QSS_IS_R.r)),qss=QSS_IS_R.r$maxre),
                data_frame(sitio=rep("P",length(QSS_IS_P.r)),qss=QSS_IS_P.r$maxre),
                data_frame(sitio=rep("A",length(QSS_IS_L.r)),qss=QSS_IS_L.r$maxre))
names(Q_T_lu.r)<-c("sitio","qss")


AD_qss_RP.r<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_lu.r[Q_T_lu.r$sitio %in% c("R", "P"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_RA.r<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_lu.r[Q_T_lu.r$sitio %in% c("R", "A"), ], method = "simulated", dist = FALSE, Nsim = 1000)
AD_qss_AP.r<-kSamples::ad.test(as.numeric(qss) ~ sitio,data=Q_T_lu.r[Q_T_lu.r$sitio %in% c("A", "P"), ], method = "simulated", dist = FALSE, Nsim = 1000)

# Recopilar los p-valores en un vector
p_values_lu.r <- c(AD_qss_RP.r$ad[2, 3], AD_qss_RA.r$ad[2, 3], AD_qss_AP.r$ad[2, 3])

# Ajustar los p-valores usando el método de Benjamini-Hochberg (FDR)
adjusted_p_val_lu.r <- p.adjust(p_values_lu.r, method = "BH")


#En luján/UNLu

ks_RL_qss<-ks.test(QSS_IS_R$maxre,QSS_IS_L$maxre)
ks_RP_qss<-ks.test(QSS_IS_R$maxre,QSS_IS_P$maxre)
ks_LP_qss<-ks.test(QSS_IS_L$maxre,QSS_IS_P$maxre)
# L: 0.414; R: 0.348; P: 0.371, ¿En que difieren a lo largo de la distribución?
#Diferencias con el pastizal que obtuvo el menor valor de autovalor

#En Chivilcoy y Navarro/Rosana

ks_NA_qss<-ks.test(QSS_IS_N$maxre,QSS_IS_A$maxre)
ks_NG_qss<-ks.test(QSS_IS_N$maxre,QSS_IS_G$maxre)
ks_GA_qss<-ks.test(QSS_IS_G$maxre,QSS_IS_A$maxre)

#todos los grupos difieren entre sí; A: 0.396; G: 0.403; N: 0.445;

#En luján/UNLu reducido

ks_RL.r_qss<-ks.test(QSS_IS_R.r$maxre,QSS_IS_L.r$maxre)
ks_RP.r_qss<-ks.test(QSS_IS_R.r$maxre,QSS_IS_P.r$maxre)
ks_LP.r_qss<-ks.test(QSS_IS_L.r$maxre,QSS_IS_P.r$maxre)
# L: 0.414; R: 0.348; P: 0.371, ¿En que difieren a lo largo de la distribución?
#Diferencias con el pastizal que obtuvo el menor valor de autovalor

# Recopilar los p-valores en un vector
p_values_ks.lu<- c(ks_RL_qss$p.value[1], ks_RP_qss$p.value[1],ks_LP_qss$p.value[1])
p_values_ks.ro<- c(ks_NA_qss$p.value[1], ks_NG_qss$p.value[1],ks_GA_qss$p.value[1])
p_values_ks.lu.r<- c(ks_RL.r_qss$p.value[1], ks_RP.r_qss$p.value[1],ks_LP.r_qss$p.value[1])

# Ajustar los p-valores usando el método de Benjamini-Hochberg (FDR)
adj_ks_p_val_lu <- p.adjust(p_values_ks.lu, method = "BH")
adj_ks_p_val_ro <- p.adjust(p_values_ks.ro, method = "BH")
adj_ks_p_val_lu.r <- p.adjust(p_values_ks.lu.r, method = "BH")


print(c(adjusted_p_val_luj,adjusted_p_val_ro,adjusted_p_val_ro))
print(c(adj_ks_p_val_lu,adj_ks_p_val_ro,adj_ks_p_val_lu.r))
```


```{r flux, include=FALSE}

flux_L<-fluxing(t(mG[c(L$taxa,"litter","carrion","tej_veg","hummus"),c(L$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_L, losses =  t_metL, efficiencies =  ef_L,ef.level = "pred")

flux_R<-fluxing(t(mG[c(R$taxa,"litter","carrion","tej_veg","hummus"),c(R$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_R, losses =  t_metR, efficiencies =  ef_R,ef.level = "pred")

flux_P<-fluxing(t(mG[c(P$taxa,"litter","carrion","tej_veg","hummus"),c(P$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_P, losses =  t_metP, efficiencies =  ef_P,ef.level = "pred")

### flujo Ro
flux_N<-fluxing(t(mG[c(N$specie,"litter","carrion","tej_veg"),
                     c(N$specie,"litter","carrion","tej_veg")]),
                biomasses = bm_N, losses =  t_metN, 
                efficiencies =  ef_N,ef.level = "pred")
flux_G<-fluxing(t(mG[c(G$specie,"litter","carrion","tej_veg"),
                     c(G$specie,"litter","carrion","tej_veg")]),
                biomasses = bm_G, losses =  t_metG, 
                efficiencies =  ef_G,ef.level = "pred")
flux_A<-fluxing(t(mG[c(A$specie,"litter","carrion","tej_veg"),
                     c(A$specie,"litter","carrion","tej_veg")]),
                biomasses = bm_A, losses =  t_metA, 
                efficiencies =  ef_A,ef.level = "pred")

#Reducción de redes####
#a acaros colembolos
flux_R.r<-fluxing(t(mG[c(Rf.r$taxa,"litter","carrion","tej_veg","hummus"),c(Rf.r$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_Rf.r, losses =  t_metRf.r, efficiencies =  ef_Rf.r,ef.level = "pred")

flux_P.r<-fluxing(t(mG[c(Pf.r$taxa,"litter","carrion","tej_veg","hummus"),c(Pf.r$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_Pf.r, losses =  t_metPf.r, efficiencies =  ef_Pf.r,ef.level = "pred")

flux_L.r<-fluxing(t(mG[c(Lf.r$taxa,"litter","carrion","tej_veg","hummus"),c(Lf.r$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_Lf.r, losses =  t_metLf.r, efficiencies =  ef_Lf.r,ef.level = "pred")
```

```{r flujos_multicanal, echo=FALSE, message=FALSE,warning=FALSE}
#herbivros########
#flujo através de los hervíboros

F_herb_R<-sum(flux_R["tej_veg",])
F_herb_P<-sum(flux_P["tej_veg",])
F_herb_L<-sum(flux_L["tej_veg",])

F_herb_N<-sum(flux_N["tej_veg",])
F_herb_G<-sum(flux_G["tej_veg",])
F_herb_A<-sum(flux_A["tej_veg",])

F_herb_R.r<-sum(flux_R.r["tej_veg",])
F_herb_P.r<-sum(flux_P.r["tej_veg",])
F_herb_L.r<-sum(flux_L.r["tej_veg",])

#humifagos/geófagos####

F_mo_R<-sum(flux_R["hummus",])
F_mo_P<-sum(flux_P["hummus",])
F_mo_L<-sum(flux_L["hummus",])

F_mo_N<-sum(flux_N["hummus",])
F_mo_G<-sum(flux_G["hummus",])
F_mo_A<-sum(flux_A["hummus",])

F_mo_R.r<-sum(flux_R.r["hummus",])
F_mo_P.r<-sum(flux_P.r["hummus",])
F_mo_L.r<-sum(flux_L.r["hummus",])


#detritivoros##########
#flujo através de los detritívoros

F_det_R<-sum(flux_R[c("litter","carrion"),])
F_det_P<-sum(flux_P[c("litter","carrion"),])
F_det_L<-sum(flux_L[c("litter","carrion"),])

F_det_N<-sum(flux_N[c("litter","carrion"),])
F_det_G<-sum(flux_G[c("litter","carrion"),])
F_det_A<-sum(flux_A[c("litter","carrion"),])

F_det_R.r<-sum(flux_R.r[c("litter","carrion"),])
F_det_P.r<-sum(flux_P.r[c("litter","carrion"),])
F_det_L.r<-sum(flux_L.r[c("litter","carrion"),])
#colnames(flux_L.r) %in% det
#microfitfagos###########
#flujo através de los microvíboros

F_mic_R<-sum(flux_R[c("bac","fungi"),])
F_mic_P<-sum(flux_P[c("bac","fungi"),])
F_mic_L<-sum(flux_L[c("bac","fungi"),])

F_mic_N<-sum(flux_N[c("bac","fungi"),])
F_mic_G<-sum(flux_G[c("bac","fungi"),])
F_mic_A<-sum(flux_A[c("bac","fungi"),])

F_mic_R.r<-sum(flux_R.r[c("bac","fungi"),])
F_mic_P.r<-sum(flux_P.r[c("bac","fungi"),])
F_mic_L.r<-sum(flux_L.r[c("bac","fungi"),])

#predadores####
#flujo através de los predadores

#Rbases<-c("tej_veg", "fungi","bac","litter","carrion")
#!colnames(flux_R) %in% Rbases
F_pred_R<-sum(flux_R[,colnames(flux_R) %in% pred])
F_pred_P<-sum(flux_P[,colnames(flux_P) %in% pred])
F_pred_L<-sum(flux_L[,colnames(flux_L) %in% pred])

F_pred_N<-sum(flux_N[,colnames(flux_N) %in% pred])
F_pred_G<-sum(flux_G[,colnames(flux_G) %in% pred])
F_pred_A<-sum(flux_A[,colnames(flux_A) %in% pred])

F_pred_R.r<-sum(flux_R.r[,colnames(flux_R.r) %in% pred])
F_pred_P.r<-sum(flux_P.r[,colnames(flux_P.r) %in% pred])
F_pred_L.r<-sum(flux_L.r[,colnames(flux_L.r) %in% pred])

#omnivoros####
#flujo através de los omnivoros

F_omn_R<-sum(flux_R[,colnames(flux_R) %in% omn])
F_omn_P<-sum(flux_P[,colnames(flux_P) %in% omn])
F_omn_L<-sum(flux_L[,colnames(flux_L) %in% omn])

F_omn_N<-sum(flux_N[,colnames(flux_N) %in% omn])
F_omn_G<-sum(flux_G[,colnames(flux_G) %in% omn])
F_omn_A<-sum(flux_A[,colnames(flux_A) %in% omn])

F_omn_R.r<-sum(flux_R.r[,colnames(flux_R.r) %in% omn])
F_omn_P.r<-sum(flux_P.r[,colnames(flux_P.r) %in% omn])
F_omn_L.r<-sum(flux_L.r[,colnames(flux_L.r) %in% omn])

```

## Flujos de energía a través de las redes tróficas en suelos Argiudoles

El flujo de energía (Table 5.x) de la comunidad de la fauna edáfica en suelos de Luján fué mayor en la comunidad del Pastizal, seguida por la comunidad en la Reserva y el sistema agrícola intensivo con un flujo menor de energía de 364 kJ.año^-1^ y 614 kJ.año^-1^ respectivamente con respecto al pastizal.

La cantidad de energía ligada a consumo del humus en suelos de Luján,
es decir la materia orgánica del suelo,
se relaciona con la <u>biotransformación</u> del suelo, la cantidad de energía en estos enlaces 
es muy importante, llegando a ser del 75% en el pastizal, del 70% en la reserva, y del 65% en el sistema agrícola. 

```{r flujos_multicanal_print, echo=FALSE, message=FALSE,warning=FALSE}
F_mc_lu<-data.frame(sitio=c("Reserva","Pastizal","Agrícola"),
           biotransformación=c(F_mo_R,F_mo_P,F_mo_L
                               ),
           detritivoria=c(F_det_R,F_det_P,F_det_L
                               ),
           microfitofagia=c(F_mic_R,F_mic_P,F_mic_L),
           predación=c(F_pred_R,F_pred_P,F_pred_L),
           omnivoría=c(F_omn_R,F_omn_P,F_omn_L),
           row.names = NULL)

F_mc_lu
```

La detritivoría fué mayor en términos relativos en el sistema de la agrícola 
y menor en el pastizal.
En todos los sistemas el consumo de bacterias y hongos, <u>microfitofagia o microviboría</u>,
conyevan flujos de energía menores al 3,3%
del flujo total de energía que atraviesa estos suelos, en los suelos de la Reserva la microviboría fué ligeramente mayor, seguidas por el sistema agrícola y 1 punto porcentual por debajo el 
sistema del Pastizal.
La omnivoría es el tercer canal de energía en importancia a través de estos actores llega hasta el 35% del flujo energético anual, en el pastizal su importancia fue ligeramente mayor.
La cantidad de energía que llega a los depredadores es el de menor importancia relativa por debajo del 1% del flujo total, en los suelos de la reserva la cantidad de energía en este canal fué mas bajo, seguido por el sistema agrícola y el pastizal.

```{r flujos_multicanal_print1, echo=FALSE, message=FALSE,warning=FALSE}
F_mc_total<-data.frame(sitio=c("Naturalizado","Mixto","Agrícola","Reserva","Pastizal","Agrícola"),
           biotransformación=c(
                               F_mo_N,F_mo_G,F_mo_A,
                                                             F_mo_R.r,F_mo_P.r,F_mo_L.r)*100,
           detritivoria=c(
                               F_det_N,F_det_G,F_det_A,
                        F_det_R.r,F_det_P.r,F_det_L.r),
           microfitofagia=c(
                               F_mic_N,F_mic_G,F_mic_A,
                               F_mic_R.r,F_mic_P.r,F_mic_L.r),
           predación=c(
                               F_pred_N,F_pred_G,F_pred_A,
                               F_pred_R.r,F_pred_P.r,F_pred_L.r),
           omnivoría=c(
                               F_omn_N,F_omn_G,F_omn_A,
                               F_omn_R.r,F_omn_P.r,F_omn_L.r),
           row.names = NULL)

F_mc_total

```

En los suelos de Chivilcoy y Navarro, (Tabla 5.x) los flujos de energía alcanzan un máximo de 18
kJ.año^-1^ en los suelos con pastizal naturalizado, en comparación, en suelos de Luján el
flujo de energía fué hasta 70 veces mayor.

El canal que mueve el humus del suelo fue el de mayor importancia, este fué mayor en el sistema 
del pastizal naturalizado y menor en el sistema mixto agrícola ganadero; en suelos de Luján
tuvo importancias similares en la Reserva y el Pastizal y menor importancia en el 
sistema Agrícola. 

La detritivoría fue de poca importancia en el pastizal naturalizado a la vez que fué mayor en el sistema agrícola intensivo; por su parte en suelos de Luján el sistema agrícola tuvo la mayor participación de detritívoros. La microfitofagia fue mayor en el sistema mixto y en el sistema agrícola intensivo y menor en el pastizal naturalizado; en suelos de Luján esta fue mayor en la Reserva y menor en el pastizal. 

La omnivoría en el pastizal naturalizado contabilizó solo el 4,5% del flujo total de energía, en el sistema mixto agrícola ganadero tuvo una mayor participación; en suelos de Luján la omnivoría fue de importancia similar en los tres sistemas de uso siendo mayor en la Reserva.

La predación no supero el 2% del flujo total de energía en general. En los suelos de Chivilcoy y Navarro 
fue mayor en el sistema Agrícola intensivo y menor en el pastizal naturalizado; en suelos de Luján la predación fué más importante en el pastizal seguido del sistema agrícola.

## Estabilidad de las redes tróficas de suelos Argiudoles

**Valor de estabilidad de cuasi-signo en suelos de Luján**


En los suelos argiudoles de Luján las redes de interacciones tróficas muestra 
diferencias significativas entre los tres sistemas de uso según la prueba de 
Anderson-Darling $AD: p_{\,valor} < 0.05$. 

Los tres sistemas de uso se diferencian entre sí siendo mayor en promedio la parte real 
del autovalor de la matriz Jacobiana en los suelos de la comunidad de la Reserva y 
menor en las comunidades de los suelos bajo uso agrícola convencional. 

```{r plot_QSS_IS, echo=FALSE,,message=FALSE,warning=FALSE}
par(mfrow=c(1,3))
hist(log(QSS_IS_R$maxre),border =  "blue4",col=NULL,breaks=40,freq = FALSE,main = "Reserva", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-6, 3, by = 1))
abline(v=mean(log(QSS_IS_R$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_R$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_R$maxre),probs = 0.25),quantile(log(QSS_IS_R$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_P$maxre), border =  "green4",col=NULL,breaks=40,freq = FALSE,main = "Pastizal", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-6, 3, by = 1)) 
abline(v=mean(log(QSS_IS_P$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_P$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_P$maxre),probs = 0.25),quantile(log(QSS_IS_P$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_L$maxre), border =  "orange3",col=NULL,breaks=40,freq = FALSE,main = "Agrícola", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-6, 3, by = 1)) 
abline(v=mean(log(QSS_IS_L$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_L$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_L$maxre),probs = 0.25),quantile(log(QSS_IS_L$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)

par(mfrow=c(1,1))
#plot(hist(log(QSS_IS_R$maxre),plot=FALSE)
#            );plot(hist(log(QSS_IS_P$maxre), 
#plot=FALSE),add=TRUE);plot(hist(log(QSS_IS_L$maxre),plot=FALSE),add=TRUE)
```

La distribución de la parte real del máximo autovalor de las matrices de cuasi-signo
en estos sistemas se movió en un rango con 7 ordenes de magnitud. 
En el sistema Agrícola y en la Reserva se observan distribuciones bimodales que coinciden con
las lineas que representan a los cuartiles (Fig 5.x) a diferencias del Pastizal que
muestra su distribución como unimodal al rededor de los valores de tendencia central.

En la Reserva la moda de la distribución fué más alta alrededor del primer cuartil lo que implica 
un valor de cuasi-signo cercano a cero con mayor probabilidad de ocurrencia, en el sistema agrícola 
la moda más grande de su distribución se ubica cercana al tercer cuartil  y en el pastizal la moda está
relacionada con los valores de centralidad de las distribuciones.

Considerando la forma de las distribuciónes, entonces, la Reserva seguidos por el Pastizal y el suelo
Agrícola tienen valores tienen valores de estabilidad decrecientes. 


```{r plot_QSS_IS_ro_lu, echo=FALSE,message=FALSE,warning=FALSE}

par(mfrow=c(2,3))
hist(log(QSS_IS_N$maxre), border =  "blue4",col=NULL,breaks=50,freq = FALSE,main = "Pastizal naturalizado", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-10, 2, by = 1))
abline(v=mean(log(QSS_IS_N$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_R$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_N$maxre),probs = 0.25),quantile(log(QSS_IS_N$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_G$maxre), border =  "green4",col=NULL,breaks=50,freq = FALSE,main = "Mixto", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-10, 2, by = 1))
abline(v=mean(log(QSS_IS_G$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_G$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_G$maxre),probs = 0.25),quantile(log(QSS_IS_G$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_A$maxre), border =  "orange3",col=NULL,breaks=50,freq = FALSE,main = "Agrícola intensivo", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-10, 2, by = 1))
abline(v=mean(log(QSS_IS_A$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_A$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_A$maxre),probs = 0.25),quantile(log(QSS_IS_A$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)

hist(log(QSS_IS_R.r$maxre), border =  "blue4",col=NULL,breaks=40,freq = FALSE,main = "Reserva", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-7, -3, by = 1))
abline(v=mean(log(QSS_IS_R.r$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_R.r$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_R.r$maxre),probs = 0.25),quantile(log(QSS_IS_R.r$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_P.r$maxre), border =  "green4",col=NULL,breaks=40,freq = FALSE,main = "Pastizal", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-7, -3, by = 1))
abline(v=mean(log(QSS_IS_P.r$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_P.r$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_P.r$maxre),probs = 0.25),quantile(log(QSS_IS_P.r$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)
hist(log(QSS_IS_L.r$maxre), border =  "orange3",col=NULL,breaks=40,freq = FALSE,main = "Agrícola", sub= "Estabilidad de cuasi-signo", xlab = "ln qss",ylab=NULL)
axis(1, at = seq(-7, -3, by = 1))
abline(v=mean(log(QSS_IS_L.r$maxre)),col="blue",lty=1,lwd=3)
abline(v=median(log(QSS_IS_L.r$maxre)),col="red",lty=1,lwd=2.5)
abline(v=c(quantile(log(QSS_IS_L.r$maxre),probs = 0.25),quantile(log(QSS_IS_L.r$maxre),probs = 0.75)),col="purple",lty=3,lwd=1.5)

par(mfrow=c(1,1))

qss_moda_N<-mlv(log(QSS_IS_N$maxre), method = "Parzen")
qss_moda_G<-mlv(log(QSS_IS_G$maxre), method = "Parzen")
qss_moda_A<-mlv(log(QSS_IS_A$maxre), method = "Parzen")

qss_moda_R.r<-mlv(log(QSS_IS_R.r$maxre), method = "Parzen")
qss_moda_P.r<-mlv(log(QSS_IS_P.r$maxre), method = "Parzen")
qss_moda_L.r<-mlv(log(QSS_IS_L.r$maxre), method = "Parzen")

```
<!--mezcla de dos distribuciones, procesos competitivos o ruptura de simetría https://fastercapital.com/es/contenido/Un-misterio--investigar-distribuciones-bimodales.html-->

En suelos de Chivilcoy y Navarro las distribuciones del máximo autovalor de la matriz de cuasi-signo 
muestra una distribución bimodal marcada, en comparación en suelos de Luján la distribución resulta unimodal
y sesgafa hacia la izquierda. 
El rango de distribución del valor de QSS en suelos de Chivilcoy y Navarro se movió en 12 órdenes de magnitud, en comparación en suelos de Luján este se movió 6 órdenes de magnitud.

En el pastizal naturalizado ambas modas de la distribución tienen importancias similares siendo 
levemente mayor aquella moda más ligada al primer cuartil, en los sistemas mixto y agrícola intensivo la
moda relacionada con el primer cuartil es la de mayor frecuencia y la importancia de la segunda moda es menor.
En cuanto al valor de estabilidad las modas de las distribuciones en los tres sistemas de uso se encuentras cercanas
entre sí con un autovalor próximo a $\lambda_{\;max} \approx e^{-7,7}\approx0,00045$, sin embrago, el sistema mixto 
está más alejado (`r exp(qss_moda_G)`) de cero, seguidos por el pastizal naturalizado (`r exp(qss_moda_N)`)
y el más cercano, el sistema agrícola intensivo (`r exp(qss_moda_A)`).

Los autovalores en los sistemas de uso de suelo en Luján fueron mayores, alejándose del cero,
en comparación con los suelos de Chivilcoy y Navarro. Las modas de las distribuciones muestran 
ligeros sesgos hacia a la izquierda con valores cercanos a 
$\lambda_{\;max} \approx e^{-6,1}\approx0,00225$. Las modas con los menores autovalores se observan en orden decreciente en la Reserva `r exp(qss_moda_R.r)`, en donde además se observa una 
relación con el valor de tendencia central, en el Pastizal y en el Agrícola con valores 
modales muy próximos entre sí `r exp(qss_moda_P.r)` y  `r exp(qss_moda_L.r)` respectivamente.

En ambas localidades los menores valores del autovalor de la matriz de quasi-signo se observó
en el sistema Agrícola, aunque su valor se separó más en los suelos de Luján de aquel de la 
Reserva y su valor se mantuvo próximo en suelos de Chivilcoy y Navarro con respecto al pastizal 
naturalizado.


```{r QSS_taxon, include=FALSE}

#acá colocar los gremios tróficos
# o los taxas
#usar en su lugar calc_QSS_extinction_dif_grp
#QSS_unlu_seq<-calc_QSS_extinctions_seq(QSS_IS_UNLu, seq = V(QSS_IS_UNLu)$name[20:25], nsim = 100, ncores = 4, istrength = TRUE)

#QSS_unlu_seq<-calc_QSS_extinctions_seq(IS_P_net, seq = #V(IS_P_net)$name[V(IS_P_net)$name%in%, nsim = 100, ncores = 4, istrength = TRUE)
```

# ref

