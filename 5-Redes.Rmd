---
title: "soil_food_web_unlu"
author: "Velazco"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

En los ecosistemas las especies presentes se relacionan entre sí de
maneras diferentes y estas relaciones establecen complejas redes de
interacciones (Montoya et al. 2001). Las redes de interacciones nos
muestran todas las posibles tramas en las que las especies pueden
interactuar (Delmas et al. 2019; Kéfi et al. 2012). Las redes pueden
caracterizarse en función del tipo de interacción que representan
describiendo así redes tróficas, redes de competidores, redes
mutualistas, entre otras (Labrador 2008; Montoya et al. 2001).

El enfoque que permite integrar la diversidad de especies, las
interacciones interespecíficas, las interacciones con el ambiente, la
redundancia funcional, el papel de las especies claves y la
multiplicidad de canales de materia y energia que ocurren en los
ecosistemas es estudio de la red de interacciones (.\@.barrios2007,
.\@.briones2014, .\@.potapov2023) que permite simplificar la complejidad
de interacciones y conetarlos con diferentes parámetros que emergen el
estudio de los ecosistemas (.\@.Hooperetal2005;.\@.delmas_etal2019)

En los suelos las redes de interacciones están influenciadas por
**factores de largo plazo** tales como el clima, las características
edáficas regionales y locales, la disponibilidad de recursos para los
organismos que en el habitan, las influencias biogeográficas sobre las
comunidades y por **factores de corto plazo** como las perturbaciones
antrópicas (Kardol et al. 2016) por lo que resulta de particular interés
la respuesta de la estructura de las redes ante los distintos tipos de
disturbios y su relación con el funcionamiento del ecosistema del suelo
(Sabatté, 2011; Kardol et al., 2016).

```{=html}
<!--Las redes tróficas permiten el análisis de las interacciones de
alimentación y ha sido el enfoque más utilizado pero se ha demostrado
que incluir todos los tipos de interacciones es fundamental para
entender el funcionamiento de los ecosistemas (Kéfi et al. 2012).-->
```
Las redes tróficas permiten el análisis de las interacciones de
alimentación y es el enfoque más utilizado en ecología para describir
los canales por los cuales se mueve la materia y la energía (\@.citar)
Mediante el estudio de las redes tróficas se pueden reconocen las
especies claves y los grupos funcionales claves, definidos como el grupo
de especies con un papel semejante en el funcionamiento de un ecosistema
(Gitay y Noble, 1997) que permiten el mantenimiento de las funciones
ecológicas del suelo (\@.citar).

Las redes tróficas se apoya en la teoría de grafos en la que los nodos
(especies tróficas) y sus bordes (interacciones) determinan métricas
asociados con las redes empíricas tales como la conectividad, el grado
de correlación, la longitud de un camino trófico, etc., hasta variables
ecológicas de una comunidad en el que se incluyen por ejemplo la
riqueza, la diversidad, el máximo nivel trófico, la fracción de
omnívoros, la fracción de predación entre gremios, etc. (Digel et. al.
2014; Delmas 2019 et al. 2019; Maggioto et al. 2019).

Por lo tanto mediante el análisis se obtienen patrones generales sobre
la topología de la red y las consecuencias de estos patrones sobre la
dinámica de la comunidad y las especies constituyentes (Kéfi et al.
2012; Pimm et. al. 1991; Scheu 2001) y su estructura condiciona las
funciones en los ecosistemas (Montoya et al. 2001; Labrador 2008)

Como la estructura de las redes ecológicas condiciona el funcionamiento
intrínseco de un ecosistema (Labrador, 2008; Martín López et al., 2007)
la complejidad del entramado de la red trófica edáfica es un factor
clave en la estabilidad de los procesos del suelo (Sabatté, 2011;
Wardle, 1995), y por lo tanto en el estado de conservación del mismo que
será mayor cuanto mayor sea la estabilidad de la red de interacciones.

En las redes ecológicas las conexiones características son aquellas en
las que unas pocas especies poseen un gran número de enlaces por lo
tanto la mayoría de las especies poseen pocas conexiones (Delmas et al.
2019; Montoya et al. 2001; Pimm et al. 1991) y este es el modo en que la
diversidad biológica y el funcionamiento de los ecosistemas están
ligados (Balvanera et al., 2006).

Los grupos funcionales con especies redundantes (Martín-López 2007)
permitirán una mayor capacidad de respuesta ante las perturbaciones ya
que asegura el mantenimiento de las funciones en el ecosistema (Delmas
et al. 2019; Montoya et al. 2001; Pimm et al. 1991) y de este modo que
se puede mantener la estructura, el funcionamiento y los mecanismos de
autorregulación del ecosistema (Martín-Lopez 2007) pero la desaparición
de especies muy conectadas puede producir extinciones secundarias y
fragmentaciones de la red (Montoya et al. 2001)

<!--Los componentes de los sistemas ecológicos no funcionan aislados sino a través de interacciones de complejidad variable y su organización se encuentra enmarcada por factores evolutivos, dinámicos y energéticos (Saravia 2018). La modelación matemática resulta en una herramienta clave para la comprensión del funcionamiento de los sistemas biológicos porque cuenta con la propiedad de síntesis de variables con efectos dominantes (Polo 2013).-->

Los estudios de redes de interacciones proporcionan información acerca
de la estructura autoorganizada de los ecosistemas (Momo 2018); en las
redes tróficas del suelo se busca comprender los efectos sobre la
descomposición de la materia orgánica y el ciclo de nutrientes (Scheu
2002) y otras funciones del ecosistema edáfico (\@citar) que son tema
central de los investigadores al centrarse en los flujos de energía y en
las redes tróficas de las comunidades de diferentes sistemas de uso del
suelo (Scheu 2002; potapov2023(historicalperspe)).

La comprensión de la estructura y topología de la red se constituye en
una herramienta útil para describir y cuantificar la complejidad de los
ecosistemas y de cómo las comunidades de la mesofauna edáfica responden
a las perturbaciones asociadas al manejo del suelo (Delmas et al. 2019;
Maggioto et. al. 2019)

Digel et al. (2014) utilizó las redes tróficas de 48 comunidades del
suelo de bosques alemanes y comparó 22 parámetros de las métricas y
topología de las redes tróficas entre las comunidades del suelo y las
comunidades de ecosistemas acuáticos y terrestres. En la Argentina
Maggioto et al. (2019) utilizaron las herramientas del análisis de las
redes tróficas del suelo para estudiar los efectos de forestar
pastizales naturalizados de la Pampa Húmeda. En este estudio, compararon
11 parámetros entre 2 sitios forestados y un pastizal naturalizado.

En ambos casos el análisis de la estructura de las redes fue realizado
comparando diferentes comunidades ó diferentes manejos del suelo,
hallando características particulares para cada comunidad y coinciden en
que la estructura general de las redes no varía considerablemente según
el uso del suelo, aunque en los sitios bajo estudio no implicaron
manejos de suelos en el que hubiera prácticas agrícolas intensivas.

.\@.potapov2023 declara que el uso de las redes tróficas es una
herramienta esencial que debe ser utilizada en los ecosistemas
terrestres para comprender el funcionamiento del ecosistema del suelo,
ya que une los aspetos relacionados con la diversidad específica, la
diversidad de rasgos, la diversidad funcional y los aspectos que se
relacionan con la estabilidad y resiliencia de estos sistemas.

Por otra parte, a las redes de interacciones, pueden relacionarse rasgos
como el peso corporal con los nodos de la red y atributos poblacionales
como la abundancia de los taxones, lo que permite relacionar tanto
parámetros fisiológicos como el metabolismo y el uso de los recursos,
como parámetros ecológicos tales como las interacciones tróficas y las
adaptaciones de estos organismos ante cambios en el ambiente
[.\@.pey2014; .\@.white2007; .\@.turnbull2014].

En este contexto, pretendemos comparar las métricas estruturales, los
flujos de energía vinculados a las redes tróficas, las fuerzas de
interacciones y la estabilidad estructural de las redes tróficas de la
fauna del suelo entre ambientes con distintas intensidades en el tiempo
de uso del suelo.

En este contexto, el presente trabajo busca comparar la estabilidad
estructural de las redes de tróficas de la fauna del suelo de suelos
Argiudoles típicos de la Pampa Ondulada entre ambientes con distintas
estrategias en el uso del suelo, como aproximación a distintas
intensidades de perturbación: a) suelos sin uso agropecuario, tales como
un pastizal naturalizado sin uso por mas de 50 años o un lote clausurado
sin uso por más de 30 años, que servirán como sistema de referencia; b)
suelos con uso pastoril como forraje para el ganado considerados como
sistemas con intensidad de uso intermedio o leve; y c) suelos con
actividad agrícola contínua considerado como sistema con intensidad de
uso alta.

<!--, una sin uso de suelo correspondiente a un pastizal naturalizado que servirá como sistema de referencia y un sistema de alta perturbación que se corresponde con un sistema agrícola intensivo con más de 50 años de actividad ininterrumpida.-->

Para la construcción y el modelado de la red de interacciones tróficas
de la fauna del suelo es necesario conocer a) tanto las comunidades que
habitan los diferentes ambientes como las características físicas y
químicas de los ambientes, b) además es necesario recopilar información
sobre los recursos tróficos que estos animales utilizan para poder
modelar la matriz de interacciones tróficas (.\@.delmas_etal_2019), c)
de manera complementaria tener información sobre rasgos funcionales
específicamente sobre el peso corporal de los taxas involucrados
(.\@.laigle_etal_2018) que permite conocer las fuerzas de
interacciones(.\@.deRuiter_etal_1995), los flujos de energía através de
la red (.\@.potapov2023, .\@.barnes_etal_2017) y calcular la resiliencia
y estabilidad de los sistemas bajo estudio (.\@.mooreandderutier_2018,
.\@.gauzen_etal_2018, .\@.allisina_etal_2008).

Entonces a partir de un suelo natural definido como referencia donde se
encuentran las características de un suelo no disturbado, se podrían
comparar parámetros estructurales y funcionales de la comunidad de
microartrópodos edáficos que permitan evaluar la estabilidad de la red
de interacciones como indicadora del estado de conservación del suelo y
determinar a través de su estudio la sustentabilidad de los sistemas de
manejo [@bedano2007; @socarras2013].

# Metodología

## Construccion de la red
Se construyo una matriz de interacciones tróficas cutos nodos son todas los taxones hallados 
en las comunidades de la fauna de suelo ("Gamma"). A partir de ella se seleccionan los actores que 
corresponden a cada comunidad en particular ("Alpha"). 

Se tomaron los pesos corporales medios. 
Se tomaron las biomasas medias
Se tomaron las densidades medias. 
Se asumieron ciertos parámetros con respecto a los recursos bases, los cuales debida a su complejidad 
son dificiles de cuantificar, pero se pueden relacionar con variables calculadas por bibliografía

## Métricas y estadísticas
Se calcularon los índices topológicos
Se calcularon los valores de estabilidad de quasi-signo utilizando el valor de máximo autovalor como proxi 
de resiliencia una de las definiciones intuitivamente más relacionada al concepto de estabilidad.
Se calculó la fuerza de interacciones entre los actores mediante el uso del peso corporal promedio del taxón 
y la densidad numérica promedio siguiendo el método de (paper_ interaction strength_ con busqueda dimensional)

Se utilizó el pequete "multiweb" <enlace_github> para calcular las métricas de topología y estabilidad de las redes. 
con el apoyo de paquetes complementarios para manejo de datos todos ellos implementados en R.
# Resultados

```{r lib, include=FALSE}

{library(tidyverse);library(statnet);library(network);
  library(igraph);library(intergraph);library(multiweb)}
set.seed(167)

```

```{r dtb,include=FALSE}
#Carga datos, comunidad completa, abundancia, pesos corporales medios, de suelos UNLu
SFW_unlu <- read.delim(
  "database/unlu_ab_mass_mean_web.txt"
  )
#carga datos, suelos ROSANA, Chivilcoy y Navarro
completo <- readxl::read_excel("database/soil_networks.xlsx", sheet = "Ro_web")
```

```{r densidad_unlu,include=FALSE}
#microfauna (se contaron los nemátodos de 4 sacabocados)
sup.bocado.micro <- (1/(pi*2.5^2/10000))*4
#mesofauna (se contaron y extrajeron de 3 frasquitos homojeneizados del monolito)
sup.bocado.meso <- (1/(pi*2.5^2/10000))*3
#macrofauna (superficie estandar 25 x 25)
sup.monolito <- 1/(0.25*0.25)

unlu_D<-SFW_unlu%>%
  mutate(nombre=paste(sitio,replica))%>%
           mutate(
             D=floor(case_when(
  size_class=="macro"~ sup.monolito*abundance,
  size_class=="meso"~ sup.bocado.meso*abundance,
  size_class=="micro"~ sup.bocado.micro*abundance)
  ),
  biomass=body_mass*D
  )

web<-unlu_D%>%
  group_by(nombre,sitio,replica,taxa)%>%
  summarise(body=mean(body_mass,na.rm=TRUE),
            biomass=mean(biomass,na.rm=TRUE))%>%
  distinct(taxa,.keep_all=TRUE)

```

```{r recurso_base_unlu,echo=FALSE}
#se utilizaron la biomasa estimada por m2 hasta los 5 cm

#recursos base, hongo, bacteria, protozoa
sitio<-c("L","L","L","P","P","P","R","R","R",
         "L","L","L","P","P","P","R","R","R",
         "L","L","L","P","P","P","R","R","R")
replica<-c(1,2,3,1,2,3,1,2,3,
           1,2,3,1,2,3,1,2,3,
           1,2,3,1,2,3,1,2,3)
taxa<-c("bac","bac","bac","bac","bac","bac","bac","bac","bac",
        "fungi","fungi","fungi","fungi","fungi","fungi","fungi","fungi","fungi",
        "proto","proto","proto","proto","proto","proto","proto","proto","proto")
#los recursos disponibles para consumo del total, serán el 50% de la biomasa microbiana
# de ello se proporciona para bacterias y hongos según la relación hongo bacterias

# acá utilio la relacion hongos bacterias
# 1-(relaciónHB/(1+relacionHB)) = bacterias
# (relaciónHB/(1+relacionHB)) = hongos
# de la "biomasa total" el 50% disponible, de los cuales 5% es protozoos y 45% seran hongos y bacterias.
# se multiplican el 45 que es disponible por la proporcion HB previamente calculada.

ratio.hb<-c( 11/8, 11/6, 7/6, #Pastizal
            2.42857142857143, 11/6, 3.5, #Reserva
                       3.25, 14/3, 5/6) #Agrícola

biomass<-c(31182224*(1-0.45)*(1-(3.25/(1+3.25))),10506443*(1-0.45)*(1-(14/3/(1-14/3))),
           68378710*(1-0.45)*(1-(5/6/(1+5/6))),
           117115935*(1-0.45)*(1-(11/8/(1+11/8))),90987488*(1-0.45)*(1-(11/6/(1+11/6))),
           131508231*(1-0.45)*(1-(7/6/(1+7/6))),
           56295276*(1-0.45)*(1-(2.42857142857143/(1+2.42857142857143))),90096858*(1-0.45)*(1-(11/6/(1+11/6))),
           38740835*(1-0.45)*(1-(3.5/(1+3.5))),
           
          101342228*(1-0.45)*((3.25/(1+3.25))),147090202*(1-0.45)*((14/3/(1+14/3))),
          56982258*(1-0.45)*((5/6/(1+5/6))),
          161034411*(1-0.45)*((11/8/(1+11/8))),166810394*(1-0.45)*((11/6/(1+11/6))),
          153426270*(1-0.45)*((7/6/(1+7/6))),
          136717098*(1-0.45)*((2.42857142857143/(1+2.42857142857143))),165177572*(1-0.45)*((11/6/(1+11/6))),
          135592922*(1-0.45)*((3.5/(1+3.5))),
          
          132524452*0.05,157596645*0.05,125360968*0.05,
          278150346*0.05,257797882*0.05,284934501*0.05,
          193012374*0.05,255274430*0.05,174333757*0.05)


rec_base<-data.frame(sitio,replica,taxa,biomass)
rec_base<-rec_base%>%
             mutate(
             body=case_when(
  taxa=="bac"~ 9.5e-4, #peso medio bacteria, segun digel, en ug
  taxa=="fungi"~ 2.3e-1, #si considero el promedio entre ambos sería 5.560547e-05, 
                      #pero se coloca -999 cuando no hay info. #nueva info 4/4/24
                      # Andres Pilar et al 2016. soilfoodweb prairie
  taxa=="proto"~ 1.1121e-3)#peso medio, segun digel y en microgramos
  )
  
rec_base<-rec_base%>%
  mutate(nombre=paste(sitio,replica))

rec_base<-rec_base[,c("nombre","sitio","replica","taxa","body","biomass")]

web<-rbind(rec_base, web)

#############

web0<-web%>%
  group_by(sitio,taxa)%>%
  summarise(body=mean(body,na.rm=TRUE),
            biomass=mean(biomass,na.rm=TRUE))%>%
  distinct(taxa,.keep_all=TRUE)
#######

#############


#Eficiencias de consumo dicho por mi, justificación quien sabe
#Ver la carpeta de coefbiol la biblio con las eficiencias. Libro Colemann p.e.
#Detritivoros 0.15
#Herbívoros 0.2
#Omnívoros 0.4
#Microbivoros y geófagos 0.6
#predadores 0.75

micf<-c("alycidae", "bac","diplura",
  "Aporrectodea caliginosa","Aporrectodea rosea","Bimastos parvus",
  "Aporrectodea trapezoides","Bimastos beddardi sophiae",
   "ceratozetoidea","cryptophagidae","enchytraeida","entomobridae",
  "epilhomanioidea","eremobelbidae","Eukerria halophila","fungi","galumnidae",
   "Glossoscolex sp.","isotomidae","juvenil","macropilina","Microscolex phosphoreus",
  "nem_bacterivoro", "nem_fitofago","nem_fungivoro","Octalasion cyaneum",
  "Octolasion tyrtaeum","onichiuridae","oppioidea","oribatulidae",
  "oripodidae","protura","scheloribatidae","symphyla","symphypleona"
  )
pred<-c("ameroseidae","anystidae","arctacaridae","bdelloidea","carabidae",
  "coccinelidae","cunaxide","dermanisoidea","eupodoidea","eviphididae",
  "geophylomorpha","grillopalpidae","ichtyostomatogasteridae", "laelapidae", "larva_carabidae","linyphiidae","lycosidae","nem_predador","mesostigmata",
  "ologamasidae","parasitidae",  "penthalidae","proto","pseudoscorpionida",
  "rhagidiidae","rhodacarioidea","staphiliniidae","tarsonemidae","teneriffidae",
  "trombidiidae","tydeioidea", "uropodoidea","veigaioidea") 
det<-c("anthribidae","blattodea","gasteropoda","diplopoda","elateriforme",
  "embrioptera","eupthiracaroidea","larva_coleoptero",
 "larva_diptera","larva_elateridae","larva_scarabidae","larva_sciaridae",
  "larva_tenebrionidae","limnozetidae","oniscidea","ptilidae","pupa_diptera",
 "tenebrionidae","terebrantia","trogossitidae")
herb<-c("aphidoidea","cicadidae","coleoptera_suctor","hemiptero","larva_curculionidae",
   "ortoptero","thysanoptera")
omn<-c("astigmata","formicidae","hipogastruridae","nem_omnivor","tardigrado"  )

no_a<-c("nematomorpha")  
web0$ef<-NA
web0$ef[web0$taxa%in%micf]<-0.6
web0$ef[web0$taxa%in%pred]<-0.75
web0$ef[web0$taxa%in%det]<-0.25
web0$ef[web0$taxa%in%herb]<-0.125
web0$ef[web0$taxa%in%omn]<-0.4
web0$ef[web0$taxa%in%no_a]<-0.075

######## 
L<-web0%>%filter(sitio=="L")
P<-web0%>%filter(sitio=="P")
R<-web0%>%filter(sitio=="R")

#biomasas
#tejido vegetal se asume 125% (1+125/100) mas que la materia orgánica aunque puede ser 225% más
#carroña será el 5% de la biomasa total de los invertebrados
#hojarasca llevada a peso seco, factor de 0.32 P ; 0.37 R ; 0.28 L
bm_L<-c(L$biomass,
        (77.0321/0.0625)*0.28*1e6, #Hojarasca
        mean(L[L$taxa!="fungi"&L$taxa!="bac"&L$taxa!="proto",]$biomass)*0.05, #Carroña
        2.25*0.0273*1.2*50000*1e6,#Tej_veg
        0.4*0.0273*1.2*50000*1e6)#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_R<-c(R$biomass,
        55.753/0.065*0.37*1e6, #Hojarasca
        mean(R[R$taxa!="fungi"&R$taxa!="bac"&R$taxa!="proto",]$biomass)*0.05, #carroña
        2.25*0.0352*1.2*50000*1e6, #tej_veg
        0.4*0.0352*1.2*50000*1e6) #"humus" = POM = 0.4MO
bm_P<-c(P$biomass,
        (58.63/0.0625)*0.32*1e6, #Hojarasca
        mean(P[P$taxa!="fungi"&P$taxa!="bac"&P$taxa!="proto",]$biomass)*0.05, #carroña
        2.25*0.0352*1.2*50000*1e6, #Tej_veg
        0.4*0.0309*1.2*50000*1e6) #Humus
#######


#Pesos corporales
body_L<-c(L$body,0,0,0,0)
body_R<-c(R$body,0,0,0,0)
body_P<-c(P$body,0,0,0,0)



```

```{r datosRO, include=FALSE}

#completo <- readxl::read_excel("database/soil_networks.xlsx", sheet = "Ro_web")
#Hacer red por sitio, no por estación, ignorar la macrofauna 
#ya que no tuvieron un correcto diseño de muestreo
#representan 166 registros macrofauna / 8662 registros totales
#lombrices 1454 / 8662 totales, pero correctamente muestreados


base<-completo%>%filter(class!="macrofauna")
#Es el factor de conversión para llevar las abundancias a densidad

#Densidad de los demás es 2.5²*3.14 = n()/0,00471 
sup.bocado <- 1/(pi*2.5^2/10000)
#Densidad de lombrice en 25*25 = a n()/0.0625
sup.monolito <- 1/(0.25*0.25)


####### 
#por sitio
#A partir de aqui determina las abundancias
base.sitio<-base%>%group_by(system,site,class,order,specie) %>%
  summarise(abundance=n(), bio.ind=mean(biomass),
            bm=(mean(bm)),POM=mean(POM))%>%distinct(specie,.keep_all=TRUE)

#densidad y biomasa
ab.sitio<-base.sitio%>%
  mutate(D=case_when(order=="crassiclitellata"~sup.monolito*abundance,
                     order!="crassiclitellata"~sup.bocado*abundance),
         BT=case_when(order=="crassiclitellata"~sup.monolito*abundance*bio.ind,
                      order!="crassiclitellata"~sup.bocado*abundance*bio.ind))

#acá agrego biomasa microbiana total, como bmt, pero la biomasa disponible la dejo en 50% como bm, 
#ya que es el criterio anteriormente dado. 

base1 <-ab.sitio %>% group_by(system,site) %>%  
  summarise(humus=mean(POM),bm=(mean(bm)*0.5),bmt=(mean(bm)))%>% 
  mutate(bacteria=case_when(system=="A"~bm*0.35,system=="G"~bm*0.3,system=="N"~bm*0.25),
         hongo=((bm-(0.05*bm))-bacteria),
         microfauna=(0.05*bm*0.25),
         nem_f=(0.05*bm*0.75*0.4),nem_b=(0.05*bm*0.75*0.3),nem_phy=(0.05*bm*0.75*0.14),
         nem_pr=(0.05*bm*0.75*0.08),nem_om=(0.05*bm*0.75*0.08))%>%distinct(site,.keep_all=TRUE)

# matriz red
mRO<-ab.sitio[,c("system","site","specie","bio.ind","D","BT")]
mRO_rec<-base1%>% 
  pivot_longer(cols = c("humus","bacteria","hongo","microfauna","nem_f",
                        "nem_b","nem_phy","nem_pr","nem_om"),
              names_to = "specie",
              values_to = "BT"
              )
#en pivot longer no usar, distinct(site,.keep_all=TRUE), porque elimina las observaciones con las
#mismas filas y columnas

#en microgramos
{mRO_rec$bio.ind<-NA
mRO_rec[mRO_rec$specie=="humus","bio.ind"]<-1
mRO_rec[mRO_rec$specie=="bacteria","bio.ind"]<-9.5e-4
mRO_rec[mRO_rec$specie=="hongo","bio.ind"]<-2.3e-1
mRO_rec[mRO_rec$specie=="microfauna","bio.ind"]<-3.3363e-1 # este sale de promediar, 
                                          #lo que los protozoos "pesan"

#para los nemátodos utilizo el promedio GLOBAL de peso de los encontrados en suelos de Luján

#fitófago, luján 1.02ug, digel
#fungivoro, luján 5,184 ug, digel
#bacterivoro, luján 1,854, digel
#omnivoro, luján 16,89 ug, digel
#predador, luján 4,58 ug, digel
mRO_rec[mRO_rec$specie=="nem_b","bio.ind"]<-1.854
mRO_rec[mRO_rec$specie=="nem_f","bio.ind"]<-5.184
mRO_rec[mRO_rec$specie=="nem_phy","bio.ind"]<-1.02
mRO_rec[mRO_rec$specie=="nem_om","bio.ind"]<-16.89
mRO_rec[mRO_rec$specie=="nem_pr","bio.ind"]<-4.58
#elijo solo los recursos y le asigno nombre

mRO_rec$D<-mRO_rec$BT/mRO_rec$bio.ind}
mRO_rec<-mRO_rec[c("system","site","specie","bio.ind","D","BT")]

#matriz Rosana. Completo con recursos
mRO<-rbind(mRO,mRO_rec)
#corregir nombres de taxas para que sean simlares
{
mRO$specie[mRO$specie=="acaroidea"]<-"astigmata"
mRO$specie[mRO$specie=="Apo_cal"]<-"Aporrectodea caliginosa"
mRO$specie[mRO$specie=="Apo_ros"]<-"Aporrectodea rosea"
mRO$specie[mRO$specie=="Apo_tra"]<-"Aporrectodea trapezoides"
mRO$specie[mRO$specie=="hongo"]<-"fungi"
mRO$specie[mRO$specie=="bacteria"]<-"bac"
mRO$specie[mRO$specie=="dermanyssoidea"]<-"dermanisoidea"
mRO$specie[mRO$specie=="entomobroidea"]<-"entomobridae"
mRO$specie[mRO$specie=="epilohmannioidea"]<-"epilhomanioidea"
mRO$specie[mRO$specie=="euker"]<-"Eukerria stagnalis" #agregar
mRO$specie[mRO$specie=="euphthiracaroidea"]<-"eupthiracaroidea"
mRO$specie[mRO$specie=="galumnioidea"]<-"galumnidae"
mRO$specie[mRO$specie=="humus"]<-"hummus"
mRO$specie[mRO$specie=="hypogastruridae"]<-"hipogastruridae"
mRO$specie[mRO$specie=="lom_juv"]<-"juvenil"
mRO$specie[mRO$specie=="Mic_pho"]<-"Microscolex phosphoreus"
mRO$specie[mRO$specie=="Mic_dub"]<-"Microscolex dubius" #agregar
mRO$specie[mRO$specie=="microfauna"]<-"proto"
mRO$specie[mRO$specie=="nem_b"]<-"nem_bacterivoro"
mRO$specie[mRO$specie=="nem_f"]<-"nem_fungivoro"
mRO$specie[mRO$specie=="nem_phy"]<-"nem_fitofago"
mRO$specie[mRO$specie=="nem_om"]<-"nem_omnivor"
mRO$specie[mRO$specie=="nem_pr"]<-"nem_predador"
mRO$specie[mRO$specie=="octacy"]<-"Octalasion cyaneum"
mRO$specie[mRO$specie=="octala"]<-"Octalasion lacteum" #agregar
mRO$specie[mRO$specie=="onychiuridae"]<-"onichiuridae"
#oribatido agregar
mRO$specie[mRO$specie=="oripodoidea"]<-"oripodidae"
mRO$specie[mRO$specie=="parasitoidea"]<-"parasitidae"
mRO$specie[mRO$specie=="rhodacaroidea"]<-"rhodacarioidea"
mRO$specie[mRO$specie=="trombidioidea"]<-"trombidiidae"
mRO$specie[mRO$specie=="tydeoidea"]<-"tydeioidea"

}

webRO<-mRO%>%
  group_by(system,specie)%>%
  summarise(body=mean(bio.ind,na.rm=TRUE),
            d=mean(D,na.rm=TRUE),
            biomass=mean(BT,na.rm=TRUE))%>%
  distinct(specie,.keep_all=TRUE)

N<-webRO%>%filter(system=="N")
G<-webRO%>%filter(system=="G")
A<-webRO%>%filter(system=="A")

#Pesos corporales
body_N<-c(N$body,0,0,0)
body_G<-c(G$body,0,0,0)
body_A<-c(A$body,0,0,0)


#biomasas
#el hummus ya se calculó
#la carroña se calcula igual que en el anterior
#no informacion sobre los demás
bm_N<-c(N$biomass,
        NA, #Hojarasca
        mean(N[N$specie!="fungi"&N$specie!="bac"&N$specie!="proto",]$biomass)*0.05, #Carroña
        NA#Tej_veg
        )#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_G<-c(G$biomass,
        NA, #Hojarasca
        mean(G[G$specie!="fungi"&G$specie!="bac"&N$specie!="proto",]$biomass)*0.05, #Carroña
        NA#Tej_veg
        #G$biomass[G$specie=="hummus"]
        ) #humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_A<-c(A$biomass,
        NA, #Hojarasca
        mean(A[A$specie!="fungi"&A$specie!="bac"&A$specie!="proto",]$biomass)*0.05, #Carroña
        NA#Tej_veg
)
        #G$biomass[G$specie=="hummus"]

#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
#######

```
<!-- # Biomasas
# Hojarasca, Dato tomado de biomasas y abundancias de la red unlu
# Esto es el peso de la hojarasca encontrada en los 25*25 cm
# 0.3 es el coeficiente de peso seco
# L= 77,0321g/0.0625m2*0.3 P= 58.63g/0.0625m2*0.3 R= 55.753g/0.065m2*0.3
# asumir 40% de la MOS es POM
# %MO L=2.73% R=3.52% P= 3.09%
# dap aprox. 1.2
# Datos tomados de fyq_unlu, determinación de la materia orgánica.
# Tej_veg sin datos, seria conocer el peso de las raices y/o sus metabolitos liberados
# Como proxy, decimos que es una vez y media el contenido de materia orgánica
# Carroña, puede ser el 5% de la biomasa promedio total de los invertebrados
# L = 6980566 *0.01, R= 9231538*0.01, P=7122637*0.01
# Fórmula: mean(P[P$taxa!="fungi"&P$taxa!="bac"&P$taxa!="proto",]$biomass)
#Lavelle: Root biomass may be extremely high in soils and often constitutes the major resource for soil organisms. 
#raices 2mg por cm en figure III.19 soil organims. root. pp 237
#####
-->


```{r Gamma_matrix, include=FALSE}

#Esta es la mtriz global. Falta colocar aquellos ácaros y colémbolos de la matriz de Rosana
#Agregados 22/4 como strig a mano


webG<-web%>%
  group_by(taxa)%>%
  distinct(taxa,.keep_all=TRUE)

#print(R$taxa)
#agregar crotonioidea; Octalasion lacteum; Microscolex dubius; Eukerria stagnalis; brachychthonioidea
#provenientes de la comunidad Rosana
sp_G<-c("litter","carrion","tej_veg","hummus","isoptera","crotonioidea","Octalasion lacteum","Microscolex dubius","Eukerria stagnalis","brachychthonioidea","oribatido","limnozetidae",levels(as.factor(webG$taxa)))
mG<-matrix(nrow = length(sp_G),ncol = length(sp_G),
           dimnames = list(sp_G,sp_G))
#reemplazar NA por ceros

mG[is.na(mG)] <- 0
{
#####
#Microflora
mG["bac",c("hummus","litter","carrion")]<-1
mG["fungi",c("hummus","tej_veg","carrion","litter")]<-1
#Microfauna
mG["proto",c("bac","hummus","proto")]<-1
mG[c("enchytraeida","tardigrado"),c("bac","hummus","proto","fungi")]<-1
mG[c("enchytraeida"),c("litter")]<-1
mG["nem_predador",c("nem_predador","nem_omnivor","nem_fitofago",
                    "nem_bacterivoro","nem_fungivoro","proto","tardigrado")]<-1
mG["nem_omnivor",c("nem_fitofago","nem_bacterivoro","nem_fungivoro","proto",
                   "tardigrado","bac","fungi","hummus")]<-1
mG["nem_fitofago","tej_veg"]<-1
mG["nem_fungivoro","fungi"]<-1
mG["nem_bacterivoro","bac"]<-1

#####
#lombrices
mG[c("juvenil","Aporrectodea caliginosa",
     "Aporrectodea rosea","Aporrectodea trapezoides",
     "Bimastos beddardi sophiae","Bimastos parvus",
     "Eukerria halophila","Glossoscolex sp.","Octalasion lacteum", "Microscolex dubius",
     "Eukerria stagnalis","Microscolex phosphoreus","Octalasion cyaneum","Octolasion tyrtaeum"),
   c("litter","bac","fungi","proto","hummus")]<-1
#####
mG["astigmata",c("bac","fungi","nem_fitofago",
                    "nem_bacterivoro","nem_fungivoro","proto")]<-1


mG["coccinelidae",c("aphidoidea","thysanoptera","terebrantia","cicadidae")]

mG[c("aphidoidea","coleoptera_suctor","thysanoptera","hemiptero",
     "cicadidae","ortoptero","terebrantia","embrioptera"),
   c("tej_veg")]<-1 #este aparece, pero tal vez no se alimente¿?

#grandes detritivoros
mG[c("oniscidea","blattodea","diplopoda","gasteropoda",
     "larva_coleoptero","larva_tenebrionidae","larva_curculionidae",
     "larva_diptera",
     "larva_elateridae","larva_scarabidae","larva_sciaridae",
     "pupa_diptera","trogossitidae","cryptophagidae",
     "ptilidae","elateriforme","tenebrionidae","anthribidae"),
   c("fungi","litter","carrion")]<-1

#####

#Grandes mesostigmatas
#arctacaridae in the review not information of this group
#Krantz say " it may represent the sister group of the gamasine subcohorrs 
# Parasitiae and Dermanyssiae, 
#eviphididae, laelapidae, ologamasidae, parasitidae, veigaioidea

mG[c("arctacaridae","dermanisoidea","eviphididae", 
     "ichtyostomatogasteridae","laelapidae","ologamasidae", 
     "parasitidae", "veigaioidea","rhagidiidae","bdelloidea",
     "cunaxide","teneriffidae","trombidiidae"),
   c("enchytraeida","nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","astigmata",
     "limnozetidae","ceratozetoidea","diplura","entomobridae",
     "epilhomanioidea","eremobelbidae","eupthiracaroidea",
     "galumnidae","hipogastruridae","isotomidae","larva_diptera",
     "larva_sciaridae","onichiuridae","oppioidea","oribatulidae",
     "oripodidae","protura", "scheloribatidae","symphyla",
     "symphypleona", "teneriffidae","tardigrado",
     "alycidae", "anystidae","macropilina","ameroseidae",
     "arctacaridae","dermanisoidea","eviphididae", 
     "ichtyostomatogasteridae","laelapidae","ologamasidae", 
     "parasitidae", "veigaioidea",
     "bdelloidea","penthalidae","cunaxide","trombidiidae",
     "eupodoidea","tydeioidea","alycidae","anystidae","tarsonemidae",
     "rhodacarioidea","teneriffidae","rhagidiidae",
     "uropodoidea")]<-1
#arctacaridae segun Krantz dieta similar a Parasitidae
#dermanisoidea una amplia superfamilia, en ella estan los Laelapidae, Ascoidea, etc,
mG[c("uropodoidea","mesostigmata"),c("nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto","tardigrado")]<-1

#mesostigmata pequeño
mG[c("rhodacarioidea"),
   c("nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","tardigrado",
     "onichiuridae","hipogastruridae","isotomidae","symphypleona",
     "protura","diplura","symphyla",
     "entomobridae","enchytraeida")]<-1 #se alimentan solo de colembolos, 
                                        #evitando acaros
#####
#Prostigmata omnivoro
mG[c("eupodoidea","ameroseidae","penthalidae","tydeioidea",
     "alycidae","anystidae","tarsonemidae"),
   c("bac","fungi","carrion",
     "nem_predador","nem_omnivor","nem_fitofago",
     "nem_bacterivoro","nem_fungivoro","proto","tardigrado",
     "onichiuridae","hipogastruridae","isotomidae","symphypleona",
     "entomobridae","symphyla","protura","diplura","astigmata")]<-1

######
# Macropredadores
# acaros, colembolos, otros microartrópodos
mG[c("carabidae","staphiliniidae","pseudoscorpionida"),
   c("enchytraeida","astigmata","limnozetidae","ceratozetoidea","diplura",
     "entomobridae","epilhomanioidea","eremobelbidae","eupthiracaroidea","eupodoidea",
     "eviphididae","galumnidae","hipogastruridae","isotomidae",
     "mesostigmata","laelapidae","larva_diptera","larva_sciaridae",
     "ologamasidae","parasitidae","bdelloidea","onichiuridae","oppioidea",
     "oribatulidae","oripodidae","protura", "scheloribatidae","symphyla",
     "symphypleona", "teneriffidae","rhodacarioidea","tardigrado",
     "rhagidiidae","tydeioidea","uropodoidea","veigaioidea","arctacaridae",
     "bdelloidea","penthalidae","cunaxide","trombidiidae",
     "ameroseidae","arctacaridae","dermanisoidea", 
     "ichtyostomatogasteridae","macropilina","eupodoidea","tydeioidea","alycidae",
     "anystidae","tarsonemidae","teneriffidae")]<-1

#japyjapidae
mG[c("diplura"),c("protura","symphyla","onichiuridae","isotomidae","enchytraeida",
                  "entomobridae","hipogastruridae","carrion","bac","fungi","proto")]<-1


mG["larva_carabidae",c("enchytraeida","nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto")]<-1

#cienpies: todo tipo de artrópodo conforman su presa

mG["geophylomorpha",c("alycidae","anystidae","ameroseidae","bdelloidea","cunaxide",
                      "arctacaridae","enchytraeida","astigmata","limnozetidae",
                      "ceratozetoidea", "diplura","entomobridae",
                      "dermanisoidea","ichtyostomatogasteridae","macropilina",
                   "epilhomanioidea","eremobelbidae","eupthiracaroidea","eupodoidea",
                   "eviphididae","galumnidae","hipogastruridae","isotomidae",
                 "mesostigmata","laelapidae","larva_coleoptero","larva_curculionidae",
                 "larva_diptera","larva_elateridae","larva_sciaridae",
                 "ologamasidae","parasitidae","blattodea","carabidae",
                 "onichiuridae","oppioidea","oribatulidae","penthalidae",
                   "oripodidae","protura", "scheloribatidae","symphyla",
                   "symphypleona", "teneriffidae","rhodacarioidea","tardigrado",
                  "rhagidiidae","tydeioidea","uropodoidea","veigaioidea",
                 "aphidoidea","cicadidae","coleoptera_suctor","cryptophagidae",
                 "diplopoda","juvenil","elateriforme","hemiptero","larva_carabidae",
                 "ptilidae","staphiliniidae","thysanoptera","trogossitidae",
                   "tarsonemidae","tenebrionidae","terebrantia","trombidiidae"
                  )]<-1

#arácnidos 
mG[c("linyphiidae","lycosidae"),
   c("coccinelidae","aphidoidea","arctacaridae","astigmata",
     "limnozetidae","blattodea","carabidae","grillopalpidae",
     "ceratozetoidea","cicadidae","coleoptera_suctor","cryptophagidae",
     "cunaxide","diplura","elateriforme","entomobridae",
     "eremobelbidae","eupodoidea","eviphididae","macropilina","ortoptero",
     "formicidae","galumnidae","geophylomorpha","penthalidae","tenebrionidae",
     "hemiptero","hipogastruridae","isotomidae",
     "laelapidae","mesostigmata","ologamasidae",
     "oribatulidae","oripodidae","parasitidae",
     "ptilidae","staphiliniidae","symphyla","dermanisoidea",
     "symphypleona","thysanoptera","trogossitidae",
     "tydeioidea","uropodoidea","veigaioidea","anthribidae",
     "embrioptera","terebrantia","trombidiidae"
     )]<-1

#topogrillo
mG["grillopalpidae",c("carrion","bac","fungi","tej_veg","enchytraeida",
                      "nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto",
                   "diplura","entomobridae","hipogastruridae","isotomidae",
                  "onichiuridae","oppioidea","oripodidae","protura",
                  "symphyla","symphypleona","rhodacarioidea","tardigrado"
                  )]<-1
#hormigas, predadores generalistas.
#Atacan lombrices
#"carrion","fungi","tej_veg",

mG["formicidae",c("Aporrectodea caliginosa","Aporrectodea rosea",
                  "Aporrectodea trapezoides","Bimastos beddardi sophiae",
                  "Eukerria halophila","Glossoscolex sp.",
                  "Bimastos parvus","arctacaridae","enchytraeida",
                  "astigmata","limnozetidae","embrioptera","grillopalpidae",
                  "macropilina","Microscolex phosphoreus",
                  "Octalasion cyaneum",
                  "Octolasion tyrtaeum","ortoptero","penthalidae",
                      "ceratozetoidea", "diplura","entomobridae",
                   "epilhomanioidea","eremobelbidae","eupthiracaroidea","eupodoidea",
                   "eviphididae","galumnidae","hipogastruridae","isotomidae",
                 "mesostigmata","laelapidae","larva_coleoptero","larva_curculionidae",
                 "larva_diptera","larva_elateridae","larva_sciaridae",
                 "ologamasidae","parasitidae","bdelloidea","blattodea","carabidae",
                 "onichiuridae","oppioidea","oribatulidae","pupa_diptera",
                   "oripodidae","protura", "scheloribatidae","symphyla",
                   "symphypleona", "teneriffidae","rhodacarioidea",
                  "rhagidiidae","tydeioidea","uropodoidea","veigaioidea",
                 "aphidoidea","cicadidae","coleoptera_suctor","cryptophagidae",
                 "diplopoda","juvenil","elateriforme","hemiptero","larva_carabidae",
                 "ptilidae","staphiliniidae","thysanoptera","trogossitidae",
                 "alycidae","ameroseidae","anthribidae","anystidae","coccinelidae",
                 "tenebrionidae","terebrantia"
                  )]<-1

#parasito de grandes insectos
mG["nematomorpha",c("aphidoidea","blattodea","carabidae",
    "cicadidae","coleoptera_suctor","cryptophagidae",
    "elateriforme","hemiptero","ptilidae","staphiliniidae","thysanoptera","trogossitidae")]<-1


#microfitofagos
mG[c("macropilina","limnozetidae","oribatido",
     "scheloribatidae","oripodidae","oribatulidae",
     "protura","eremobelbidae","oppioidea","brachychthonioidea"),c("bac","fungi","hummus")]<-1
#macrofitofago
mG[c("symphypleona","crotonioidea"),c("bac","fungi","hummus","tej_veg","litter")]<-1
mG[c("epilhomanioidea","eupthiracaroidea","isoptera"),c("litter")]<-1
mG[c("isoptera"),c("hummus")]<-1
#macrofitofago omnivoro
mG[c("ceratozetoidea","onichiuridae","isotomidae",
     "scheloribatidae","symphyla"),
   c("bac","fungi","hummus","carrion","litter","tej_veg","nem_fungivoro",
     "nem_bacterivoro")]<-1
#omnivoro
mG[c("entomobridae"),c("bac","fungi","nem_bacterivoro","nem_fungivoro")]<-1


mG["galumnidae",c("carrion","nem_fitofago","tardigrado",
                   "nem_bacterivoro","nem_fungivoro","proto","bac","fungi")]<-1

mG["hipogastruridae",c("nem_predador","nem_omnivor","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro","proto",
                   "tardigrado","bac","fungi","carrion")]<-1
######

mG[c("protura","symphyla"),c("carrion","bac","fungi","proto")]<-1

mG["ptilidae",c("hummus","fungi","carrion","bac","proto","nem_fitofago",
                   "nem_bacterivoro","nem_fungivoro")]<-1

#agregar crotonioidea; Octalasion lacteum; Microscolex dubius; Eukerria stagnalis; brachychthonioidea
#provenientes de la comunidad Rosana
}

# Interacciones que perjudican entonces, mG*-1

```




```{r redes, echo=FALSE}
#red global "diveridad gamma"
Gl_net <- graph_from_adjacency_matrix(t(mG),mode=c("directed") )
#Red Lote UNLu
L_net <-graph_from_adjacency_matrix(t(mG[c(L$taxa,"litter","carrion","tej_veg","hummus"),c(L$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Reserva UNLu
R_net <-graph_from_adjacency_matrix(t(mG[c(R$taxa,"litter","carrion","tej_veg","hummus"),c(R$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )
#Red Pastizal UNLu
P_net <-graph_from_adjacency_matrix(t(mG[c(P$taxa,"litter","carrion","tej_veg","hummus"),c(P$taxa,"litter","carrion","tej_veg","hummus")]),mode=c("directed") )

#Datos de ácaros - colémbolos -lombrices - y respiración heterotrófica
#Red Pastizal Naturalizado RO
N_net <-graph_from_adjacency_matrix(t(mG[c(N$specie,"litter","carrion","tej_veg"),c(N$specie,"litter","carrion","tej_veg")]),mode=c("directed") )
#Red mixto Agrícola Ganadero RO
G_net <-graph_from_adjacency_matrix(t(mG[c(G$specie,"litter","carrion","tej_veg"),c(G$specie,"litter","carrion","tej_veg")]),mode=c("directed") )
#Red agrícola intensivo RO
A_net <-graph_from_adjacency_matrix(t(mG[c(A$specie,"litter","carrion","tej_veg"),c(A$specie,"litter","carrion","tej_veg")]),mode=c("directed") )


```

```{r ady_matrix, echo=FALSE}
#aca colocar la tabla 
gamma_matrix <- as.data.frame(as.matrix(Gl_net, "edgelist"))
names(gamma_matrix)<-c("Recurso","Consumidor")
kableExtra::kable(gamma_matrix)
```

```{r multiweb,echo=FALSE}
library(multiweb)
#plot_troph_level(G_net,modules=TRUE,vertexLabel = TRUE, tk = TRUE)

#####
# índices topológicos
#calc_topological_indices(Gl_net)
topological<-rbind(
calc_topological_indices(L_net),
calc_topological_indices(R_net),
calc_topological_indices(P_net),

calc_topological_indices(A_net),
calc_topological_indices(G_net),
calc_topological_indices(N_net), colnames=NULL
)

kableExtra::kable(topological)



```

```{r plot_redes, echo=FALSE, warning=FALSE}
par(mfrow=c(1,3))
plot_troph_level(R_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)
plot_troph_level(P_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)
plot_troph_level(L_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)

plot_troph_level(N_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)
plot_troph_level(G_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)
plot_troph_level(A_net,modules=TRUE,vertexLabel = FALSE, tk = FALSE)


par(mfrow=c(1,1))
```

<!-- Re(lM,1), is a measure of stability, as it
expresses the amount of self-regulation we would need to stabilize
the equilibrium2 Modularity and stability in ecological communities
Jacopo Grilli1, Tim Rogers2 & Stefano Allesina1,3,4-->

<!-- ###########
#estas son las suposiciones previas
#v_ig[v_ig$nombre=="litter","peso"]<-100
#v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
#v_ig[v_ig$nombre=="tej_veg","peso"]<-1000 #peso de las raices por centímero
#v_ig[v_ig$nombre=="hummus","peso"]<-0.5 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
#v_ig[v_ig$nombre=="litter","densidad"]<-bm_L[72]/100
#v_ig[v_ig$nombre=="carrion","densidad"]<-bm_L[73]/1 #tomo el mínimo y lo llevo a unidad
#v_ig[v_ig$nombre=="tej_veg","densidad"]<-bm_L[74]/1000 #peso de las raices por centímero
#v_ig[v_ig$nombre=="hummus","densidad"]<-bm_L[75]/0.5-->

```{r QSS_noIS, echo=FALSE}
#sin fuerzas de interacción
QSS_R<-calc_QSS(R_net, nsim=1000,returnRaw=TRUE)
QSS_P<-calc_QSS(P_net, nsim=1000,returnRaw=TRUE)
QSS_L<-calc_QSS(L_net, nsim=1000,returnRaw=TRUE)

QSS_N<-calc_QSS(N_net, nsim=1000,returnRaw=TRUE)
QSS_G<-calc_QSS(G_net, nsim=1000,returnRaw=TRUE)
QSS_A<-calc_QSS(A_net, nsim=1000,returnRaw=TRUE)

QSS_noIS<-cbind(summary(QSS_R),summary(QSS_P),summary(QSS_L),
      summary(QSS_N),summary(QSS_G),summary(QSS_A))
```

** Histogramas y boxplot del QSS **

El valor absoluto del máximo autovalor es una medida de estabilidad en el que se indica 
la cantidad de "autoregulación" necesaria para llegar al equilibrio. (Grilli, Rogerts, Allesina 201x)

Con el histograma se muestra la distribución de 1000 simulaciones, y con el boxplot se resume sus valores descriptivos.

```{r plot_QSS_noIS, echo=FALSE}

boxplot(QSS_R$maxre,main = "reserva UNLu", sub= "QSS_noIS", xlab = NULL)
hist(QSS_R$maxre,main = "reserva UNLu", sub= "QSS_noIS", xlab = NULL)
boxplot(QSS_P$maxre, main = "pastizal UNLu", sub= "QSS_noIS", xlab = NULL)
hist(QSS_P$maxre, main = "pastizal UNLu", sub= "QSS_noIS", xlab = NULL)
boxplot(QSS_L$maxre, main = "lote agricola UNLu", sub= "QSS_noIS", xlab = NULL)
hist(QSS_L$maxre, main = "lote agricola UNLu", sub= "QSS_noIS", xlab = NULL)
boxplot(QSS_N$maxre, main= "pastizal nat", sub= "QSS_noIS", xlab = NULL)
hist(QSS_N$maxre, main= "pastizal nat", sub= "QSS_noIS", xlab = NULL)
boxplot(QSS_G$maxre, main = "mixto", sub= "QSS_noIS", xlab = NULL)
hist(QSS_G$maxre, main = "mixto", sub= "QSS_noIS", xlab = NULL)
boxplot(QSS_A$maxre, main= "agricola intensivo", sub= "QSS_noIS", xlab = NULL)
hist(QSS_A$maxre, main= "agricola intensivo", sub= "QSS_noIS", xlab = NULL)


```

```{r interaction_strenght, include=FALSE}
#R P L N G A
#Los pesos ya se configuran con 1e-9 para convertir los microgramos a kilogramos. Pawar así lo calcula
#RESERVA
{#genero el edge list
edge_R_net <- as.data.frame(as.matrix(R_net, "edgelist"))
names(edge_R_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(R$taxa,"litter","carrion","tej_veg","hummus"),peso=body_R*1e-9,
                 densidad=bm_R/body_R)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_R_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_R_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_R_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_R_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_R_net[edge_R_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_R_net$dimension<-"2D"
}
#edge_list_UNLu[edge_list_UNLu$peso_recurso==0|edge_list_UNLu$peso_recurso==-999,"peso_recurso"]<-1e-15
#edge_list_UNLu[edge_list_UNLu$peso_consumidor==0|edge_list_UNLu$peso_consumidor==-999,"peso_consumidor"]<-1e-15
#error



#PASTIZAL
{#genero el edge list
edge_P_net <- as.data.frame(as.matrix(P_net, "edgelist"))
names(edge_P_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(P$taxa,"litter","carrion","tej_veg","hummus"),peso=body_P*1e-9,densidad=bm_P/body_P)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_P_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_P_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_P_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_P_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_P_net[edge_P_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_P_net$dimension<-"2D"
}


#LOTE AGRICOLA
{#genero el edge list
edge_L_net <- as.data.frame(as.matrix(L_net, "edgelist"))
names(edge_L_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(L$taxa,"litter","carrion","tej_veg","hummus"),peso=body_L*1e-9,densidad=bm_L/body_L)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_L_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_L_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_L_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_L_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_L_net[edge_L_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_L_net$dimension<-"2D"
}


#N = PASTIZAL NATURALIZADO 
{#genero el edge list
edge_N_net <- as.data.frame(as.matrix(N_net, "edgelist"))
names(edge_N_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(N$specie,"litter","carrion","tej_veg"),peso=body_N*1e-9,densidad=bm_N/body_N)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_N_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_N_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_N_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_N_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_N_net[edge_N_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_N_net$dimension<-"2D"
}


#G: Ganadero mixto
{#genero el edge list
edge_G_net <- as.data.frame(as.matrix(G_net, "edgelist"))
names(edge_G_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(G$specie,"litter","carrion","tej_veg"),peso=body_G*1e-9,densidad=bm_G/body_G)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_G_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_G_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_G_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_G_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_G_net[edge_G_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_G_net$dimension<-"2D"
}


#A: Agricola intensivo
{#genero el edge list
edge_A_net <- as.data.frame(as.matrix(A_net, "edgelist"))
names(edge_A_net)<-c("recurso","consumidor")

#a cada nodo agrego el peso corporal y la densidad 
v_ig<-data.frame(nombre=c(A$specie,"litter","carrion","tej_veg"),peso=body_A*1e-9,densidad=bm_A/body_A)

###########
#se asume que la relacion densidad de recurso y peso es 1
#cuando no el consumidor no deppende del peso del recurso
#asignandos pesos
v_ig[v_ig$nombre=="litter","peso"]<-1
v_ig[v_ig$nombre=="carrion","peso"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","peso"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","peso"]<-1 #la mitad de la carroña, a dedo, es un componente amorfo y no tiene una unidad en concreto lo mismo las demás recursos.
#asignando densidades a los recursos
v_ig[v_ig$nombre=="litter","densidad"]<-1
v_ig[v_ig$nombre=="carrion","densidad"]<-1 #tomo el mínimo y lo llevo a unidad
v_ig[v_ig$nombre=="tej_veg","densidad"]<-1 #peso de las raices por centímero
v_ig[v_ig$nombre=="hummus","densidad"]<-1
# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad


# con bucle busco asignar a cada eje su correspondiente peso corporal y densidad
###########

edge_A_net$peso_consumidor<-NA
# columna peso del consumidor
for (pc in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$consumidor==as.character(v_ig$nombre[pc]),"peso_consumidor"]<-v_ig$peso[pc]
}

#columna peso del recurso
edge_A_net$peso_recurso<-NA
for (pr in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$recurso==as.character(v_ig$nombre[pr]),"peso_recurso"]<-v_ig$peso[pr]
}

#columna densidad del consumidor
edge_A_net$densidad_consumidor<-NA
for (dc in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$consumidor==as.character(v_ig$nombre[dc]),"densidad_consumidor"]<-v_ig$densidad[dc]
}
#columna densidad del recurso
edge_A_net$densidad_recurso<-NA
for (dr in 1:length(v_ig$nombre)) {edge_A_net[edge_A_net$recurso==as.character(v_ig$nombre[dr]),"densidad_recurso"]<-v_ig$densidad[dr]
}

edge_A_net$dimension<-"2D"
}



```

```{r IS, echo=FALSE}
#Ya tengo todos los componentes solicitados

# Para detritos litter, carrion, etc. el tamaño del recurso res_mm y la densidad del recurso res_den están desacoplados del tamaño del consumidor, hay que asignar 1 a ambos

#el peso debe ser utilizado como en kilogramos,
#como esto está en microgramos será 1e-9

IS_R1<-calc_interaction_intensity(da=edge_R_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_P1<-calc_interaction_intensity(da=edge_P_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_L1<-calc_interaction_intensity(da=edge_L_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )

IS_N1<-calc_interaction_intensity(da=edge_N_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_G1<-calc_interaction_intensity(da=edge_G_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
IS_A1<-calc_interaction_intensity(da=edge_A_net,
                         res_mm =peso_recurso,res_den = densidad_recurso,
                        con_mm = peso_consumidor, int_dim =dimension )
```

** Histogramas de la fuerza de interacción per cápita, siguiendo Pawar (20xx) y multiweb **

```{r hist_IS, echo=FALSE}
par(mfrow=c(2,3))

hist(log(IS_R1$qRC),main = "reserva UNLu", sub= "log nat del IS", xlab = NULL)
hist(log(IS_P1$qRC), main = "pastizal UNLu", sub= "log nat del IS", xlab = NULL)
hist(log(IS_L1$qRC), main = "lote agricola UNLu", sub= "log nat del IS", xlab = NULL)
hist(log(IS_N1$qRC), main= "pastizal nat", sub= "log nat del IS", xlab = NULL)
hist(log(IS_G1$qRC), main = "mixto", sub= "log nat del IS", xlab = NULL)
hist(log(IS_A1$qRC), main= "agricola intensivo", sub= "log nat del IS", xlab = NULL)

par(mfrow=c(1,1))

```


La forma de los histogramas es similar entre los dos conjunto de datos. En la UNLu los histogramas son unimodales, en Rosana son bi modales. Las fuerzas de interacciones entre estos deberán ser puesta a prueba para ver si hay diferencias

```{r QSS_IS, echo=FALSE}
#multiplicar qRC por la densidad el consumidor para que de la fuerza de interaccion total, sino es por unidad de peso del consumidor
#Reserva
IS_R<-IS_R1[,c(1,2,11)]
names(IS_R)<-c("recurso","consumidor","weight")
IS_R_net<-graph_from_data_frame(IS_R,directed = TRUE, vertices =NULL)
#Pastizal
IS_P<-IS_P1[,c(1,2,11)]
names(IS_P)<-c("recurso","consumidor","weight")
IS_P_net<-graph_from_data_frame(IS_P,directed = TRUE, vertices =NULL)
#Lote unlu
IS_L<-IS_L1[,c(1,2,11)]
names(IS_L)<-c("recurso","consumidor","weight")
IS_L_net<-graph_from_data_frame(IS_L,directed = TRUE, vertices =NULL)

#Reserva
IS_N<-IS_N1[,c(1,2,11)]
names(IS_N)<-c("recurso","consumidor","weight")
IS_N_net<-graph_from_data_frame(IS_N,directed = TRUE, vertices =NULL)
#Pastizal
IS_G<-IS_G1[,c(1,2,11)]
names(IS_G)<-c("recurso","consumidor","weight")
IS_G_net<-graph_from_data_frame(IS_G,directed = TRUE, vertices =NULL)
#Lote unlu
IS_A<-IS_A1[,c(1,2,11)]
names(IS_A)<-c("recurso","consumidor","weight")
IS_A_net<-graph_from_data_frame(IS_A,directed = TRUE, vertices =NULL)

####
QSS_IS_R<-calc_QSS(IS_R_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_P<-calc_QSS(IS_P_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_L<-calc_QSS(IS_L_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)


QSS_IS_N<-calc_QSS(IS_N_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_G<-calc_QSS(IS_G_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)
QSS_IS_A<-calc_QSS(IS_A_net, istrength=TRUE, returnRaw = TRUE, nsim=1000)

```

**Gráficos de cajas e histogramas del valor de estabilidad en escala 
logaritmica calculado a partir de la intensidad de interacciones**

```{r plot_QSS_IS, echo=FALSE}

boxplot(log(QSS_IS_R$maxre),main = "reserva UNLu", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_R$maxre),main = "reserva UNLu", sub= "logQSS_IS", xlab = NULL)
boxplot(log(QSS_IS_P$maxre), main = "pastizal UNLu", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_P$maxre), main = "pastizal UNLu", sub= "logQSS_IS", xlab = NULL)
boxplot(log(QSS_IS_L$maxre), main = "lote agricola UNLu", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_L$maxre), main = "lote agricola UNLu", sub= "logQSS_IS", xlab = NULL)
boxplot(log(QSS_IS_N$maxre), main= "pastizal nat", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_N$maxre), main= "pastizal nat", sub= "logQSS_IS", xlab = NULL)
boxplot(log(QSS_IS_G$maxre), main = "mixto", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_G$maxre), main = "mixto", sub= "logQSS_IS", xlab = NULL)
boxplot(log(QSS_IS_A$maxre), main= "agricola intensivo", sub= "logQSS_IS", xlab = NULL)
hist(log(QSS_IS_A$maxre), main= "agricola intensivo", sub= "logQSS_IS", xlab = NULL)


```

```{r QSS_taxon, include=FALSE}

#acá colocar los gremios tróficos
# o los taxas
#usar en su lugar calc_QSS_extinction_dif_grp
#QSS_unlu_seq<-calc_QSS_extinctions_seq(QSS_IS_UNLu, seq = V(QSS_IS_UNLu)$name[20:25], nsim = 100, ncores = 4, istrength = TRUE)
```


```{r flux, echo=FALSE}
library(fluxweb)
#pasar todo a gramos con *1e-6
#además los recursos se colocan como uno, de manera similar a lo que dice Pawar
#litter carrion tej_veg hummus
body_L<-c(L$body*1e-6,1.00,1.0,1.0,1.0)
body_R<-c(R$body*1e-6,1.00,1.0,1.0,1.0)
body_P<-c(P$body*1e-6,1.00,1.0,1.0,1.0)
# Biomasas
# Hojarasca, Dato tomado de biomasas y abundancias de la red unlu
# Esto es el peso de la hojarasca encontrada en los 25*25 cm
# 0.3 es el coeficiente de peso seco
# L= 77,0321g/0.0625m2*0.3 P= 58.63g/0.0625m2*0.3 R= 55.753g/0.065m2*0.3
# asumir 40% de la MOS es POM
# %MO L=2.73% R=3.52% P= 3.09%
# dap aprox. 1.2
# Datos tomados de fyq_unlu, determinación de la materia orgánica.
# Tej_veg sin datos, seria conocer el peso de las raices y/o sus metabolitos liberados
# Como proxy, decimos que es una vez y media el contenido de materia orgánica
# Carroña, puede ser el 5% de la biomasa promedio total de los invertebrados
# L = 6980566 *0.01, R= 9231538*0.01, P=7122637*0.01
# Fórmula: mean(P[P$taxa!="fungi"&P$taxa!="bac"&P$taxa!="proto",]$biomass)
#Lavelle: Root biomass may be extremely high in soils and often constitutes the major resource for soil organisms. 
#raices 2mg por cm en figure III.19 soil organims. root. pp 237
#####
bm_L<-c(L$biomass,
       (77.0321/0.0625)*0.3*1e6, #Hojarasca
      mean(R[R$taxa!="fungi"&R$taxa!="bac"&R$taxa!="proto",]$biomass)*0.05, #Carroña
        2.25*0.0273*1.2*50000*1e6,#Tej_veg
       0.4*0.0273*1.2*50000*1e6)*1e-6#humus; 0.4 proxi POM, %MO, 1.2 DAP, 50k volumen suelo
bm_R<-c(R$biomass,
       55.753/0.065*0.3*1e6, #Hojarasca
      mean(R[R$taxa!="fungi"&R$taxa!="bac"&R$taxa!="proto",]$biomass)*0.05, #carroña
     2.25*0.0352*1.2*50000*1e6, #tej_veg
      0.4*0.0352*1.2*50000*1e6)*1e-6 #"humus" = POM = 0.4MO
bm_P<-c(P$biomass,
      (58.63/0.0625)*0.3*1e6, #Hojarasca
        mean(P[P$taxa!="fungi"&P$taxa!="bac"&P$taxa!="proto",]$biomass)*0.05, #carroña
        2.25*0.0352*1.2*50000*1e6, #Tej_veg
              0.4*0.0309*1.2*50000*1e6)*1e-6 #Humus
#######
#tasas metabolicas, 
# usamos la para "invertebrados" de flux web package
#
# 17.17 W^ -0.29

t_metL<- 17.17*body_L^(-0.29)
t_metL[is.na(t_metL)|t_metL==Inf]<-0
t_metR<- 17.17*body_R^(-0.29)
t_metR[is.na(t_metR)|t_metR==Inf]<-0
t_metP<- 17.17*body_P^(-0.29)
t_metP[is.na(t_metP)|t_metP==Inf]<-0

#Para las eficiencias, generar una columna, con eficiencias por tipo de consumidor

ef_L<- c(L$ef,0.03,0.03,0.03,0.03)
ef_R<- c(R$ef,0.03,0.03,0.03,0.03)
ef_P<- c(P$ef,0.03,0.03,0.03,0.03)

flux_L<-fluxing(t(mG[c(L$taxa,"litter","carrion","tej_veg","hummus"),c(L$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_L, losses =  t_metL, efficiencies =  ef_L,ef.level = "pred")

#ef.level	
#Set to "prey" if efficiencies are defined by prey, "pred" if they are a property of the predator.
flux_R<-fluxing(t(mG[c(R$taxa,"litter","carrion","tej_veg","hummus"),c(R$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_R, losses =  t_metR, efficiencies =  ef_R,ef.level = "pred")

flux_P<-fluxing(t(mG[c(P$taxa,"litter","carrion","tej_veg","hummus"),c(P$taxa,"litter","carrion","tej_veg","hummus")]) ,biomasses = bm_P, losses =  t_metP, efficiencies =  ef_P,ef.level = "pred")

# growth rates of basal sppecies
growth.rates = rep(NA, dim(flux_R)[1])
growth.rates[colSums(flux_R) == 0] = c(2,10,365,0.3)

####### 

valor_stabR<-stability.value(flux_R , biomasses = bm_R, losses=t_metR, efficiencies=ef_R, 
                            growth.rate=growth.rates,bioms.prefs = TRUE,bioms.losses = TRUE,
                            ef.level = "pred" ); valor_stabR
```

```{=html}
<!--Flux web paper say:  Here we use resilience as a definition of
stability. Resilience is determined from the Jacobian matrix. The system is
in a stable equilibrium only if the real parts of eigenvalues from the Jacobian
are all negative. In this case, resilience is the absolute value of the real part
of the largest eigenvalue, ... -->
```

```{=html}
<!-- ver también, https://github.com/robertwbuchkowski/soilfoodwebs 
análisis con C y N "estequimetría"-->
```




<!--
#Para 1mgCO2 / 100g suelo * hora son 20.6 mg C-microbiano / 100g suelo
#Estos datos estan en mgCO2 /20 g suelo * dia
#Entonces multplico x 5 (a 100 g) divido * 24 (h/dia) luego multiplico por factor 20,6
# En un m2 a 10 cm son 100k cm3 por el DAP pero con 100 g suelo queda solo 1k*DAP

#####Factor de conversión de respiración microbiana = 4292000 = 4,3e6, para que quede en **microgramos**

#Materia organica particulada, es el proxi del humus, se asume que el 30% del mismo es hummus, aunque la bibliografia sugiere entre 40 al 60 % seré pesimista, entonces quearía POM en ug/m2

#octalaceom cyaneum es mas chico que lacteum, tuve que reordenar la base de datos

#base <-completo%>% mutate(bm=RESP*DAP*4.292e6,POM=0.3*(MO/100)*DAP*1e11,specie=case_when(specie=="octa_la"~"octacy",specie=="octa_cy"~"octala",specie!="octa_la"|specie!="octa_cy"~specie),biomass=case_when(order=="crassiclitellata"~exp(biomass*(1e-6))*1000,order!="crassiclitellata"~biomass))



#segun YOU IA, se requieren 1 Tn hoja seca para 0,5%MO por hectarea, es decir que por m2 son 0,1 kg de hojas

-->
Se realizan varias suposiciones:

Sobre el humus, se considera que lo utilizable como recurso es el 30% de
la %MO en los primeros 10 cm La relación H:B será por el momento
N25-G30-A35 de bacterias:hongos en los sistemas N G A respectivamente.
Además protozoos y otra microfauna representará el 5% e la respiración

Según Digel

\|Taxón \| Peso corporal \|

\|Bacteria \|9,5 x 10\^-16 g\|

\|Ameba \|2,8 10\^-8 g\|

\|Ciliados \|2,63 10\^-9 g\|

\|Flegelados \|3,03 10\^-7 g\|

\|------------\|-----------\|

\|bacterívoros \|8,5 x 10\^-7\|

\|omnivoros \|6,02 x 10\^-5\|

\|predadores \|3,56 x 10\^-6\|

\|fungivoros \|5,35 x 10\^-7\|

\|fitófagos root feeding \|2,35 x 10\^-7\|

Peso promedio de los protozoos en 1,1121 x10\^-4 µg

Nematodos son 10⁵ ind/m2 biomasa tomada de potapov y digel. En este caso
la proporción de fungivoros 40 % y bacterivoros sera igual en todos 30%
predadores 8% omnivoros 8% 14% fitofagos.

Nemátodos 15 x 10⁵ ind/m² un poco por debajo de lo que encontró Mondino
en su tesis doctoral, unque el rango varío ampliamente de 2,67 a 18,58
Asumiendo como 15 x10⁵ ind nemátodos / m² y los porcentajes de gremios
más arriba, entonces tendríamos una biomasa de:

bacterívoros 8,5 x 10\^-7; ==\> x450 x10³ ind/m² ==\> 382, 5 µg/m²
omnivoros 6,02 x 10\^-5; ==\> x120 x10³ind/m² ==\> 7224 µg/m² predadores
3,56 x 10\^-6; ==\> x120 x10³ind/m² ==\> 427 µg/m² fungivoros 5,35 x
10\^-7; ==\> x600 x10³ ind/m² ==\> 321 µg/m² fitófagos root feeding 2,35
x 10\^-7; ==\> x210 x10³ ind/m² ==\> 49,35 µg/m²

Serían 8404 µg nemátodos/m²

Número de protozoos por gramo de suelo Ameba 123x10³ =\> x 2,8 10\^-8
=\>3,4 10\^-3 g/g suelo =\> 274,19 g/m2 Flagelados 27.3x10³ =\> x 3,03
10\^-7 =\> 8,2719 10\^-3 g/g suelo =\> 667,08 g/m2 Ciliados 12.1 x 10³
=\> x 2,63 10\^-7 =\> 3,1823 x10\^-3 g/g suelo =\> 256,63 g/m2

Protozoos en un gramo de suelo según Vargas y Hattori 1990 Microbiology
Ecology 74 (1990) 73-78

5480 protozoos por gramo de suelo activos según Griffiths and Ritz soil
Biol. Biochem. Vol. 20. No. 2.pp163-173 (1998)

Tardígrados número por 10 cm³ suelo entre 250 individuos según Bingemer
et al. 2020 Zoological Journal of the Linnean Society 188. 887-899

Potapov en el Bosque tropical de indonesia calculó de hojarasca 11kg/ha
en Miramar hemos encontrado 700 g/m2

Microfauna calculada como 6,57 x10 \^-5 g, es el promedio de protozoos y
nemátodos sería 0.066 µg peso

La materia orgánica particulada es el proxi a la cantidad de recurso que
se corresponde con el Humus y esta es una fracción del %de MO
(Biological indicator of Soil Healt pp 70 - 71)

El 0.25% de lo que corresponde a microfauna sera no nematodo.



[elseiver para
discu](https://www.sciencedirect.com/topics/agricultural-and-biological-sciences/soil-food-web)

# ref

<!--Pawar menciona que si no conocemos el peso del recurso y se sabe que su tamaño es mayor se considera como uo.-->
El autor trabaja sobre la abundancia de individuos del suelo 
a escala global, y encontró patrones, entre la temp, la masa, y al transferencia a traves de niveles troficos
siendo estos similares a los que se hallan o se sabían eran patrones generales en los ecosistemas
For example, though
abundance and body masses of litter and soil animals
can be estimated fairly simply (Coleman et al. 1999), it
can be extremely difficult to accurately estimate resource
availability and average body temperature in the soil
environment. Meanwhile, energetic resources available to
soil invertebrates at a given locale can vary at the scale
of centimeters (Coleman et al. 2004).  important physical and
biological factors. These factors could include physical
conditions of the litter and soil environment, such as pH,
nutrient content, and moisture availability, which are
known to affect soil invertebrate community structure
(Coleman et al. 2004, Reich et al. 2005). Also, the
stoichiometric profiles of resources relative to consumers
are known to affect rates of resource consumption ENERGY USE AND ANIMAL ABUNDANCE
IN LITTER AND SOIL COMMUNITIES
TIMOTHY D. MEEHAN 2006

```{=html}
<!-- Achiorno, C.L., de Villalobos, C., Ferrari, L., 2008. Toxicity of the herbicide glyphosate
to Chordodes nobilii (Gordiida, Nematomorpha). Chemosphere 71 (10): 1816–
1822. Los nematomorfas adultos son de via libre, los parásitos son sus larvas-->
```

