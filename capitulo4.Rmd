---
title: "Chap4"
author: "Velazco"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r , include=FALSE}
require(tidyverse)
#{require(ggplot2);require(dplyr);require(tidyr);require(readr);require(purrr);require(tibble);require(stringr);require(forcats);require(readxl);require(magrittr);require(glue)}

```


```{r datos, include=FALSE}

completo <- read_excel("soil_networks.xlsx", sheet = "Ro_web")

#Es el factor de conversión para llevar las abundancias a densidad
#Densidadde lombrice en 25*25 = a n()/0.0625
#Densidad de los demás es 2.5²*3.14 = n()/0,00471 

sup.bocado <- 1/(pi*2.5^2/10000)
sup.monolito <- 1/(0.25*0.25)


#Para 1mgCO2 / 100g suelo * hora son 20.6 mg C-microbiano / 100g suelo
#Estos datos estan en mgCO2 /20 g suelo * dia
#Entonces multplico x 5 (a 100 g) divido * 24 (h/dia) luego multiplico por factor 20,6
# En un m2 a 10 cm son 100k cm3 por el DAP pero con 100 g suelo queda solo 1k*DAP

#####Factor de conversión de respiración microbiana=4292000 = 4,3e6, para que quede en microgramos

#Materia organica particulada, es el proxi del humus, se asume que el 30% del mismo es hummus, aunque la bibliografia sugiere entre 40 al 60 % seré pesimista, entonces quearía POM en ug/m2

#octalaceom cyaneum es mas chico que lacteum, tuve que reordenar la base de datos

base <-completo%>% mutate(bm=RESP*DAP*4.292e6,POM=0.3*(MO/100)*DAP*1e11,specie=case_when(specie=="octa_la"~"octacy",specie=="octa_cy"~"octala",specie!="octa_la"|specie!="octa_cy"~specie),biomass=case_when(order=="crassiclitellata"~exp(biomass*(1e-6))*1000,order!="crassiclitellata"~biomass))

base.sitio<-base%>%group_by(system,site,season,class,order,specie,guild,habitat) %>%  summarise(abundance=n(), bio.ind=mean(biomass), bm=(mean(bm)),POM=mean(POM))%>%distinct(specie,.keep_all=TRUE)

ab.sitio<-base.sitio%>%mutate(BT=case_when(order=="crassiclitellata"~sup.monolito*abundance*bio.ind,order!="crassiclitellata"~sup.bocado*abundance*bio.ind))

#El uso de case_when() permite relacionar estructuras condicionales al mutate

#writexl::write_xlsx(base,"bundancias.xlsx")

#segun YOU IA, se requieren 1 Tn hoja seca para 0,5%MO por hectarea, es decir que por m2 son 0,1 kg de hojas


```

Se realizan varias suposiciones:

Sobre el humus, se considera que lo utilizable como recurso es el 30% de la %MO en los primeros 10 cm
La relación H:B será por el momento 25:30:35 de bacterias:hongos en los sistemas N G A respectivamente.


```{r}

base1 <-ab.sitio %>% group_by(system,site,season) %>%  summarise(humus=mean(POM), bm=(mean(bm)), )%>%distinct(site,.keep_all=TRUE)



```
La materia orgánica particulada es el proxi a la cantidad de recurso que se corresponde con el Humus y esta es una fracción del %de MO (Biological indicator of Soil Healt pp 70 - 71)



## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
